const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/browser-BlFWOIro.js","chunks/index-B-ouW-6M.js","assets/index-VLffkA-U.css"])))=>i.map(i=>d[i]);
var V0=Object.defineProperty;var Gm=n=>{throw TypeError(n)};var W0=(n,e,t)=>e in n?V0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var G=(n,e,t)=>W0(n,typeof e!="symbol"?e+"":e,t),Pf=(n,e,t)=>e.has(n)||Gm("Cannot "+t);var l=(n,e,t)=>(Pf(n,e,"read from private field"),t?t.call(n):e.get(n)),_=(n,e,t)=>e.has(n)?Gm("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),m=(n,e,t,s)=>(Pf(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),b=(n,e,t)=>(Pf(n,e,"access private method"),t);var nt=(n,e,t,s)=>({set _(i){m(n,e,i,t)},get _(){return l(n,e,s)}});import{r as F,j as k,c as Ee,R as wr,u as wd,S as sp,a as G0,b as X0,g as K0,d as Cs,e as Mr,B as gb,f as Z0,J as Y0}from"./index-B-ouW-6M.js";const je=F.forwardRef(({className:n,type:e,...t},s)=>k.jsx("input",{type:e,className:Ee("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:s,...t}));je.displayName="Input";function mn(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function J0(n,e=[]){let t=[];function s(r,a){const o=F.createContext(a),c=t.length;t=[...t,a];const h=d=>{var w;const{scope:f,children:p,...g}=d,y=((w=f==null?void 0:f[n])==null?void 0:w[c])||o,v=F.useMemo(()=>g,Object.values(g));return k.jsx(y.Provider,{value:v,children:p})};h.displayName=r+"Provider";function u(d,f){var y;const p=((y=f==null?void 0:f[n])==null?void 0:y[c])||o,g=F.useContext(p);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${r}\``)}return[h,u]}const i=()=>{const r=t.map(a=>F.createContext(a));return function(o){const c=(o==null?void 0:o[n])||r;return F.useMemo(()=>({[`__scope${n}`]:{...o,[n]:c}}),[o,c])}};return i.scopeName=n,[s,Q0(i,...e)]}function Q0(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const s=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(r){const a=s.reduce((o,{useScope:c,scopeName:h})=>{const d=c(r)[`__scope${h}`];return{...o,...d}},{});return F.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function mb(n,e=[]){let t=[];function s(r,a){const o=F.createContext(a),c=t.length;t=[...t,a];function h(d){const{scope:f,children:p,...g}=d,y=(f==null?void 0:f[n][c])||o,v=F.useMemo(()=>g,Object.values(g));return k.jsx(y.Provider,{value:v,children:p})}function u(d,f){const p=(f==null?void 0:f[n][c])||o,g=F.useContext(p);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${r}\``)}return h.displayName=r+"Provider",[h,u]}const i=()=>{const r=t.map(a=>F.createContext(a));return function(o){const c=(o==null?void 0:o[n])||r;return F.useMemo(()=>({[`__scope${n}`]:{...o,[n]:c}}),[o,c])}};return i.scopeName=n,[s,eA(i,...e)]}function eA(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const s=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(r){const a=s.reduce((o,{useScope:c,scopeName:h})=>{const d=c(r)[`__scope${h}`];return{...o,...d}},{});return F.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function tA(n){const e=n+"CollectionProvider",[t,s]=mb(e),[i,r]=t(e,{collectionRef:{current:null},itemMap:new Map}),a=p=>{const{scope:g,children:y}=p,v=wr.useRef(null),w=wr.useRef(new Map).current;return k.jsx(i,{scope:g,itemMap:w,collectionRef:v,children:y})};a.displayName=e;const o=n+"CollectionSlot",c=wr.forwardRef((p,g)=>{const{scope:y,children:v}=p,w=r(o,y),A=wd(g,w.collectionRef);return k.jsx(sp,{ref:A,children:v})});c.displayName=o;const h=n+"CollectionItemSlot",u="data-radix-collection-item",d=wr.forwardRef((p,g)=>{const{scope:y,children:v,...w}=p,A=wr.useRef(null),x=wd(g,A),S=r(h,y);return wr.useEffect(()=>(S.itemMap.set(A,{ref:A,...w}),()=>void S.itemMap.delete(A))),k.jsx(sp,{[u]:"",ref:x,children:v})});d.displayName=h;function f(p){const g=r(n+"CollectionConsumer",p);return wr.useCallback(()=>{const v=g.collectionRef.current;if(!v)return[];const w=Array.from(v.querySelectorAll(`[${u}]`));return Array.from(g.itemMap.values()).sort((S,E)=>w.indexOf(S.ref.current)-w.indexOf(E.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:a,Slot:c,ItemSlot:d},f,s]}var ip=globalThis!=null&&globalThis.document?F.useLayoutEffect:()=>{},sA=G0.useId||(()=>{}),iA=0;function yb(n){const[e,t]=F.useState(sA());return ip(()=>{t(s=>s??String(iA++))},[n]),e?`radix-${e}`:""}var nA=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],qa=nA.reduce((n,e)=>{const t=F.forwardRef((s,i)=>{const{asChild:r,...a}=s,o=r?sp:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),k.jsx(o,{...a,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function Zg(n){const e=F.useRef(n);return F.useEffect(()=>{e.current=n}),F.useMemo(()=>(...t)=>{var s;return(s=e.current)==null?void 0:s.call(e,...t)},[])}function bb({prop:n,defaultProp:e,onChange:t=()=>{}}){const[s,i]=rA({defaultProp:e,onChange:t}),r=n!==void 0,a=r?n:s,o=Zg(t),c=F.useCallback(h=>{if(r){const d=typeof h=="function"?h(n):h;d!==n&&o(d)}else i(h)},[r,n,i,o]);return[a,c]}function rA({defaultProp:n,onChange:e}){const t=F.useState(n),[s]=t,i=F.useRef(s),r=Zg(e);return F.useEffect(()=>{i.current!==s&&(r(s),i.current=s)},[s,i,r]),t}var aA=F.createContext(void 0);function _b(n){const e=F.useContext(aA);return n||e||"ltr"}var Rf="rovingFocusGroup.onEntryFocus",oA={bubbles:!1,cancelable:!0},rf="RovingFocusGroup",[np,vb,lA]=tA(rf),[cA,wb]=mb(rf,[lA]),[hA,uA]=cA(rf),Ab=F.forwardRef((n,e)=>k.jsx(np.Provider,{scope:n.__scopeRovingFocusGroup,children:k.jsx(np.Slot,{scope:n.__scopeRovingFocusGroup,children:k.jsx(dA,{...n,ref:e})})}));Ab.displayName=rf;var dA=F.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:s,loop:i=!1,dir:r,currentTabStopId:a,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:c,onEntryFocus:h,preventScrollOnEntryFocus:u=!1,...d}=n,f=F.useRef(null),p=wd(e,f),g=_b(r),[y=null,v]=bb({prop:a,defaultProp:o,onChange:c}),[w,A]=F.useState(!1),x=Zg(h),S=vb(t),E=F.useRef(!1),[C,T]=F.useState(0);return F.useEffect(()=>{const P=f.current;if(P)return P.addEventListener(Rf,x),()=>P.removeEventListener(Rf,x)},[x]),k.jsx(hA,{scope:t,orientation:s,dir:g,loop:i,currentTabStopId:y,onItemFocus:F.useCallback(P=>v(P),[v]),onItemShiftTab:F.useCallback(()=>A(!0),[]),onFocusableItemAdd:F.useCallback(()=>T(P=>P+1),[]),onFocusableItemRemove:F.useCallback(()=>T(P=>P-1),[]),children:k.jsx(qa.div,{tabIndex:w||C===0?-1:0,"data-orientation":s,...d,ref:p,style:{outline:"none",...n.style},onMouseDown:mn(n.onMouseDown,()=>{E.current=!0}),onFocus:mn(n.onFocus,P=>{const O=!E.current;if(P.target===P.currentTarget&&O&&!w){const U=new CustomEvent(Rf,oA);if(P.currentTarget.dispatchEvent(U),!U.defaultPrevented){const M=S().filter(ge=>ge.focusable),re=M.find(ge=>ge.active),ae=M.find(ge=>ge.id===y),fe=[re,ae,...M].filter(Boolean).map(ge=>ge.ref.current);Eb(fe,u)}}E.current=!1}),onBlur:mn(n.onBlur,()=>A(!1))})})}),xb="RovingFocusGroupItem",Sb=F.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:s=!0,active:i=!1,tabStopId:r,...a}=n,o=yb(),c=r||o,h=uA(xb,t),u=h.currentTabStopId===c,d=vb(t),{onFocusableItemAdd:f,onFocusableItemRemove:p}=h;return F.useEffect(()=>{if(s)return f(),()=>p()},[s,f,p]),k.jsx(np.ItemSlot,{scope:t,id:c,focusable:s,active:i,children:k.jsx(qa.span,{tabIndex:u?0:-1,"data-orientation":h.orientation,...a,ref:e,onMouseDown:mn(n.onMouseDown,g=>{s?h.onItemFocus(c):g.preventDefault()}),onFocus:mn(n.onFocus,()=>h.onItemFocus(c)),onKeyDown:mn(n.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){h.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const y=gA(g,h.orientation,h.dir);if(y!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let w=d().filter(A=>A.focusable).map(A=>A.ref.current);if(y==="last")w.reverse();else if(y==="prev"||y==="next"){y==="prev"&&w.reverse();const A=w.indexOf(g.currentTarget);w=h.loop?mA(w,A+1):w.slice(A+1)}setTimeout(()=>Eb(w))}})})})});Sb.displayName=xb;var fA={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pA(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function gA(n,e,t){const s=pA(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return fA[s]}function Eb(n,e=!1){const t=document.activeElement;for(const s of n)if(s===t||(s.focus({preventScroll:e}),document.activeElement!==t))return}function mA(n,e){return n.map((t,s)=>n[(e+s)%n.length])}var yA=Ab,bA=Sb;function _A(n,e){return F.useReducer((t,s)=>e[t][s]??t,n)}var Cb=n=>{const{present:e,children:t}=n,s=vA(e),i=typeof t=="function"?t({present:s.isPresent}):F.Children.only(t),r=wd(s.ref,wA(i));return typeof t=="function"||s.isPresent?F.cloneElement(i,{ref:r}):null};Cb.displayName="Presence";function vA(n){const[e,t]=F.useState(),s=F.useRef({}),i=F.useRef(n),r=F.useRef("none"),a=n?"mounted":"unmounted",[o,c]=_A(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return F.useEffect(()=>{const h=xu(s.current);r.current=o==="mounted"?h:"none"},[o]),ip(()=>{const h=s.current,u=i.current;if(u!==n){const f=r.current,p=xu(h);n?c("MOUNT"):p==="none"||(h==null?void 0:h.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,c]),ip(()=>{if(e){let h;const u=e.ownerDocument.defaultView??window,d=p=>{const y=xu(s.current).includes(p.animationName);if(p.target===e&&y&&(c("ANIMATION_END"),!i.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",h=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(r.current=xu(s.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(h),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:F.useCallback(h=>{h&&(s.current=getComputedStyle(h)),t(h)},[])}}function xu(n){return(n==null?void 0:n.animationName)||"none"}function wA(n){var s,i;let e=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Yg="Tabs",[AA,oI]=J0(Yg,[wb]),kb=wb(),[xA,Jg]=AA(Yg),Tb=F.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,onValueChange:i,defaultValue:r,orientation:a="horizontal",dir:o,activationMode:c="automatic",...h}=n,u=_b(o),[d,f]=bb({prop:s,onChange:i,defaultProp:r});return k.jsx(xA,{scope:t,baseId:yb(),value:d,onValueChange:f,orientation:a,dir:u,activationMode:c,children:k.jsx(qa.div,{dir:u,"data-orientation":a,...h,ref:e})})});Tb.displayName=Yg;var Pb="TabsList",Rb=F.forwardRef((n,e)=>{const{__scopeTabs:t,loop:s=!0,...i}=n,r=Jg(Pb,t),a=kb(t);return k.jsx(yA,{asChild:!0,...a,orientation:r.orientation,dir:r.dir,loop:s,children:k.jsx(qa.div,{role:"tablist","aria-orientation":r.orientation,...i,ref:e})})});Rb.displayName=Pb;var Ib="TabsTrigger",Ob=F.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,disabled:i=!1,...r}=n,a=Jg(Ib,t),o=kb(t),c=Fb(a.baseId,s),h=Db(a.baseId,s),u=s===a.value;return k.jsx(bA,{asChild:!0,...o,focusable:!i,active:u,children:k.jsx(qa.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":h,"data-state":u?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:c,...r,ref:e,onMouseDown:mn(n.onMouseDown,d=>{!i&&d.button===0&&d.ctrlKey===!1?a.onValueChange(s):d.preventDefault()}),onKeyDown:mn(n.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&a.onValueChange(s)}),onFocus:mn(n.onFocus,()=>{const d=a.activationMode!=="manual";!u&&!i&&d&&a.onValueChange(s)})})})});Ob.displayName=Ib;var Mb="TabsContent",Lb=F.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,forceMount:i,children:r,...a}=n,o=Jg(Mb,t),c=Fb(o.baseId,s),h=Db(o.baseId,s),u=s===o.value,d=F.useRef(u);return F.useEffect(()=>{const f=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(f)},[]),k.jsx(Cb,{present:i||u,children:({present:f})=>k.jsx(qa.div,{"data-state":u?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":c,hidden:!f,id:h,tabIndex:0,...a,ref:e,style:{...n.style,animationDuration:d.current?"0s":void 0},children:f&&r})})});Lb.displayName=Mb;function Fb(n,e){return`${n}-trigger-${e}`}function Db(n,e){return`${n}-content-${e}`}var SA=Tb,Nb=Rb,jb=Ob,$b=Lb;const EA=SA,Ub=F.forwardRef(({className:n,...e},t)=>k.jsx(Nb,{ref:t,className:Ee("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",n),...e}));Ub.displayName=Nb.displayName;const rp=F.forwardRef(({className:n,...e},t)=>k.jsx(jb,{ref:t,className:Ee("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",n),...e}));rp.displayName=jb.displayName;const ap=F.forwardRef(({className:n,...e},t)=>k.jsx($b,{ref:t,className:Ee("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...e}));ap.displayName=$b.displayName;var CA="Label",Bb=F.forwardRef((n,e)=>k.jsx(qa.label,{...n,ref:e,onMouseDown:t=>{var i;t.target.closest("button, input, select, textarea")||((i=n.onMouseDown)==null||i.call(n,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Bb.displayName=CA;var Hb=Bb;const kA=X0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),rt=F.forwardRef(({className:n,...e},t)=>k.jsx(Hb,{ref:t,className:Ee(kA(),n),...e}));rt.displayName=Hb.displayName;const Qg=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("rounded-xl border bg-card text-card-foreground shadow",n),...e}));Qg.displayName="Card";const TA=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("flex flex-col space-y-1.5 p-6",n),...e}));TA.displayName="CardHeader";const PA=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("font-semibold leading-none tracking-tight",n),...e}));PA.displayName="CardTitle";const RA=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("text-sm text-muted-foreground",n),...e}));RA.displayName="CardDescription";const zb=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("p-6 pt-0",n),...e}));zb.displayName="CardContent";const IA=F.forwardRef(({className:n,...e},t)=>k.jsx("div",{ref:t,className:Ee("flex items-center p-6 pt-0",n),...e}));IA.displayName="CardFooter";const OA="modulepreload",MA=function(n){return"/"+n},Xm={},Ys=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=MA(c),c in Xm)return;Xm[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":OA,h||(d.as="script"),d.crossOrigin="",d.href=c,o&&d.setAttribute("nonce",o),document.head.appendChild(d),h)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},LA=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ys(async()=>{const{default:s}=await Promise.resolve().then(()=>jl);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class em extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class FA extends em{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class DA extends em{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class NA extends em{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var op;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(op||(op={}));var jA=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};class $A{constructor(e,{headers:t={},customFetch:s,region:i=op.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=LA(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return jA(this,void 0,void 0,function*(){try{const{headers:i,method:r,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let h;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(o["Content-Type"]="text/plain",h=a):typeof FormData<"u"&&a instanceof FormData?h=a:(o["Content-Type"]="application/json",h=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:h}).catch(g=>{throw new FA(g)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new DA(u);if(!u.ok)throw new NA(u);let f=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield u.json():f==="application/octet-stream"?p=yield u.blob():f==="text/event-stream"?p=u:f==="multipart/form-data"?p=yield u.formData():p=yield u.text(),{data:p,error:null}}catch(i){return{data:null,error:i}}})}}var Kt={},tm={},af={},du={},of={},lf={},UA=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ml=UA();const BA=Ml.fetch,qb=Ml.fetch.bind(Ml),Vb=Ml.Headers,HA=Ml.Request,zA=Ml.Response,jl=Object.freeze(Object.defineProperty({__proto__:null,Headers:Vb,Request:HA,Response:zA,default:qb,fetch:BA},Symbol.toStringTag,{value:"Module"})),qA=K0(jl);var cf={};Object.defineProperty(cf,"__esModule",{value:!0});class VA extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}cf.default=VA;var Wb=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(lf,"__esModule",{value:!0});const WA=Wb(qA),GA=Wb(cf);let XA=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=WA.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var a,o,c;let h=null,u=null,d=null,f=r.status,p=r.statusText;if(r.ok){if(this.method!=="HEAD"){const w=await r.text();w===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=w:u=JSON.parse(w))}const y=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),v=(o=r.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");y&&v&&v.length>1&&(d=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(h={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,f=406,p="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const y=await r.text();try{h=JSON.parse(y),Array.isArray(h)&&r.status===404&&(u=[],h=null,f=200,p="OK")}catch{r.status===404&&y===""?(f=204,p="No Content"):h={message:y}}if(h&&this.isMaybeSingle&&(!((c=h==null?void 0:h.details)===null||c===void 0)&&c.includes("0 rows"))&&(h=null,f=200,p="OK"),h&&this.shouldThrowOnError)throw new GA.default(h)}return{error:h,data:u,count:d,status:f,statusText:p}});return this.shouldThrowOnError||(i=i.catch(r=>{var a,o,c;return{error:{message:`${(a=r==null?void 0:r.name)!==null&&a!==void 0?a:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(o=r==null?void 0:r.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}};lf.default=XA;var KA=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(of,"__esModule",{value:!0});const ZA=KA(lf);let YA=class extends ZA.default{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:r=i}={}){const a=r?`${r}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const r=typeof i>"u"?"offset":`${i}.offset`,a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:r=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),h=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${h}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};of.default=YA;var JA=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(du,"__esModule",{value:!0});const QA=JA(of);let ex=class extends QA.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let r="";i==="plain"?r="pl":i==="phrase"?r="ph":i==="websearch"&&(r="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};du.default=ex;var tx=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(af,"__esModule",{value:!0});const Vl=tx(du);let sx=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let r=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!r?"":(o==='"'&&(r=!r),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new Vl.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Vl.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:r=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(c.length>0){const h=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",h.join(","))}}return new Vl.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new Vl.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new Vl.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};af.default=sx;var hf={},uf={};Object.defineProperty(uf,"__esModule",{value:!0});uf.version=void 0;uf.version="0.0.0-automated";Object.defineProperty(hf,"__esModule",{value:!0});hf.DEFAULT_HEADERS=void 0;const ix=uf;hf.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${ix.version}`};var Gb=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(tm,"__esModule",{value:!0});const nx=Gb(af),rx=Gb(du),ax=hf;let ox=class Xb{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},ax.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new nx.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Xb(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:r}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let c;s||i?(a=s?"HEAD":"GET",Object.entries(t).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{o.searchParams.append(u,d)})):(a="POST",c=t);const h=Object.assign({},this.headers);return r&&(h.Prefer=`count=${r}`),new rx.default({method:a,url:o,headers:h,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};tm.default=ox;var $l=Cs&&Cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.PostgrestError=Kt.PostgrestBuilder=Kt.PostgrestTransformBuilder=Kt.PostgrestFilterBuilder=Kt.PostgrestQueryBuilder=Kt.PostgrestClient=void 0;const Kb=$l(tm);Kt.PostgrestClient=Kb.default;const Zb=$l(af);Kt.PostgrestQueryBuilder=Zb.default;const Yb=$l(du);Kt.PostgrestFilterBuilder=Yb.default;const Jb=$l(of);Kt.PostgrestTransformBuilder=Jb.default;const Qb=$l(lf);Kt.PostgrestBuilder=Qb.default;const e_=$l(cf);Kt.PostgrestError=e_.default;var lx=Kt.default={PostgrestClient:Kb.default,PostgrestQueryBuilder:Zb.default,PostgrestFilterBuilder:Yb.default,PostgrestTransformBuilder:Jb.default,PostgrestBuilder:Qb.default,PostgrestError:e_.default};const{PostgrestClient:cx,PostgrestQueryBuilder:dI,PostgrestFilterBuilder:fI,PostgrestTransformBuilder:pI,PostgrestBuilder:gI}=lx,hx="2.10.7",ux={"X-Client-Info":`realtime-js/${hx}`},dx="1.0.0",t_=1e4,fx=1e3;var bo;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(bo||(bo={}));var es;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(es||(es={}));var Zs;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Zs||(Zs={}));var lp;(function(n){n.websocket="websocket"})(lp||(lp={}));var Pr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Pr||(Pr={}));class px{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const c=s.decode(e.slice(a,a+r));a=a+r;const h=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:h}}}class s_{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Te;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Te||(Te={}));const Km=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((r,a)=>(r[a]=gx(a,n,e,i),r),{})},gx=(n,e,t,s)=>{const i=e.find(o=>o.name===n),r=i==null?void 0:i.type,a=t[n];return r&&!s.includes(r)?i_(r,a):cp(a)},i_=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _x(e,t)}switch(n){case Te.bool:return mx(e);case Te.float4:case Te.float8:case Te.int2:case Te.int4:case Te.int8:case Te.numeric:case Te.oid:return yx(e);case Te.json:case Te.jsonb:return bx(e);case Te.timestamp:return vx(e);case Te.abstime:case Te.date:case Te.daterange:case Te.int4range:case Te.int8range:case Te.money:case Te.reltime:case Te.text:case Te.time:case Te.timestamptz:case Te.timetz:case Te.tsrange:case Te.tstzrange:return cp(e);default:return cp(e)}},cp=n=>n,mx=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},yx=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},bx=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_x=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let r;const a=n.slice(1,t);try{r=JSON.parse("["+a+"]")}catch{r=a?a.split(","):[]}return r.map(o=>i_(e,o))}return n},vx=n=>typeof n=="string"?n.replace(" ","T"):n,n_=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class If{constructor(e,t,s={},i=t_){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zm;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Zm||(Zm={}));class wc{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:r,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=wc.syncState(this.state,i,r,a),this.pendingDiffs.forEach(c=>{this.state=wc.syncDiff(this.state,c,r,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:r,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=wc.syncDiff(this.state,i,r,a),o())}),this.onJoin((i,r,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:a})}),this.onLeave((i,r,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const r=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(r,(h,u)=>{a[h]||(c[h]=u)}),this.map(a,(h,u)=>{const d=r[h];if(d){const f=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0),y=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(o[h]=g),y.length>0&&(c[h]=y)}else o[h]=u}),this.syncDiff(r,{joins:o,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,(o,c)=>{var h;const u=(h=e[o])!==null&&h!==void 0?h:[];if(e[o]=this.cloneDeep(c),u.length>0){const d=e[o].map(p=>p.presence_ref),f=u.filter(p=>d.indexOf(p.presence_ref)<0);e[o].unshift(...f)}s(o,u,c)}),this.map(a,(o,c)=>{let h=e[o];if(!h)return;const u=c.map(d=>d.presence_ref);h=h.filter(d=>u.indexOf(d.presence_ref)<0),e[o]=h,i(o,h,c),h.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ym;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ym||(Ym={}));var Jm;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Jm||(Jm={}));var Qm;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Qm||(Qm={}));class sm{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=es.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new If(this,Zs.join,this.params,this.timeout),this.rejoinTimer=new s_(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=es.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=es.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=es.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=es.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Zs.reply,{},(i,r)=>{this._trigger(this._replyEventName(r),i)}),this.presence=new wc(this),this.broadcastEndpointURL=n_(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:a,private:o}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const c={},h={broadcast:r,presence:a,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&i!==void 0?i:[],private:o};this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:h},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var d;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const f=this.bindings.postgres_changes,p=(d=f==null?void 0:f.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<p;y++){const v=f[y],{filter:{event:w,schema:A,table:x,filter:S}}=v,E=u&&u[y];if(E&&E.event===w&&E.schema===A&&E.table===x&&E.filter===S)g.push(Object.assign(Object.assign({},v),{id:E.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var a,o,c;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),h.receive("ok",()=>r("ok")),h.receive("error",()=>r("error")),h.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=es.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Zs.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new If(this,Zs.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new If(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:h,join:u}=Zs;if(s&&[o,c,h,u].indexOf(a)>=0&&s!==this._joinRef())return;let f=this._onMessage(a,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var g,y,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=p.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(p=>p.callback(f,s)):(r=this.bindings[a])===null||r===void 0||r.filter(p=>{var g,y,v,w,A,x;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in p){const S=p.id,E=(g=p.filter)===null||g===void 0?void 0:g.event;return S&&((y=t.ids)===null||y===void 0?void 0:y.includes(S))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const S=(A=(w=p==null?void 0:p.filter)===null||w===void 0?void 0:w.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return S==="*"||S===((x=t==null?void 0:t.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===a}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:y,table:v,commit_timestamp:w,type:A,errors:x}=g;f=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:A,new:{},old:{},errors:x}),this._getPayloadRecords(g))}p.callback(f,s)})}_isClosed(){return this.state===es.closed}_isJoined(){return this.state===es.joined}_isJoining(){return this.state===es.joining}_isLeaving(){return this.state===es.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===s&&sm.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Zs.close,{},e)}_onError(e){this._on(Zs.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=es.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Km(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Km(e.columns,e.old_record)),t}}const wx=()=>{},Ax=typeof WebSocket<"u",xx=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Sx{constructor(e,t){var s;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=ux,this.params={},this.timeout=t_,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=wx,this.conn=null,this.sendBuffer=[],this.serializer=new px,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=r=>{let a;return r?a=r:typeof fetch>"u"?a=(...o)=>Ys(async()=>{const{default:c}=await Promise.resolve().then(()=>jl);return{default:c}},void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${lp.websocket}`,this.httpEndpoint=n_(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(r,a)=>a(JSON.stringify(r)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new s_(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(Ax){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Ex(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Ys(async()=>{const{default:e}=await import("./browser-BlFWOIro.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1,2])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case bo.connecting:return Pr.Connecting;case bo.open:return Pr.Open;case bo.closing:return Pr.Closing;default:return Pr.Closed}}isConnected(){return this.connectionState()===Pr.Open}channel(e,t={config:{}}){const s=new sm(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:r}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Zs.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:dx}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:r,ref:a}=t;(a&&a===this.pendingHeartbeatRef||i===(r==null?void 0:r.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${s} ${i} ${a&&"("+a+")"||""}`,r),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(i,r,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Zs.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(fx,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([xx],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Ex{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=bo.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class im extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function dt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Cx extends im{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class hp extends im{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var kx=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};const r_=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ys(async()=>{const{default:s}=await Promise.resolve().then(()=>jl);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Tx=()=>kx(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ys(()=>Promise.resolve().then(()=>jl),void 0)).Response:Response}),up=n=>{if(Array.isArray(n))return n.map(t=>up(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[i]=up(s)}),e};var Va=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};const Of=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Px=(n,e,t)=>Va(void 0,void 0,void 0,function*(){const s=yield Tx();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{e(new Cx(Of(i),n.status||500))}).catch(i=>{e(new hp(Of(i),i))}):e(new hp(Of(n),n))}),Rx=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function fu(n,e,t,s,i,r){return Va(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Rx(e,s,i,r)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Px(c,o,s))})})}function Ad(n,e,t,s){return Va(this,void 0,void 0,function*(){return fu(n,"GET",e,t,s)})}function Rn(n,e,t,s,i){return Va(this,void 0,void 0,function*(){return fu(n,"POST",e,s,i,t)})}function Ix(n,e,t,s,i){return Va(this,void 0,void 0,function*(){return fu(n,"PUT",e,s,i,t)})}function Ox(n,e,t,s){return Va(this,void 0,void 0,function*(){return fu(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function a_(n,e,t,s,i){return Va(this,void 0,void 0,function*(){return fu(n,"DELETE",e,s,i,t)})}var Bt=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};const Mx={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ey={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Lx{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=r_(i)}uploadOrUpdate(e,t,s,i){return Bt(this,void 0,void 0,function*(){try{let r;const a=Object.assign(Object.assign({},ey),i);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(r=new FormData,r.append("cacheControl",a.cacheControl),c&&r.append("metadata",this.encodeMetadata(c)),r.append("",s)):typeof FormData<"u"&&s instanceof FormData?(r=s,r.append("cacheControl",a.cacheControl),c&&r.append("metadata",this.encodeMetadata(c))):(r=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(o=Object.assign(Object.assign({},o),i.headers));const h=this._removeEmptyFolders(t),u=this._getFinalPath(h),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:r,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield d.json();return d.ok?{data:{path:h,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(r){if(dt(r))return{data:null,error:r};throw r}})}upload(e,t,s){return Bt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return Bt(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),a=this._getFinalPath(r),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const h=Object.assign({upsert:ey.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",h.cacheControl)):(c=s,u["cache-control"]=`max-age=${h.cacheControl}`,u["content-type"]=h.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),f=yield d.json();return d.ok?{data:{path:r,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(dt(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Bt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=yield Rn(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(this.url+r.url),o=a.searchParams.get("token");if(!o)throw new im("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}})}update(e,t,s){return Bt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Bt(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(dt(i))return{data:null,error:i};throw i}})}copy(e,t,s){return Bt(this,void 0,void 0,function*(){try{return{data:{path:(yield Rn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(dt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return Bt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),r=yield Rn(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${a}`)},{data:r,error:null}}catch(i){if(dt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return Bt(this,void 0,void 0,function*(){try{const i=yield Rn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${r}`):null})),error:null}}catch(i){if(dt(i))return{data:null,error:i};throw i}})}download(e,t){return Bt(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=r?`?${r}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Ad(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(dt(o))return{data:null,error:o};throw o}})}info(e){return Bt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Ad(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:up(s),error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}})}exists(e){return Bt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ox(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(dt(s)&&s instanceof hp){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&i.push(r);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let h=i.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${h}`)}}}remove(e){return Bt(this,void 0,void 0,function*(){try{return{data:yield a_(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(dt(t))return{data:null,error:t};throw t}})}list(e,t,s){return Bt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Mx),t),{prefix:e||""});return{data:yield Rn(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(dt(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Fx="2.7.1",Dx={"X-Client-Info":`storage-js/${Fx}`};var Ja=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};class Nx{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Dx),t),this.fetch=r_(s)}listBuckets(){return Ja(this,void 0,void 0,function*(){try{return{data:yield Ad(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(dt(e))return{data:null,error:e};throw e}})}getBucket(e){return Ja(this,void 0,void 0,function*(){try{return{data:yield Ad(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(dt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ja(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Ja(this,void 0,void 0,function*(){try{return{data:yield Ix(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Ja(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(dt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ja(this,void 0,void 0,function*(){try{return{data:yield a_(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(dt(t))return{data:null,error:t};throw t}})}}class jx extends Nx{constructor(e,t={},s){super(e,t,s)}from(e){return new Lx(this.url,this.headers,e,this.fetch)}}const $x="2.46.1";let Zl="";typeof Deno<"u"?Zl="deno":typeof document<"u"?Zl="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Zl="react-native":Zl="node";const Ux={"X-Client-Info":`supabase-js-${Zl}/${$x}`},Bx={headers:Ux},Hx={schema:"public"},zx={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},qx={};var Vx=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};const Wx=n=>{let e;return n?e=n:typeof fetch>"u"?e=qb:e=fetch,(...t)=>e(...t)},Gx=()=>typeof Headers>"u"?Vb:Headers,Xx=(n,e,t)=>{const s=Wx(t),i=Gx();return(r,a)=>Vx(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let h=new i(a==null?void 0:a.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),s(r,Object.assign(Object.assign({},a),{headers:h}))})};var Kx=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};function Zx(n){return n.replace(/\/$/,"")}function Yx(n,e){const{db:t,auth:s,realtime:i,global:r}=n,{db:a,auth:o,realtime:c,global:h}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),i),global:Object.assign(Object.assign({},h),r),accessToken:()=>Kx(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const o_="2.65.1",Jx="http://localhost:9999",Qx="supabase.auth.token",eS={"X-Client-Info":`gotrue-js/${o_}`},ty=10,dp="X-Supabase-Api-Version",l_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function tS(n){return Math.round(Date.now()/1e3)+n}function sS(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Rs=()=>typeof document<"u",Ar={tested:!1,writable:!1},Ac=()=>{if(!Rs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ar.tested)return Ar.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ar.tested=!0,Ar.writable=!0}catch{Ar.tested=!0,Ar.writable=!1}return Ar.writable};function Mf(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,r)=>{e[r]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const c_=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ys(async()=>{const{default:s}=await Promise.resolve().then(()=>jl);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},iS=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",h_=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Su=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Eu=async(n,e)=>{await n.removeItem(e)};function nS(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,r,a,o,c,h,u=0;for(n=n.replace("-","+").replace("_","/");u<n.length;)a=e.indexOf(n.charAt(u++)),o=e.indexOf(n.charAt(u++)),c=e.indexOf(n.charAt(u++)),h=e.indexOf(n.charAt(u++)),s=a<<2|o>>4,i=(o&15)<<4|c>>2,r=(c&3)<<6|h,t=t+String.fromCharCode(s),c!=64&&i!=0&&(t=t+String.fromCharCode(i)),h!=64&&r!=0&&(t=t+String.fromCharCode(r));return t}class df{constructor(){this.promise=new df.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}df.promiseConstructor=Promise;function sy(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(nS(s))}async function rS(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function aS(n,e){return new Promise((s,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const a=await n(r);if(!e(r,null,a)){s(a);return}}catch(a){if(!e(r,a)){i(a);return}}})()})}function oS(n){return("0"+n.toString(16)).substr(-2)}function lS(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let r=0;r<56;r++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,oS).join("")}async function cS(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}function hS(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function uS(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await cS(n);return hS(t)}async function Qa(n,e,t=!1){const s=lS();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await h_(n,`${e}-code-verifier`,i);const r=await uS(s);return[r,s===r?"plain":"s256"]}const dS=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function fS(n){const e=n.headers.get(dp);if(!e||!e.match(dS))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class nm extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function se(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class pS extends nm{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function gS(n){return se(n)&&n.name==="AuthApiError"}class u_ extends nm{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Wa extends nm{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class En extends Wa{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function mS(n){return se(n)&&n.name==="AuthSessionMissingError"}class Lf extends Wa{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Cu extends Wa{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ku extends Wa{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class iy extends Wa{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class fp extends Wa{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ff(n){return se(n)&&n.name==="AuthRetryableFetchError"}class ny extends Wa{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var yS=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const Sr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),bS=[502,503,504];async function ry(n){var e;if(!iS(n))throw new fp(Sr(n),0);if(bS.includes(n.status))throw new fp(Sr(n),n.status);let t;try{t=await n.json()}catch(r){throw new u_(Sr(r),r)}let s;const i=fS(n);if(i&&i.getTime()>=l_["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new ny(Sr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new En}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0))throw new ny(Sr(t),n.status,t.weak_password.reasons);throw new pS(Sr(t),n.status||500,s)}const _S=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function ce(n,e,t,s){var i;const r=Object.assign({},s==null?void 0:s.headers);r[dp]||(r[dp]=l_["2024-01-01"].name),s!=null&&s.jwt&&(r.Authorization=`Bearer ${s.jwt}`);const a=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await vS(n,e,t+o,{headers:r,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function vS(n,e,t,s,i,r){const a=_S(e,s,i,r);let o;try{o=await n(t,Object.assign({},a))}catch(c){throw console.error(c),new fp(Sr(c),0)}if(o.ok||await ry(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await ry(c)}}function Cn(n){var e;let t=null;SS(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=tS(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function ay(n){const e=Cn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function In(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function wS(n){return{data:n,error:null}}function AS(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r}=n,a=yS(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function xS(n){return n}function SS(n){return n.access_token&&n.refresh_token&&n.expires_in}var ES=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class CS{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=c_(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await ce(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await ce(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:In})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ES(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await ce(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:AS,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(se(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ce(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:In})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,a,o,c;try{const h={nextPage:null,lastPage:0,total:0},u=await ce(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:xS});if(u.error)throw u.error;const d=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,p=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);h[`${v}Page`]=y}),h.total=parseInt(f)),{data:Object.assign(Object.assign({},d),h),error:null}}catch(h){if(se(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await ce(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:In})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await ce(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:In})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await ce(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:In})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await ce(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(se(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await ce(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}}const kS={getItem:n=>Ac()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ac()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ac()&&globalThis.localStorage.removeItem(n)}};function oy(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function TS(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const eo={debug:!!(globalThis&&Ac()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class d_ extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class PS extends d_{}async function RS(n,e,t){eo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),eo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){eo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{eo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw eo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new PS(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(eo.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}TS();const IS={url:Jx,storageKey:Qx,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Wl=30*1e3,ly=3;async function cy(n,e,t){return await t()}class Tc{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Tc.nextInstanceID,Tc.nextInstanceID+=1,this.instanceID>0&&Rs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},IS),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new CS({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=c_(i.fetch),this.lock=i.lock||cy,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Rs()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=RS:this.lock=cy,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Ac()?this.storage=kS:(this.memoryStorage={},this.storage=oy(this.memoryStorage)):(this.memoryStorage={},this.storage=oy(this.memoryStorage)),Rs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${o_}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Rs()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),(s==null?void 0:s.code)==="identity_already_exists"?{error:s}:(await this._removeSession(),{error:s});const{session:i,redirectType:r}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",r),await this._saveSession(i),setTimeout(async()=>{r==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return se(e)?{error:e}:{error:new u_("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Cn}),{data:a,error:o}=r;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:u,password:d,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Qa(this.storage,this.storageKey)),r=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:g},xform:Cn})}else if("phone"in e){const{phone:u,password:d,options:f}=e;r=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Cn})}else throw new Cu("You must provide either an email or phone number and a password");const{data:a,error:o}=r;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:a,options:o}=e;t=await ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ay})}else if("phone"in e){const{phone:r,password:a,options:o}=e;t=await ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ay})}else throw new Cu("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Lf}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Su(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:r,error:a}=await ce(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Cn});if(await Eu(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new Lf}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:a})}catch(r){if(se(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:a}=e,o=await ce(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Cn}),{data:c,error:h}=o;return h?{data:{user:null,session:null},error:h}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Lf}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:h})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,a;try{if("email"in e){const{email:o,options:c}=e;let h=null,u=null;this.flowType==="pkce"&&([h,u]=await Qa(this.storage,this.storageKey));const{error:d}=await ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:h,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:o,options:c}=e,{data:h,error:u}=await ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:u}}throw new Cu("You must provide either an email or phone number.")}catch(o){if(se(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await ce(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:Cn});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,h=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(i){if(se(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,a=null;return this.flowType==="pkce"&&([r,a]=await Qa(this.storage,this.storageKey)),await ce(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:a}),headers:this.headers,xform:wS})}catch(r){if(se(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new En;const{error:i}=await ce(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(se(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:a}=await ce(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:i,options:r}=e,{data:a,error:o}=await ce(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Cu("You must provide either an email or phone number and a type")}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Su(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,h,u)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,h,u))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:In}):await this._useSession(async t=>{var s,i,r;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new En}:await ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:In})})}catch(t){if(se(t))return mS(t)&&(await this._removeSession(),await Eu(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new En;const a=i.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Qa(this.storage,this.storageKey));const{data:h,error:u}=await ce(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:In});if(u)throw u;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return sy(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new En;const t=Date.now()/1e3;let s=t,i=!0,r=null;const a=sy(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};r=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(se(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new En;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Rs())throw new ku("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new ku("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new iy("Not a valid PKCE flow url.");const t=Mf(window.location.href);if(e){if(!t.code)throw new iy("No code detected.");const{data:A,error:x}=await this._exchangeCodeForSession(t.code);if(x)throw x;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:A.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new ku(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:a,expires_in:o,expires_at:c,token_type:h}=t;if(!r||!o||!a||!h)throw new ku("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(o);let f=u+d;c&&(f=parseInt(c));const p=f-u;p*1e3<=Wl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=f-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:y,error:v}=await this._getUser(r);if(v)throw v;const w={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:d,expires_at:f,refresh_token:a,token_type:h,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:t.type},error:null}}catch(t){if(se(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Mf(window.location.href);return!!(Rs()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Mf(window.location.href),t=await Su(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(gS(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Eu(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=sS(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:r},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await Qa(this.storage,this.storageKey,!0));try{return await ce(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(se(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async r=>{var a,o,c,h,u;const{data:d,error:f}=r;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ce(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(h=d.session)===null||h===void 0?void 0:h.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return Rs()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(se(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:a}=t;if(a)throw a;return await ce(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await aS(async i=>(i>0&&await rS(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await ce(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Cn})),(i,r)=>{const a=200*Math.pow(2,i);return r&&Ff(r)&&Date.now()+a-s<Wl})}catch(s){if(this._debug(t,"error",s),se(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Rs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Su(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),r=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+ty;if(this._debug(t,`session has${r?"":" not"} expired with margin of ${ty}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Ff(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new En;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new df;const{data:r,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!r.session)throw new En;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const o={session:r.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(r){if(this._debug(i,"error",r),se(r)){const a={session:null,error:r};return Ff(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){r.push(c)}});if(await Promise.all(a),r.length>0){for(let o=0;o<r.length;o+=1)console.error(r[o]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await h_(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Eu(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Rs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Wl);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/Wl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Wl}ms, refresh threshold is ${ly} ticks`),i<=ly&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof d_)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Rs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[r,a]=await Qa(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s!=null&&s.queryParams){const r=new URLSearchParams(s.queryParams);i.push(r.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await ce(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:h}=await ce(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:a,error:o}=await ce(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await ce(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),r=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(i.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Tc.nextInstanceID=0;const OS=Tc;class MS extends OS{constructor(e){super(e)}}var LS=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?r(u.value):i(u.value).then(o,c)}h((s=s.apply(n,e||[])).next())})};class FS{constructor(e,t,s){var i,r,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Zx(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,h={db:Hx,realtime:qx,auth:Object.assign(Object.assign({},zx),{storageKey:c}),global:Bx},u=Yx(s??{},h);this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(r=u.global.headers)!==null&&r!==void 0?r:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=Xx(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new cx(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new $A(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new jx(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return LS(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:a,lock:o,debug:c},h,u){var d;const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new MS({url:this.authUrl,headers:Object.assign(Object.assign({},f),h),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:(d="Authorization"in this.headers)!==null&&d!==void 0?d:!1})}_initRealtimeClient(e){return new Sx(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const DS=(n,e,t)=>new FS(n,e,t);let Df=null;async function f_(){if(!Df){const n=await Mr.storage.sync.get("supabaseKey"),e=await Mr.storage.sync.get("supabaseUrl");Df=DS(e.supabaseUrl,n.supabaseKey)}return Df}async function NS(n,e){let s=(await f_()).from(n).select("*");e&&Object.entries(e).forEach(([a,o])=>{s=s.eq(a,o)});const{data:i,error:r}=await s;if(r)throw r;return i}async function jS(n,e,t){let i=(await f_()).from(n).update(t);Object.entries(e).forEach(([o,c])=>{i=i.eq(o,c)});const{data:r,error:a}=await i;if(a)throw a;return r}var ue;(function(n){n.assertEqual=i=>i;function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const r={};for(const a of i)r[a]=a;return r},n.getValidEnumValues=i=>{const r=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(const o of r)a[o]=i[o];return n.objectValues(a)},n.objectValues=i=>n.objectKeys(i).map(function(r){return i[r]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const r=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&r.push(a);return r},n.find=(i,r)=>{for(const a of i)if(r(a))return a},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function s(i,r=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(r)}n.joinValues=s,n.jsonStringifyReplacer=(i,r)=>typeof r=="bigint"?r.toString():r})(ue||(ue={}));var pp;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(pp||(pp={}));const j=ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),On=n=>{switch(typeof n){case"undefined":return j.undefined;case"string":return j.string;case"number":return isNaN(n)?j.nan:j.number;case"boolean":return j.boolean;case"function":return j.function;case"bigint":return j.bigint;case"symbol":return j.symbol;case"object":return Array.isArray(n)?j.array:n===null?j.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?j.promise:typeof Map<"u"&&n instanceof Map?j.map:typeof Set<"u"&&n instanceof Set?j.set:typeof Date<"u"&&n instanceof Date?j.date:j.object;default:return j.unknown}},R=ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),$S=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class fs extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(r){return r.message},s={_errors:[]},i=r=>{for(const a of r.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,c=0;for(;c<a.path.length;){const h=a.path[c];c===a.path.length-1?(o[h]=o[h]||{_errors:[]},o[h]._errors.push(t(a))):o[h]=o[h]||{_errors:[]},o=o[h],c++}}};return i(this),s}static assert(e){if(!(e instanceof fs))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):s.push(e(i));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}fs.create=n=>new fs(n);const Ll=(n,e)=>{let t;switch(n.code){case R.invalid_type:n.received===j.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case R.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ue.jsonStringifyReplacer)}`;break;case R.unrecognized_keys:t=`Unrecognized key(s) in object: ${ue.joinValues(n.keys,", ")}`;break;case R.invalid_union:t="Invalid input";break;case R.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ue.joinValues(n.options)}`;break;case R.invalid_enum_value:t=`Invalid enum value. Expected ${ue.joinValues(n.options)}, received '${n.received}'`;break;case R.invalid_arguments:t="Invalid function arguments";break;case R.invalid_return_type:t="Invalid function return type";break;case R.invalid_date:t="Invalid date";break;case R.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ue.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case R.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case R.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case R.custom:t="Invalid input";break;case R.invalid_intersection_types:t="Intersection results could not be merged";break;case R.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case R.not_finite:t="Number must be finite";break;default:t=e.defaultError,ue.assertNever(n)}return{message:t}};let p_=Ll;function US(n){p_=n}function xd(){return p_}const Sd=n=>{const{data:e,path:t,errorMaps:s,issueData:i}=n,r=[...t,...i.path||[]],a={...i,path:r};if(i.message!==void 0)return{...i,path:r,message:i.message};let o="";const c=s.filter(h=>!!h).slice().reverse();for(const h of c)o=h(a,{data:e,defaultError:o}).message;return{...i,path:r,message:o}},BS=[];function N(n,e){const t=xd(),s=Sd({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Ll?void 0:Ll].filter(i=>!!i)});n.common.issues.push(s)}class Rt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const i of t){if(i.status==="aborted")return V;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const i of t){const r=await i.key,a=await i.value;s.push({key:r,value:a})}return Rt.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const i of t){const{key:r,value:a}=i;if(r.status==="aborted"||a.status==="aborted")return V;r.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),r.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(s[r.value]=a.value)}return{status:e.value,value:s}}}const V=Object.freeze({status:"aborted"}),go=n=>({status:"dirty",value:n}),$t=n=>({status:"valid",value:n}),gp=n=>n.status==="aborted",mp=n=>n.status==="dirty",Pc=n=>n.status==="valid",Rc=n=>typeof Promise<"u"&&n instanceof Promise;function Ed(n,e,t,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function g_(n,e,t,s,i){if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var H;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(H||(H={}));var Yl,Jl;class Oi{constructor(e,t,s,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const hy=(n,e)=>{if(Pc(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new fs(n.common.issues);return this._error=t,this._error}}};function Y(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:i}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var c,h;const{message:u}=n;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??s)!==null&&c!==void 0?c:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(h=u??t)!==null&&h!==void 0?h:o.defaultError}},description:i}}class te{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return On(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:On(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Rt,ctx:{common:e.parent.common,data:e.data,parsedType:On(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Rc(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const i={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:On(e)},r=this._parseSync({data:e,path:i.path,parent:i});return hy(i,r)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:On(e)},i=this._parse({data:e,path:s.path,parent:s}),r=await(Rc(i)?i:Promise.resolve(i));return hy(s,r)}refine(e,t){const s=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,r)=>{const a=e(i),o=()=>r.addIssue({code:R.custom,...s(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof t=="function"?t(s,i):t),!1))}_refinement(e){return new ii({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ii.create(this,this._def)}nullable(){return gr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return si.create(this,this._def)}promise(){return Dl.create(this,this._def)}or(e){return Lc.create([this,e],this._def)}and(e){return Fc.create(this,e,this._def)}transform(e){return new ii({...Y(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Uc({...Y(this._def),innerType:this,defaultValue:t,typeName:I.ZodDefault})}brand(){return new rm({typeName:I.ZodBranded,type:this,...Y(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Bc({...Y(this._def),innerType:this,catchValue:t,typeName:I.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return pu.create(this,e)}readonly(){return Hc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const HS=/^c[^\s-]{8,}$/i,zS=/^[0-9a-z]+$/,qS=/^[0-9A-HJKMNP-TV-Z]{26}$/,VS=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,WS=/^[a-z0-9_-]{21}$/i,GS=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,XS=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,KS="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Nf;const ZS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,YS=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,JS=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,m_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",QS=new RegExp(`^${m_}$`);function y_(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function eE(n){return new RegExp(`^${y_(n)}$`)}function b_(n){let e=`${m_}T${y_(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function tE(n,e){return!!((e==="v4"||!e)&&ZS.test(n)||(e==="v6"||!e)&&YS.test(n))}class Js extends te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==j.string){const r=this._getOrReturnCtx(e);return N(r,{code:R.invalid_type,expected:j.string,received:r.parsedType}),V}const s=new Rt;let i;for(const r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(i=this._getOrReturnCtx(e,i),N(i,{code:R.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="max")e.data.length>r.value&&(i=this._getOrReturnCtx(e,i),N(i,{code:R.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="length"){const a=e.data.length>r.value,o=e.data.length<r.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?N(i,{code:R.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):o&&N(i,{code:R.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),s.dirty())}else if(r.kind==="email")XS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"email",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="emoji")Nf||(Nf=new RegExp(KS,"u")),Nf.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"emoji",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="uuid")VS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"uuid",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="nanoid")WS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"nanoid",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid")HS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"cuid",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid2")zS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"cuid2",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="ulid")qS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"ulid",code:R.invalid_string,message:r.message}),s.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),N(i,{validation:"url",code:R.invalid_string,message:r.message}),s.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"regex",code:R.invalid_string,message:r.message}),s.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),s.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:{startsWith:r.value},message:r.message}),s.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:{endsWith:r.value},message:r.message}),s.dirty()):r.kind==="datetime"?b_(r).test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:"datetime",message:r.message}),s.dirty()):r.kind==="date"?QS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:"date",message:r.message}),s.dirty()):r.kind==="time"?eE(r).test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{code:R.invalid_string,validation:"time",message:r.message}),s.dirty()):r.kind==="duration"?GS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"duration",code:R.invalid_string,message:r.message}),s.dirty()):r.kind==="ip"?tE(e.data,r.version)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"ip",code:R.invalid_string,message:r.message}),s.dirty()):r.kind==="base64"?JS.test(e.data)||(i=this._getOrReturnCtx(e,i),N(i,{validation:"base64",code:R.invalid_string,message:r.message}),s.dirty()):ue.assertNever(r);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(i=>e.test(i),{validation:t,code:R.invalid_string,...H.errToObj(s)})}_addCheck(e){return new Js({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...H.errToObj(e)})}url(e){return this._addCheck({kind:"url",...H.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...H.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...H.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...H.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...H.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...H.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...H.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...H.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...H.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...H.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...H.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...H.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...H.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...H.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...H.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...H.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...H.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...H.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...H.errToObj(t)})}nonempty(e){return this.min(1,H.errToObj(e))}trim(){return new Js({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Js({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Js({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Js.create=n=>{var e;return new Js({checks:[],typeName:I.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Y(n)})};function sE(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=t>s?t:s,r=parseInt(n.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return r%a/Math.pow(10,i)}class dr extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==j.number){const r=this._getOrReturnCtx(e);return N(r,{code:R.invalid_type,expected:j.number,received:r.parsedType}),V}let s;const i=new Rt;for(const r of this._def.checks)r.kind==="int"?ue.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),N(s,{code:R.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="multipleOf"?sE(e.data,r.value)!==0&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),N(s,{code:R.not_finite,message:r.message}),i.dirty()):ue.assertNever(r);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,H.toString(t))}gt(e,t){return this.setLimit("min",e,!1,H.toString(t))}lte(e,t){return this.setLimit("max",e,!0,H.toString(t))}lt(e,t){return this.setLimit("max",e,!1,H.toString(t))}setLimit(e,t,s,i){return new dr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:H.toString(i)}]})}_addCheck(e){return new dr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:H.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:H.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:H.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:H.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:H.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ue.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}dr.create=n=>new dr({checks:[],typeName:I.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Y(n)});class fr extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==j.bigint){const r=this._getOrReturnCtx(e);return N(r,{code:R.invalid_type,expected:j.bigint,received:r.parsedType}),V}let s;const i=new Rt;for(const r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),N(s,{code:R.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):ue.assertNever(r);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,H.toString(t))}gt(e,t){return this.setLimit("min",e,!1,H.toString(t))}lte(e,t){return this.setLimit("max",e,!0,H.toString(t))}lt(e,t){return this.setLimit("max",e,!1,H.toString(t))}setLimit(e,t,s,i){return new fr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:H.toString(i)}]})}_addCheck(e){return new fr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:H.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}fr.create=n=>{var e;return new fr({checks:[],typeName:I.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Y(n)})};class Ic extends te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==j.boolean){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.boolean,received:s.parsedType}),V}return $t(e.data)}}Ic.create=n=>new Ic({typeName:I.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Y(n)});class Da extends te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==j.date){const r=this._getOrReturnCtx(e);return N(r,{code:R.invalid_type,expected:j.date,received:r.parsedType}),V}if(isNaN(e.data.getTime())){const r=this._getOrReturnCtx(e);return N(r,{code:R.invalid_date}),V}const s=new Rt;let i;for(const r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(i=this._getOrReturnCtx(e,i),N(i,{code:R.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),s.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(i=this._getOrReturnCtx(e,i),N(i,{code:R.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),s.dirty()):ue.assertNever(r);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Da({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:H.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:H.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Da.create=n=>new Da({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:I.ZodDate,...Y(n)});class Cd extends te{_parse(e){if(this._getType(e)!==j.symbol){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.symbol,received:s.parsedType}),V}return $t(e.data)}}Cd.create=n=>new Cd({typeName:I.ZodSymbol,...Y(n)});class Oc extends te{_parse(e){if(this._getType(e)!==j.undefined){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.undefined,received:s.parsedType}),V}return $t(e.data)}}Oc.create=n=>new Oc({typeName:I.ZodUndefined,...Y(n)});class Mc extends te{_parse(e){if(this._getType(e)!==j.null){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.null,received:s.parsedType}),V}return $t(e.data)}}Mc.create=n=>new Mc({typeName:I.ZodNull,...Y(n)});class Fl extends te{constructor(){super(...arguments),this._any=!0}_parse(e){return $t(e.data)}}Fl.create=n=>new Fl({typeName:I.ZodAny,...Y(n)});class Fa extends te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $t(e.data)}}Fa.create=n=>new Fa({typeName:I.ZodUnknown,...Y(n)});class vn extends te{_parse(e){const t=this._getOrReturnCtx(e);return N(t,{code:R.invalid_type,expected:j.never,received:t.parsedType}),V}}vn.create=n=>new vn({typeName:I.ZodNever,...Y(n)});class kd extends te{_parse(e){if(this._getType(e)!==j.undefined){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.void,received:s.parsedType}),V}return $t(e.data)}}kd.create=n=>new kd({typeName:I.ZodVoid,...Y(n)});class si extends te{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),i=this._def;if(t.parsedType!==j.array)return N(t,{code:R.invalid_type,expected:j.array,received:t.parsedType}),V;if(i.exactLength!==null){const a=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(a||o)&&(N(t,{code:a?R.too_big:R.too_small,minimum:o?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(N(t,{code:R.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(N(t,{code:R.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>i.type._parseAsync(new Oi(t,a,t.path,o)))).then(a=>Rt.mergeArray(s,a));const r=[...t.data].map((a,o)=>i.type._parseSync(new Oi(t,a,t.path,o)));return Rt.mergeArray(s,r)}get element(){return this._def.type}min(e,t){return new si({...this._def,minLength:{value:e,message:H.toString(t)}})}max(e,t){return new si({...this._def,maxLength:{value:e,message:H.toString(t)}})}length(e,t){return new si({...this._def,exactLength:{value:e,message:H.toString(t)}})}nonempty(e){return this.min(1,e)}}si.create=(n,e)=>new si({type:n,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...Y(e)});function io(n){if(n instanceof $e){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=Ii.create(io(s))}return new $e({...n._def,shape:()=>e})}else return n instanceof si?new si({...n._def,type:io(n.element)}):n instanceof Ii?Ii.create(io(n.unwrap())):n instanceof gr?gr.create(io(n.unwrap())):n instanceof Mi?Mi.create(n.items.map(e=>io(e))):n}class $e extends te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ue.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==j.object){const h=this._getOrReturnCtx(e);return N(h,{code:R.invalid_type,expected:j.object,received:h.parsedType}),V}const{status:s,ctx:i}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof vn&&this._def.unknownKeys==="strip"))for(const h in i.data)a.includes(h)||o.push(h);const c=[];for(const h of a){const u=r[h],d=i.data[h];c.push({key:{status:"valid",value:h},value:u._parse(new Oi(i,d,i.path,h)),alwaysSet:h in i.data})}if(this._def.catchall instanceof vn){const h=this._def.unknownKeys;if(h==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:i.data[u]}});else if(h==="strict")o.length>0&&(N(i,{code:R.unrecognized_keys,keys:o}),s.dirty());else if(h!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const h=this._def.catchall;for(const u of o){const d=i.data[u];c.push({key:{status:"valid",value:u},value:h._parse(new Oi(i,d,i.path,u)),alwaysSet:u in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const h=[];for(const u of c){const d=await u.key,f=await u.value;h.push({key:d,value:f,alwaysSet:u.alwaysSet})}return h}).then(h=>Rt.mergeObjectSync(s,h)):Rt.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return H.errToObj,new $e({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var i,r,a,o;const c=(a=(r=(i=this._def).errorMap)===null||r===void 0?void 0:r.call(i,t,s).message)!==null&&a!==void 0?a:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=H.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new $e({...this._def,unknownKeys:"strip"})}passthrough(){return new $e({...this._def,unknownKeys:"passthrough"})}extend(e){return new $e({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $e({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new $e({...this._def,catchall:e})}pick(e){const t={};return ue.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new $e({...this._def,shape:()=>t})}omit(e){const t={};return ue.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new $e({...this._def,shape:()=>t})}deepPartial(){return io(this)}partial(e){const t={};return ue.objectKeys(this.shape).forEach(s=>{const i=this.shape[s];e&&!e[s]?t[s]=i:t[s]=i.optional()}),new $e({...this._def,shape:()=>t})}required(e){const t={};return ue.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let r=this.shape[s];for(;r instanceof Ii;)r=r._def.innerType;t[s]=r}}),new $e({...this._def,shape:()=>t})}keyof(){return __(ue.objectKeys(this.shape))}}$e.create=(n,e)=>new $e({shape:()=>n,unknownKeys:"strip",catchall:vn.create(),typeName:I.ZodObject,...Y(e)});$e.strictCreate=(n,e)=>new $e({shape:()=>n,unknownKeys:"strict",catchall:vn.create(),typeName:I.ZodObject,...Y(e)});$e.lazycreate=(n,e)=>new $e({shape:n,unknownKeys:"strip",catchall:vn.create(),typeName:I.ZodObject,...Y(e)});class Lc extends te{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function i(r){for(const o of r)if(o.result.status==="valid")return o.result;for(const o of r)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=r.map(o=>new fs(o.ctx.common.issues));return N(t,{code:R.invalid_union,unionErrors:a}),V}if(t.common.async)return Promise.all(s.map(async r=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await r._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(i);{let r;const a=[];for(const c of s){const h={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:h});if(u.status==="valid")return u;u.status==="dirty"&&!r&&(r={result:u,ctx:h}),h.common.issues.length&&a.push(h.common.issues)}if(r)return t.common.issues.push(...r.ctx.common.issues),r.result;const o=a.map(c=>new fs(c));return N(t,{code:R.invalid_union,unionErrors:o}),V}}get options(){return this._def.options}}Lc.create=(n,e)=>new Lc({options:n,typeName:I.ZodUnion,...Y(e)});const ji=n=>n instanceof Nc?ji(n.schema):n instanceof ii?ji(n.innerType()):n instanceof jc?[n.value]:n instanceof pr?n.options:n instanceof $c?ue.objectValues(n.enum):n instanceof Uc?ji(n._def.innerType):n instanceof Oc?[void 0]:n instanceof Mc?[null]:n instanceof Ii?[void 0,...ji(n.unwrap())]:n instanceof gr?[null,...ji(n.unwrap())]:n instanceof rm||n instanceof Hc?ji(n.unwrap()):n instanceof Bc?ji(n._def.innerType):[];class ff extends te{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==j.object)return N(t,{code:R.invalid_type,expected:j.object,received:t.parsedType}),V;const s=this.discriminator,i=t.data[s],r=this.optionsMap.get(i);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(N(t,{code:R.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),V)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const i=new Map;for(const r of t){const a=ji(r.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,r)}}return new ff({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Y(s)})}}function yp(n,e){const t=On(n),s=On(e);if(n===e)return{valid:!0,data:n};if(t===j.object&&s===j.object){const i=ue.objectKeys(e),r=ue.objectKeys(n).filter(o=>i.indexOf(o)!==-1),a={...n,...e};for(const o of r){const c=yp(n[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===j.array&&s===j.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let r=0;r<n.length;r++){const a=n[r],o=e[r],c=yp(a,o);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===j.date&&s===j.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Fc extends te{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),i=(r,a)=>{if(gp(r)||gp(a))return V;const o=yp(r.value,a.value);return o.valid?((mp(r)||mp(a))&&t.dirty(),{status:t.value,value:o.data}):(N(s,{code:R.invalid_intersection_types}),V)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([r,a])=>i(r,a)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Fc.create=(n,e,t)=>new Fc({left:n,right:e,typeName:I.ZodIntersection,...Y(t)});class Mi extends te{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==j.array)return N(s,{code:R.invalid_type,expected:j.array,received:s.parsedType}),V;if(s.data.length<this._def.items.length)return N(s,{code:R.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),V;!this._def.rest&&s.data.length>this._def.items.length&&(N(s,{code:R.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...s.data].map((a,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new Oi(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(r).then(a=>Rt.mergeArray(t,a)):Rt.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Mi({...this._def,rest:e})}}Mi.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Mi({items:n,typeName:I.ZodTuple,rest:null,...Y(e)})};class Dc extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==j.object)return N(s,{code:R.invalid_type,expected:j.object,received:s.parsedType}),V;const i=[],r=this._def.keyType,a=this._def.valueType;for(const o in s.data)i.push({key:r._parse(new Oi(s,o,s.path,o)),value:a._parse(new Oi(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?Rt.mergeObjectAsync(t,i):Rt.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof te?new Dc({keyType:e,valueType:t,typeName:I.ZodRecord,...Y(s)}):new Dc({keyType:Js.create(),valueType:e,typeName:I.ZodRecord,...Y(t)})}}class Td extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==j.map)return N(s,{code:R.invalid_type,expected:j.map,received:s.parsedType}),V;const i=this._def.keyType,r=this._def.valueType,a=[...s.data.entries()].map(([o,c],h)=>({key:i._parse(new Oi(s,o,s.path,[h,"key"])),value:r._parse(new Oi(s,c,s.path,[h,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of a){const h=await c.key,u=await c.value;if(h.status==="aborted"||u.status==="aborted")return V;(h.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(h.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of a){const h=c.key,u=c.value;if(h.status==="aborted"||u.status==="aborted")return V;(h.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(h.value,u.value)}return{status:t.value,value:o}}}}Td.create=(n,e,t)=>new Td({valueType:e,keyType:n,typeName:I.ZodMap,...Y(t)});class Na extends te{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==j.set)return N(s,{code:R.invalid_type,expected:j.set,received:s.parsedType}),V;const i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(N(s,{code:R.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(N(s,{code:R.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const r=this._def.valueType;function a(c){const h=new Set;for(const u of c){if(u.status==="aborted")return V;u.status==="dirty"&&t.dirty(),h.add(u.value)}return{status:t.value,value:h}}const o=[...s.data.values()].map((c,h)=>r._parse(new Oi(s,c,s.path,h)));return s.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new Na({...this._def,minSize:{value:e,message:H.toString(t)}})}max(e,t){return new Na({...this._def,maxSize:{value:e,message:H.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Na.create=(n,e)=>new Na({valueType:n,minSize:null,maxSize:null,typeName:I.ZodSet,...Y(e)});class _o extends te{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==j.function)return N(t,{code:R.invalid_type,expected:j.function,received:t.parsedType}),V;function s(o,c){return Sd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,xd(),Ll].filter(h=>!!h),issueData:{code:R.invalid_arguments,argumentsError:c}})}function i(o,c){return Sd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,xd(),Ll].filter(h=>!!h),issueData:{code:R.invalid_return_type,returnTypeError:c}})}const r={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Dl){const o=this;return $t(async function(...c){const h=new fs([]),u=await o._def.args.parseAsync(c,r).catch(p=>{throw h.addIssue(s(c,p)),h}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,r).catch(p=>{throw h.addIssue(i(d,p)),h})})}else{const o=this;return $t(function(...c){const h=o._def.args.safeParse(c,r);if(!h.success)throw new fs([s(c,h.error)]);const u=Reflect.apply(a,this,h.data),d=o._def.returns.safeParse(u,r);if(!d.success)throw new fs([i(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new _o({...this._def,args:Mi.create(e).rest(Fa.create())})}returns(e){return new _o({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new _o({args:e||Mi.create([]).rest(Fa.create()),returns:t||Fa.create(),typeName:I.ZodFunction,...Y(s)})}}class Nc extends te{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Nc.create=(n,e)=>new Nc({getter:n,typeName:I.ZodLazy,...Y(e)});class jc extends te{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return N(t,{received:t.data,code:R.invalid_literal,expected:this._def.value}),V}return{status:"valid",value:e.data}}get value(){return this._def.value}}jc.create=(n,e)=>new jc({value:n,typeName:I.ZodLiteral,...Y(e)});function __(n,e){return new pr({values:n,typeName:I.ZodEnum,...Y(e)})}class pr extends te{constructor(){super(...arguments),Yl.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return N(t,{expected:ue.joinValues(s),received:t.parsedType,code:R.invalid_type}),V}if(Ed(this,Yl)||g_(this,Yl,new Set(this._def.values)),!Ed(this,Yl).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return N(t,{received:t.data,code:R.invalid_enum_value,options:s}),V}return $t(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return pr.create(e,{...this._def,...t})}exclude(e,t=this._def){return pr.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}Yl=new WeakMap;pr.create=__;class $c extends te{constructor(){super(...arguments),Jl.set(this,void 0)}_parse(e){const t=ue.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==j.string&&s.parsedType!==j.number){const i=ue.objectValues(t);return N(s,{expected:ue.joinValues(i),received:s.parsedType,code:R.invalid_type}),V}if(Ed(this,Jl)||g_(this,Jl,new Set(ue.getValidEnumValues(this._def.values))),!Ed(this,Jl).has(e.data)){const i=ue.objectValues(t);return N(s,{received:s.data,code:R.invalid_enum_value,options:i}),V}return $t(e.data)}get enum(){return this._def.values}}Jl=new WeakMap;$c.create=(n,e)=>new $c({values:n,typeName:I.ZodNativeEnum,...Y(e)});class Dl extends te{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==j.promise&&t.common.async===!1)return N(t,{code:R.invalid_type,expected:j.promise,received:t.parsedType}),V;const s=t.parsedType===j.promise?t.data:Promise.resolve(t.data);return $t(s.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Dl.create=(n,e)=>new Dl({type:n,typeName:I.ZodPromise,...Y(e)});class ii extends te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),i=this._def.effect||null,r={addIssue:a=>{N(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(r.addIssue=r.addIssue.bind(r),i.type==="preprocess"){const a=i.transform(s.data,r);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return V;const c=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return c.status==="aborted"?V:c.status==="dirty"||t.value==="dirty"?go(c.value):c});{if(t.value==="aborted")return V;const o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?V:o.status==="dirty"||t.value==="dirty"?go(o.value):o}}if(i.type==="refinement"){const a=o=>{const c=i.refinement(o,r);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?V:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?V:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Pc(a))return a;const o=i.transform(a.value,r);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>Pc(a)?Promise.resolve(i.transform(a.value,r)).then(o=>({status:t.value,value:o})):a);ue.assertNever(i)}}ii.create=(n,e,t)=>new ii({schema:n,typeName:I.ZodEffects,effect:e,...Y(t)});ii.createWithPreprocess=(n,e,t)=>new ii({schema:e,effect:{type:"preprocess",transform:n},typeName:I.ZodEffects,...Y(t)});class Ii extends te{_parse(e){return this._getType(e)===j.undefined?$t(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ii.create=(n,e)=>new Ii({innerType:n,typeName:I.ZodOptional,...Y(e)});class gr extends te{_parse(e){return this._getType(e)===j.null?$t(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}gr.create=(n,e)=>new gr({innerType:n,typeName:I.ZodNullable,...Y(e)});class Uc extends te{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===j.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Uc.create=(n,e)=>new Uc({innerType:n,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Y(e)});class Bc extends te{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Rc(i)?i.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new fs(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new fs(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Bc.create=(n,e)=>new Bc({innerType:n,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Y(e)});class Pd extends te{_parse(e){if(this._getType(e)!==j.nan){const s=this._getOrReturnCtx(e);return N(s,{code:R.invalid_type,expected:j.nan,received:s.parsedType}),V}return{status:"valid",value:e.data}}}Pd.create=n=>new Pd({typeName:I.ZodNaN,...Y(n)});const iE=Symbol("zod_brand");class rm extends te{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class pu extends te{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?V:r.status==="dirty"?(t.dirty(),go(r.value)):this._def.out._parseAsync({data:r.value,path:s.path,parent:s})})();{const i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?V:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,t){return new pu({in:e,out:t,typeName:I.ZodPipeline})}}class Hc extends te{_parse(e){const t=this._def.innerType._parse(e),s=i=>(Pc(i)&&(i.value=Object.freeze(i.value)),i);return Rc(t)?t.then(i=>s(i)):s(t)}unwrap(){return this._def.innerType}}Hc.create=(n,e)=>new Hc({innerType:n,typeName:I.ZodReadonly,...Y(e)});function v_(n,e={},t){return n?Fl.create().superRefine((s,i)=>{var r,a;if(!n(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,c=(a=(r=o.fatal)!==null&&r!==void 0?r:t)!==null&&a!==void 0?a:!0,h=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...h,fatal:c})}}):Fl.create()}const nE={object:$e.lazycreate};var I;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(I||(I={}));const rE=(n,e={message:`Input not instance of ${n.name}`})=>v_(t=>t instanceof n,e),w_=Js.create,A_=dr.create,aE=Pd.create,oE=fr.create,x_=Ic.create,lE=Da.create,cE=Cd.create,hE=Oc.create,uE=Mc.create,dE=Fl.create,fE=Fa.create,pE=vn.create,gE=kd.create,mE=si.create,yE=$e.create,bE=$e.strictCreate,_E=Lc.create,vE=ff.create,wE=Fc.create,AE=Mi.create,xE=Dc.create,SE=Td.create,EE=Na.create,CE=_o.create,kE=Nc.create,TE=jc.create,PE=pr.create,RE=$c.create,IE=Dl.create,uy=ii.create,OE=Ii.create,ME=gr.create,LE=ii.createWithPreprocess,FE=pu.create,DE=()=>w_().optional(),NE=()=>A_().optional(),jE=()=>x_().optional(),$E={string:n=>Js.create({...n,coerce:!0}),number:n=>dr.create({...n,coerce:!0}),boolean:n=>Ic.create({...n,coerce:!0}),bigint:n=>fr.create({...n,coerce:!0}),date:n=>Da.create({...n,coerce:!0})},UE=V;var Ue=Object.freeze({__proto__:null,defaultErrorMap:Ll,setErrorMap:US,getErrorMap:xd,makeIssue:Sd,EMPTY_PATH:BS,addIssueToContext:N,ParseStatus:Rt,INVALID:V,DIRTY:go,OK:$t,isAborted:gp,isDirty:mp,isValid:Pc,isAsync:Rc,get util(){return ue},get objectUtil(){return pp},ZodParsedType:j,getParsedType:On,ZodType:te,datetimeRegex:b_,ZodString:Js,ZodNumber:dr,ZodBigInt:fr,ZodBoolean:Ic,ZodDate:Da,ZodSymbol:Cd,ZodUndefined:Oc,ZodNull:Mc,ZodAny:Fl,ZodUnknown:Fa,ZodNever:vn,ZodVoid:kd,ZodArray:si,ZodObject:$e,ZodUnion:Lc,ZodDiscriminatedUnion:ff,ZodIntersection:Fc,ZodTuple:Mi,ZodRecord:Dc,ZodMap:Td,ZodSet:Na,ZodFunction:_o,ZodLazy:Nc,ZodLiteral:jc,ZodEnum:pr,ZodNativeEnum:$c,ZodPromise:Dl,ZodEffects:ii,ZodTransformer:ii,ZodOptional:Ii,ZodNullable:gr,ZodDefault:Uc,ZodCatch:Bc,ZodNaN:Pd,BRAND:iE,ZodBranded:rm,ZodPipeline:pu,ZodReadonly:Hc,custom:v_,Schema:te,ZodSchema:te,late:nE,get ZodFirstPartyTypeKind(){return I},coerce:$E,any:dE,array:mE,bigint:oE,boolean:x_,date:lE,discriminatedUnion:vE,effect:uy,enum:PE,function:CE,instanceof:rE,intersection:wE,lazy:kE,literal:TE,map:SE,nan:aE,nativeEnum:RE,never:pE,null:uE,nullable:ME,number:A_,object:yE,oboolean:jE,onumber:NE,optional:OE,ostring:DE,pipeline:FE,preprocess:LE,promise:IE,record:xE,set:EE,strictObject:bE,string:w_,symbol:cE,transformer:uy,tuple:AE,undefined:hE,union:_E,unknown:fE,void:gE,NEVER:UE,ZodIssueCode:R,quotelessJson:$S,ZodError:fs});Ue.object({pdf:Ue.custom(n=>n===null||n instanceof File,{message:"Expected a File or null"}),imageSrc:Ue.string()});const BE={pdf:null,imageSrc:""},HE=async()=>{if(typeof window>"u")return null;try{const n=await Ys(()=>Promise.resolve().then(()=>OT),void 0);return n.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs",n}catch{return null}};async function zE(n){const e=await HE();if(!n||!e)return"";try{const t=await n.arrayBuffer(),s=await e.getDocument({data:t}).promise,i=s.numPages,r=document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("Cannot get canvas context");let o=0,c=0;const h=[];for(let d=1;d<=i;d++){const f=await s.getPage(d),p=f.getViewport({scale:1.5}),g=document.createElement("canvas"),y=g.getContext("2d");if(!y)throw new Error("Cannot get page canvas context");g.width=p.width,g.height=p.height,await f.render({canvasContext:y,viewport:p}).promise,h.push(g),o+=p.height,c=Math.max(c,p.width)}r.width=c,r.height=o;let u=0;for(const d of h)a.drawImage(d,0,u,d.width,d.height),u+=d.height;return r.toDataURL("image/jpeg",.8)}catch(t){throw console.error("Error getting PDF src:",t),t}}var xc={};xc.d=(n,e)=>{for(var t in e)xc.o(e,t)&&!xc.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};xc.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var K=globalThis.pdfjsLib={};xc.d(K,{AbortException:()=>Xa,AnnotationEditorLayer:()=>Tg,AnnotationEditorParamsType:()=>X,AnnotationEditorType:()=>Q,AnnotationEditorUIManager:()=>$a,AnnotationLayer:()=>Bk,AnnotationMode:()=>Mn,ColorPicker:()=>Md,DOMSVGFactory:()=>ym,DrawLayer:()=>Og,FeatureTest:()=>Dt,GlobalWorkerOptions:()=>gn,ImageKind:()=>$u,InvalidPDFException:()=>E_,MissingPDFException:()=>Ga,OPS:()=>Ms,OutputScale:()=>Ap,PDFDataRangeTransport:()=>wv,PDFDateString:()=>hm,PDFWorker:()=>wo,PasswordResponses:()=>GE,PermissionFlag:()=>WE,PixelsPerInch:()=>mr,RenderingCancelledException:()=>lm,TextLayer:()=>zc,UnexpectedResponseException:()=>yf,Util:()=>B,VerbosityLevel:()=>pf,XfaLayer:()=>xv,build:()=>wk,createValidAbsoluteUrl:()=>YE,fetchData:()=>_f,getDocument:()=>dk,getFilenameFromUrl:()=>aC,getPdfFilenameFromUrl:()=>oC,getXfaPageViewport:()=>lC,isDataScheme:()=>vf,isPdfFile:()=>cm,noContextMenu:()=>ks,normalizeUnicode:()=>iC,setLayerDimensions:()=>ja,shadow:()=>he,version:()=>vk});const Pt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),S_=[1,0,0,1,0,0],bp=[.001,0,0,.001,0,0],qE=1e7,jf=1.35,us={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Mn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},VE="pdfjs_internal_editor_",Q={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},X={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},WE={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},wt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},$u={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ze={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Gl={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},pf={ERRORS:0,WARNINGS:1,INFOS:5},Ms={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},GE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let gf=pf.WARNINGS;function XE(n){Number.isInteger(n)&&(gf=n)}function KE(){return gf}function mf(n){gf>=pf.INFOS&&console.log(`Info: ${n}`)}function ie(n){gf>=pf.WARNINGS&&console.log(`Warning: ${n}`)}function Re(n){throw new Error(n)}function st(n,e){n||Re(e)}function ZE(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function YE(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=sC(n)}catch{}}const s=e?new URL(n,e):new URL(n);if(ZE(s))return s}catch{}return null}function he(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const vr=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class _p extends vr{constructor(e,t){super(e,"PasswordException"),this.code=t}}class vp extends vr{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class E_ extends vr{constructor(e){super(e,"InvalidPDFException")}}class Ga extends vr{constructor(e){super(e,"MissingPDFException")}}class yf extends vr{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class JE extends vr{constructor(e){super(e,"FormatError")}}class Xa extends vr{constructor(e){super(e,"AbortException")}}function C_(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Re("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),a=n.subarray(i,r);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function bf(n){typeof n!="string"&&Re("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function QE(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function am(n){const e=Object.create(null);for(const[t,s]of n)e[t]=s;return e}function eC(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function tC(){try{return new Function(""),!0}catch{return!1}}class Dt{static get isLittleEndian(){return he(this,"isLittleEndian",eC())}static get isEvalSupported(){return he(this,"isEvalSupported",tC())}static get isOffscreenCanvasSupported(){return he(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?he(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):he(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return he(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const $f=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var bn,Uu,wp;class B{static makeHexColor(e,t,s){return`#${$f[e]}${$f[t]}${$f[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[i,r]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],i[0],r[0],a[0]),Math.min(s[1],i[1],r[1],a[1]),Math.max(s[0],i[0],r[0],a[0]),Math.max(s[1],i[1],r[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(s+a)/2,c=Math.sqrt((s+a)**2-4*(s*a-r*i))/2,h=o+c||1,u=o-c||1;return[Math.sqrt(h),Math.sqrt(u)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[s,r,i,a]}static bezierBoundingBox(e,t,s,i,r,a,o,c,h){return h?(h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,c),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,c)):h=[Math.min(e,o),Math.min(t,c),Math.max(e,o),Math.max(t,c)],b(this,bn,wp).call(this,e,s,r,o,t,i,a,c,3*(-e+3*(s-r)+o),6*(e-2*s+r),3*(s-e),h),b(this,bn,wp).call(this,e,s,r,o,t,i,a,c,3*(-t+3*(i-a)+c),6*(t-2*i+a),3*(i-t),h),h}}bn=new WeakSet,Uu=function(e,t,s,i,r,a,o,c,h,u){if(h<=0||h>=1)return;const d=1-h,f=h*h,p=f*h,g=d*(d*(d*e+3*h*t)+3*f*s)+p*i,y=d*(d*(d*r+3*h*a)+3*f*o)+p*c;u[0]=Math.min(u[0],g),u[1]=Math.min(u[1],y),u[2]=Math.max(u[2],g),u[3]=Math.max(u[3],y)},wp=function(e,t,s,i,r,a,o,c,h,u,d,f){if(Math.abs(h)<1e-12){Math.abs(u)>=1e-12&&b(this,bn,Uu).call(this,e,t,s,i,r,a,o,c,-d/u,f);return}const p=u**2-4*d*h;if(p<0)return;const g=Math.sqrt(p),y=2*h;b(this,bn,Uu).call(this,e,t,s,i,r,a,o,c,(-u+g)/y,f),b(this,bn,Uu).call(this,e,t,s,i,r,a,o,c,(-u-g)/y,f)},_(B,bn);function sC(n){return decodeURIComponent(escape(n))}let Uf=null,dy=null;function iC(n){return Uf||(Uf=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,dy=new Map([["ﬅ","ſt"]])),n.replaceAll(Uf,(e,t,s)=>t?t.normalize("NFKC"):dy.get(s))}function nC(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const n=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(n);else for(let e=0;e<32;e++)n[e]=Math.floor(Math.random()*255);return C_(n)}const om="pdfjs_internal_id_",Fi={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};function rC(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(C_(n))}const $i="http://www.w3.org/2000/svg",Ir=class Ir{};G(Ir,"CSS",96),G(Ir,"PDF",72),G(Ir,"PDF_TO_CSS_UNITS",Ir.CSS/Ir.PDF);let mr=Ir;async function _f(n,e="text"){if(Ql(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class gu{constructor({viewBox:e,scale:t,rotation:s,offsetX:i=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=e,this.scale=t,this.rotation=s,this.offsetX=i,this.offsetY=r;const o=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let h,u,d,f;switch(s%=360,s<0&&(s+=360),s){case 180:h=-1,u=0,d=0,f=1;break;case 90:h=0,u=1,d=1,f=0;break;case 270:h=0,u=-1,d=-1,f=0;break;case 0:h=1,u=0,d=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(d=-d,f=-f);let p,g,y,v;h===0?(p=Math.abs(c-e[1])*t+i,g=Math.abs(o-e[0])*t+r,y=(e[3]-e[1])*t,v=(e[2]-e[0])*t):(p=Math.abs(o-e[0])*t+i,g=Math.abs(c-e[1])*t+r,y=(e[2]-e[0])*t,v=(e[3]-e[1])*t),this.transform=[h*t,u*t,d*t,f*t,p-h*t*o-d*t*c,g-u*t*o-f*t*c],this.width=y,this.height=v}get rawDims(){const{viewBox:e}=this;return he(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new gu({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){return B.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=B.applyTransform([e[0],e[1]],this.transform),s=B.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return B.applyInverseTransform([e,t],this.transform)}}class lm extends vr{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function vf(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function cm(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function aC(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function oC(n,e="document.pdf"){if(typeof n!="string")return e;if(vf(n))return ie('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(n);let r=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=s.exec(decodeURIComponent(r))[0]}catch{}return r||e}class fy{constructor(){G(this,"started",Object.create(null));G(this,"times",[])}time(e){e in this.started&&ie(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||ie(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function Ql(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function ks(n){n.preventDefault()}function py(n){console.log("Deprecated API usage: "+n)}var Kc;class hm{static toDateObject(e){if(!e||typeof e!="string")return null;l(this,Kc)||m(this,Kc,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,Kc).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const h=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(a+=u,o+=d):h==="+"&&(a-=u,o-=d),new Date(Date.UTC(s,i,r,a,o,c))}}Kc=new WeakMap,_(hm,Kc);function lC(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new gu({viewBox:r,scale:e,rotation:t})}function um(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(ie(`Not a valid color format: "${n}"`),[0,0,0])}function cC(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,um(s))}e.remove()}function Ne(n){const{a:e,b:t,c:s,d:i,e:r,f:a}=n.getTransform();return[e,t,s,i,r,a]}function Di(n){const{a:e,b:t,c:s,d:i,e:r,f:a}=n.getTransform().invertSelf();return[e,t,s,i,r,a]}function ja(n,e,t=!1,s=!0){if(e instanceof gu){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:a}=n,o=Dt.isCSSRoundSupported,c=`var(--scale-factor) * ${i}px`,h=`var(--scale-factor) * ${r}px`,u=o?`round(down, ${c}, var(--scale-round-x, 1px))`:`calc(${c})`,d=o?`round(down, ${h}, var(--scale-round-y, 1px))`:`calc(${h})`;!t||e.rotation%180===0?(a.width=u,a.height=d):(a.width=d,a.height=u)}s&&n.setAttribute("data-main-rotation",e.rotation)}class Ap{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Ln,Fr,Ds,Dr,Zc,Yc,Bd,k_,Nt,T_,P_,Bu,R_,Sp;const Hi=class Hi{constructor(e){_(this,Nt);_(this,Ln,null);_(this,Fr,null);_(this,Ds);_(this,Dr,null);_(this,Zc,null);m(this,Ds,e),l(Hi,Yc)||m(Hi,Yc,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=m(this,Ln,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,Ds)._uiManager._signal;e.addEventListener("contextmenu",ks,{signal:t}),e.addEventListener("pointerdown",b(Hi,Bd,k_),{signal:t});const s=m(this,Dr,document.createElement("div"));s.className="buttons",e.append(s);const i=l(this,Ds).toolbarPosition;if(i){const{style:r}=e,a=l(this,Ds)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return b(this,Nt,R_).call(this),e}get div(){return l(this,Ln)}hide(){var e;l(this,Ln).classList.add("hidden"),(e=l(this,Fr))==null||e.hideDropdown()}show(){var e;l(this,Ln).classList.remove("hidden"),(e=l(this,Zc))==null||e.shown()}async addAltText(e){const t=await e.render();b(this,Nt,Bu).call(this,t),l(this,Dr).prepend(t,l(this,Nt,Sp)),m(this,Zc,e)}addColorPicker(e){m(this,Fr,e);const t=e.renderButton();b(this,Nt,Bu).call(this,t),l(this,Dr).prepend(t,l(this,Nt,Sp))}remove(){var e;l(this,Ln).remove(),(e=l(this,Fr))==null||e.destroy(),m(this,Fr,null)}};Ln=new WeakMap,Fr=new WeakMap,Ds=new WeakMap,Dr=new WeakMap,Zc=new WeakMap,Yc=new WeakMap,Bd=new WeakSet,k_=function(e){e.stopPropagation()},Nt=new WeakSet,T_=function(e){l(this,Ds)._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()},P_=function(e){l(this,Ds)._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()},Bu=function(e){const t=l(this,Ds)._uiManager._signal;e.addEventListener("focusin",b(this,Nt,T_).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",b(this,Nt,P_).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",ks,{signal:t})},R_=function(){const{editorType:e,_uiManager:t}=l(this,Ds),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",l(Hi,Yc)[e]),b(this,Nt,Bu).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),l(this,Dr).append(s)},Sp=function(){const e=document.createElement("div");return e.className="divider",e},_(Hi,Bd),_(Hi,Yc,null);let xp=Hi;var Jc,Nr,jr,br,I_,O_,M_;class hC{constructor(e){_(this,br);_(this,Jc,null);_(this,Nr,null);_(this,jr);m(this,jr,e)}show(e,t,s){const[i,r]=b(this,br,O_).call(this,t,s),{style:a}=l(this,Nr)||m(this,Nr,b(this,br,I_).call(this));e.append(l(this,Nr)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,Nr).remove()}}Jc=new WeakMap,Nr=new WeakMap,jr=new WeakMap,br=new WeakSet,I_=function(){const e=m(this,Nr,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",ks,{signal:l(this,jr)._signal});const t=m(this,Jc,document.createElement("div"));return t.className="buttons",e.append(t),b(this,br,M_).call(this),e},O_=function(e,t){let s=0,i=0;for(const r of e){const a=r.y+r.height;if(a<s)continue;const o=r.x+(t?r.width:0);if(a>s){i=o,s=a;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},M_=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=l(this,jr)._signal;e.addEventListener("contextmenu",ks,{signal:s}),e.addEventListener("click",()=>{l(this,jr).highlightSelection("floating_button")},{signal:s}),l(this,Jc).append(e)};function Rd(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}function uC(n){return Math.round(Math.min(255,Math.max(1,255*n))).toString(16).padStart(2,"0")}var Hd;class dC{constructor(){_(this,Hd,0)}get id(){return`${VE}${nt(this,Hd)._++}`}}Hd=new WeakMap;var Co,Qc,St,ko,Hu;const qm=class qm{constructor(){_(this,ko);_(this,Co,nC());_(this,Qc,0);_(this,St,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return he(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return b(this,ko,Hu).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return b(this,ko,Hu).call(this,e,e)}async getFromBlob(e,t){const s=await t;return b(this,ko,Hu).call(this,e,s)}async getFromId(e){l(this,St)||m(this,St,new Map);const t=l(this,St).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,St)||m(this,St,new Map);let s=l(this,St).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${l(this,Co)}_${nt(this,Qc)._++}`,refCounter:1,isSvg:!1},l(this,St).set(e,s),l(this,St).set(s.id,s),s}getSvgUrl(e){const t=l(this,St).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;l(this,St)||m(this,St,new Map);const t=l(this,St).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,Co)}_`)}};Co=new WeakMap,Qc=new WeakMap,St=new WeakMap,ko=new WeakSet,Hu=async function(e,t){l(this,St)||m(this,St,new Map);let s=l(this,St).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,Co)}_${nt(this,Qc)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await _f(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=qm._isSVGFittingCanvas,a=new FileReader,o=new Image,c=new Promise((h,u)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},a.onload=async()=>{const d=s.svgUrl=a.result;o.src=await r?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=a.onerror=u});a.readAsDataURL(i),await c}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){console.error(i),s=null}return l(this,St).set(e,s),s&&l(this,St).set(s.id,s),s};let Ep=qm;var ot,Fn,eh,lt;class fC{constructor(e=128){_(this,ot,[]);_(this,Fn,!1);_(this,eh);_(this,lt,-1);m(this,eh,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&e(),l(this,Fn))return;const c={cmd:e,undo:t,post:s,type:r};if(l(this,lt)===-1){l(this,ot).length>0&&(l(this,ot).length=0),m(this,lt,0),l(this,ot).push(c);return}if(a&&l(this,ot)[l(this,lt)].type===r){o&&(c.undo=l(this,ot)[l(this,lt)].undo),l(this,ot)[l(this,lt)]=c;return}const h=l(this,lt)+1;h===l(this,eh)?l(this,ot).splice(0,1):(m(this,lt,h),h<l(this,ot).length&&l(this,ot).splice(h)),l(this,ot).push(c)}undo(){if(l(this,lt)===-1)return;m(this,Fn,!0);const{undo:e,post:t}=l(this,ot)[l(this,lt)];e(),t==null||t(),m(this,Fn,!1),m(this,lt,l(this,lt)-1)}redo(){if(l(this,lt)<l(this,ot).length-1){m(this,lt,l(this,lt)+1),m(this,Fn,!0);const{cmd:e,post:t}=l(this,ot)[l(this,lt)];e(),t==null||t(),m(this,Fn,!1)}}hasSomethingToUndo(){return l(this,lt)!==-1}hasSomethingToRedo(){return l(this,lt)<l(this,ot).length-1}destroy(){m(this,ot,null)}}ot=new WeakMap,Fn=new WeakMap,eh=new WeakMap,lt=new WeakMap;var zd,L_;class mu{constructor(e){_(this,zd);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Dt.platform;for(const[s,i,r={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(b(this,zd,L_).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...a,t)(),r||(t.stopPropagation(),t.preventDefault()))}}zd=new WeakSet,L_=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const qd=class qd{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return cC(e),he(this,"_colors",e)}convert(e){const t=um(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,a)=>r===t[a]))return qd._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?B.makeHexColor(...t):e}};G(qd,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Cp=qd;var To,ss,Qe,pt,Po,qi,Ro,Ns,Dn,Io,$r,ci,js,Ur,th,sh,Oo,ih,hi,Nn,Mo,jn,ui,Vd,$n,nh,Un,Br,rh,ah,ct,_e,Vi,Hr,oh,lh,Bn,di,Wi,ch,ys,D,zu,kp,F_,D_,qu,N_,j_,$_,Tp,U_,Pp,Rp,B_,It,kn,H_,z_,Ip,q_,ec,Op;const yo=class yo{constructor(e,t,s,i,r,a,o,c,h,u,d){_(this,D);_(this,To,new AbortController);_(this,ss,null);_(this,Qe,new Map);_(this,pt,new Map);_(this,Po,null);_(this,qi,null);_(this,Ro,null);_(this,Ns,new fC);_(this,Dn,null);_(this,Io,0);_(this,$r,new Set);_(this,ci,null);_(this,js,null);_(this,Ur,new Set);_(this,th,!1);_(this,sh,!1);_(this,Oo,!1);_(this,ih,null);_(this,hi,null);_(this,Nn,null);_(this,Mo,null);_(this,jn,!1);_(this,ui,null);_(this,Vd,new dC);_(this,$n,!1);_(this,nh,!1);_(this,Un,null);_(this,Br,null);_(this,rh,null);_(this,ah,null);_(this,ct,Q.NONE);_(this,_e,new Set);_(this,Vi,null);_(this,Hr,null);_(this,oh,null);_(this,lh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});_(this,Bn,[0,0]);_(this,di,null);_(this,Wi,null);_(this,ch,null);_(this,ys,null);const f=this._signal=l(this,To).signal;m(this,Wi,e),m(this,ch,t),m(this,Po,s),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:f}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:f}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:f}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:f}),i._on("setpreference",this.onSetPreference.bind(this),{signal:f}),i._on("switchannotationeditorparams",p=>this.updateParams(p.type,p.value),{signal:f}),b(this,D,N_).call(this),b(this,D,B_).call(this),b(this,D,Tp).call(this),m(this,qi,r.annotationStorage),m(this,ih,r.filterFactory),m(this,Hr,a),m(this,Mo,o||null),m(this,th,c),m(this,sh,h),m(this,Oo,u),m(this,ah,d||null),this.viewParameters={realScale:mr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}static get _keyboardManager(){const e=yo.prototype,t=a=>l(a,Wi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:c}=o;return c!=="text"&&c!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return he(this,"_keyboardManager",new mu([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Wi).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Wi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i;(e=l(this,ys))==null||e.resolve(),m(this,ys,null),(t=l(this,To))==null||t.abort(),m(this,To,null),this._signal=null;for(const r of l(this,pt).values())r.destroy();l(this,pt).clear(),l(this,Qe).clear(),l(this,Ur).clear(),m(this,ss,null),l(this,_e).clear(),l(this,Ns).destroy(),(s=l(this,Po))==null||s.destroy(),(i=l(this,ui))==null||i.hide(),m(this,ui,null),l(this,hi)&&(clearTimeout(l(this,hi)),m(this,hi,null)),l(this,di)&&(clearTimeout(l(this,di)),m(this,di,null))}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,ah)}get useNewAltTextFlow(){return l(this,sh)}get useNewAltTextWhenAddingImage(){return l(this,Oo)}get hcmFilter(){return he(this,"hcmFilter",l(this,Hr)?l(this,ih).addHCMFilter(l(this,Hr).foreground,l(this,Hr).background):"none")}get direction(){return he(this,"direction",getComputedStyle(l(this,Wi)).direction)}get highlightColors(){return he(this,"highlightColors",l(this,Mo)?new Map(l(this,Mo).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return he(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setMainHighlightColorPicker(e){m(this,rh,e)}editAltText(e,t=!1){var s;(s=l(this,Po))==null||s.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":m(this,Oo,t);break}}onPageChanging({pageNumber:e}){m(this,Io,e-1)}focusMainContainer(){l(this,Wi).focus()}findParent(e,t){for(const s of l(this,pt).values()){const{x:i,y:r,width:a,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+a&&t>=r&&t<=r+o)return s}return null}disableUserSelect(e=!1){l(this,ch).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,Ur).add(e)}removeShouldRescale(e){l(this,Ur).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*mr.PDF_TO_CSS_UNITS;for(const t of l(this,Ur))t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:a}=t,o=t.toString(),h=b(this,D,zu).call(this,t).closest(".textLayer"),u=this.getSelectionBoxes(h);if(!u)return;t.empty();const d=b(this,D,kp).call(this,h),f=l(this,ct)===Q.NONE,p=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Q.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&l(this,qi)&&!l(this,qi).has(e.id)&&l(this,qi).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,l(this,jn)&&(m(this,jn,!1),b(this,D,qu).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,_e))if(t.div.contains(e)){m(this,Br,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,Br))return;const[e,t]=l(this,Br);m(this,Br,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){b(this,D,Tp).call(this),b(this,D,Pp).call(this)}removeEditListeners(){b(this,D,U_).call(this),b(this,D,Rp).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,js))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,js))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,ss))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of l(this,_e)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const a of l(this,js))if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){ie(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const c of s){const h=await i.deserialize(c);if(!h)return;r.push(h)}const a=()=>{for(const c of r)b(this,D,Ip).call(this,c);b(this,D,Op).call(this,r)},o=()=>{for(const c of r)c.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(r){ie(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,ct)!==Q.NONE&&!this.isEditorHandlingKeyboard&&yo._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,jn)&&(m(this,jn,!1),b(this,D,qu).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(b(this,D,j_).call(this),b(this,D,Pp).call(this),b(this,D,It).call(this,{isEditing:l(this,ct)!==Q.NONE,isEmpty:b(this,D,ec).call(this),hasSomethingToUndo:l(this,Ns).hasSomethingToUndo(),hasSomethingToRedo:l(this,Ns).hasSomethingToRedo(),hasSelectedEditor:!1})):(b(this,D,$_).call(this),b(this,D,Rp).call(this),b(this,D,It).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,js)){m(this,js,e);for(const t of l(this,js))b(this,D,kn).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,Vd).id}get currentLayer(){return l(this,pt).get(l(this,Io))}getLayer(e){return l(this,pt).get(e)}get currentPageIndex(){return l(this,Io)}addLayer(e){l(this,pt).set(e.pageIndex,e),l(this,$n)?e.enable():e.disable()}removeLayer(e){l(this,pt).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){if(l(this,ct)!==e&&!(l(this,ys)&&(await l(this,ys).promise,!l(this,ys)))){if(m(this,ys,Promise.withResolvers()),m(this,ct,e),e===Q.NONE){this.setEditingState(!1),b(this,D,z_).call(this),l(this,ys).resolve();return}this.setEditingState(!0),await b(this,D,H_).call(this),this.unselectAll();for(const i of l(this,pt).values())i.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),l(this,ys).resolve();return}for(const i of l(this,Qe).values())i.annotationElementId===t?(this.setSelected(i),i.enterInEditMode()):i.unselect();l(this,ys).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==l(this,ct)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var s;if(l(this,js)){switch(e){case X.CREATE:this.currentLayer.addNewEditor();return;case X.HIGHLIGHT_DEFAULT_COLOR:(s=l(this,rh))==null||s.updateColor(t);break;case X.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,oh)||m(this,oh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of l(this,_e))i.updateParams(e,t);for(const i of l(this,js))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const a of l(this,Qe).values())a.editorType===e&&a.show(t);(((r=l(this,oh))==null?void 0:r.get(X.HIGHLIGHT_SHOW_ALL))??!0)!==t&&b(this,D,kn).call(this,[[X.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,nh)!==e){m(this,nh,e);for(const t of l(this,pt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of l(this,Qe).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return l(this,Qe).get(e)}addEditor(e){l(this,Qe).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(l(this,hi)&&clearTimeout(l(this,hi)),m(this,hi,setTimeout(()=>{this.focusMainContainer(),m(this,hi,null)},0))),l(this,Qe).delete(e.id),this.unselect(e),(!e.annotationElementId||!l(this,$r).has(e.annotationElementId))&&((t=l(this,qi))==null||t.remove(e.id))}addDeletedAnnotationElement(e){l(this,$r).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,$r).has(e)}removeDeletedAnnotationElement(e){l(this,$r).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,ss)!==e&&(m(this,ss,e),e&&b(this,D,kn).call(this,e.propertiesToUpdate))}updateUI(e){l(this,D,q_)===e&&b(this,D,kn).call(this,e.propertiesToUpdate)}toggleSelected(e){if(l(this,_e).has(e)){l(this,_e).delete(e),e.unselect(),b(this,D,It).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,_e).add(e),e.select(),b(this,D,kn).call(this,e.propertiesToUpdate),b(this,D,It).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const t of l(this,_e))t!==e&&t.unselect();l(this,_e).clear(),l(this,_e).add(e),e.select(),b(this,D,kn).call(this,e.propertiesToUpdate),b(this,D,It).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,_e).has(e)}get firstSelectedEditor(){return l(this,_e).values().next().value}unselect(e){e.unselect(),l(this,_e).delete(e),b(this,D,It).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,_e).size!==0}get isEnterHandled(){return l(this,_e).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){l(this,Ns).undo(),b(this,D,It).call(this,{hasSomethingToUndo:l(this,Ns).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:b(this,D,ec).call(this)})}redo(){l(this,Ns).redo(),b(this,D,It).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,Ns).hasSomethingToRedo(),isEmpty:b(this,D,ec).call(this)})}addCommands(e){l(this,Ns).add(e),b(this,D,It).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:b(this,D,ec).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...l(this,_e)],t=()=>{for(const i of e)i.remove()},s=()=>{for(const i of e)b(this,D,Ip).call(this,i)};this.addCommands({cmd:t,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=l(this,ss))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,ss)||this.hasSelection}selectAll(){for(const e of l(this,_e))e.commit();b(this,D,Op).call(this,l(this,Qe).values())}unselectAll(){if(!(l(this,ss)&&(l(this,ss).commitOrRemove(),l(this,ct)!==Q.NONE))&&this.hasSelection){for(const e of l(this,_e))e.unselect();l(this,_e).clear(),b(this,D,It).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,Bn)[0]+=e,l(this,Bn)[1]+=t;const[i,r]=l(this,Bn),a=[...l(this,_e)],o=1e3;l(this,di)&&clearTimeout(l(this,di)),m(this,di,setTimeout(()=>{m(this,di,null),l(this,Bn)[0]=l(this,Bn)[1]=0,this.addCommands({cmd:()=>{for(const c of a)l(this,Qe).has(c.id)&&c.translateInPage(i,r)},undo:()=>{for(const c of a)l(this,Qe).has(c.id)&&c.translateInPage(-i,-r)},mustExec:!1})},o));for(const c of a)c.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),m(this,ci,new Map);for(const e of l(this,_e))l(this,ci).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,ci))return!1;this.disableUserSelect(!1);const e=l(this,ci);m(this,ci,null);let t=!1;for(const[{x:i,y:r,pageIndex:a},o]of e)o.newX=i,o.newY=r,o.newPageIndex=a,t||(t=i!==o.savedX||r!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(i,r,a,o)=>{if(l(this,Qe).has(i.id)){const c=l(this,pt).get(o);c?i._setParentAndPosition(c,r,a):(i.pageIndex=o,i.x=r,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:a,newPageIndex:o}]of e)s(i,r,a,o)},undo:()=>{for(const[i,{savedX:r,savedY:a,savedPageIndex:o}]of e)s(i,r,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,ci))for(const s of l(this,ci).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,_e).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,ss)===e}getActive(){return l(this,ss)}getMode(){return l(this,ct)}get imageManager(){return he(this,"imageManager",new Ep)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,u=t.rangeCount;h<u;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,u,d,f)=>({x:(u-i)/a,y:1-(h+d-s)/r,width:f/a,height:d/r});break;case"180":o=(h,u,d,f)=>({x:1-(h+d-s)/r,y:1-(u+f-i)/a,width:d/r,height:f/a});break;case"270":o=(h,u,d,f)=>({x:1-(u+f-i)/a,y:(h-s)/r,width:f/a,height:d/r});break;default:o=(h,u,d,f)=>({x:(h-s)/r,y:(u-i)/a,width:d/r,height:f/a});break}const c=[];for(let h=0,u=t.rangeCount;h<u;h++){const d=t.getRangeAt(h);if(!d.collapsed)for(const{x:f,y:p,width:g,height:y}of d.getClientRects())g===0||y===0||c.push(o(f,p,g,y))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,Ro)||m(this,Ro,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,Ro))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=l(this,Ro))==null?void 0:i.get(e.data.id);if(!t)return;const s=l(this,qi).getRawValue(t);s&&(l(this,ct)===Q.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}};To=new WeakMap,ss=new WeakMap,Qe=new WeakMap,pt=new WeakMap,Po=new WeakMap,qi=new WeakMap,Ro=new WeakMap,Ns=new WeakMap,Dn=new WeakMap,Io=new WeakMap,$r=new WeakMap,ci=new WeakMap,js=new WeakMap,Ur=new WeakMap,th=new WeakMap,sh=new WeakMap,Oo=new WeakMap,ih=new WeakMap,hi=new WeakMap,Nn=new WeakMap,Mo=new WeakMap,jn=new WeakMap,ui=new WeakMap,Vd=new WeakMap,$n=new WeakMap,nh=new WeakMap,Un=new WeakMap,Br=new WeakMap,rh=new WeakMap,ah=new WeakMap,ct=new WeakMap,_e=new WeakMap,Vi=new WeakMap,Hr=new WeakMap,oh=new WeakMap,lh=new WeakMap,Bn=new WeakMap,di=new WeakMap,Wi=new WeakMap,ch=new WeakMap,ys=new WeakMap,D=new WeakSet,zu=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},kp=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,pt).values())if(s.hasTextLayer(e))return s;return null},F_=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=b(this,D,zu).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(l(this,ui)||m(this,ui,new hC(this)),l(this,ui).show(s,i,this.direction==="ltr"))},D_=function(){var r,a,o;const e=document.getSelection();if(!e||e.isCollapsed){l(this,Vi)&&((r=l(this,ui))==null||r.hide(),m(this,Vi,null),b(this,D,It).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,Vi))return;const i=b(this,D,zu).call(this,e).closest(".textLayer");if(!i){l(this,Vi)&&((a=l(this,ui))==null||a.hide(),m(this,Vi,null),b(this,D,It).call(this,{hasSelectedText:!1}));return}if((o=l(this,ui))==null||o.hide(),m(this,Vi,t),b(this,D,It).call(this,{hasSelectedText:!0}),!(l(this,ct)!==Q.HIGHLIGHT&&l(this,ct)!==Q.NONE)&&(l(this,ct)===Q.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),m(this,jn,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=l(this,ct)===Q.HIGHLIGHT?b(this,D,kp).call(this,i):null;c==null||c.toggleDrawing();const h=new AbortController,u=this.combinedSignal(h),d=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),c==null||c.toggleDrawing(!0),f.type==="pointerup"&&b(this,D,qu).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("blur",d,{signal:u})}},qu=function(e=""){l(this,ct)===Q.HIGHLIGHT?this.highlightSelection(e):l(this,th)&&b(this,D,F_).call(this)},N_=function(){document.addEventListener("selectionchange",b(this,D,D_).bind(this),{signal:this._signal})},j_=function(){if(l(this,Nn))return;m(this,Nn,new AbortController);const e=this.combinedSignal(l(this,Nn));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},$_=function(){var e;(e=l(this,Nn))==null||e.abort(),m(this,Nn,null)},Tp=function(){if(l(this,Un))return;m(this,Un,new AbortController);const e=this.combinedSignal(l(this,Un));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},U_=function(){var e;(e=l(this,Un))==null||e.abort(),m(this,Un,null)},Pp=function(){if(l(this,Dn))return;m(this,Dn,new AbortController);const e=this.combinedSignal(l(this,Dn));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Rp=function(){var e;(e=l(this,Dn))==null||e.abort(),m(this,Dn,null)},B_=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},It=function(e){Object.entries(e).some(([s,i])=>l(this,lh)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,lh),e)}),l(this,ct)===Q.HIGHLIGHT&&e.hasSelectedEditor===!1&&b(this,D,kn).call(this,[[X.HIGHLIGHT_FREE,!0]]))},kn=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},H_=async function(){if(!l(this,$n)){m(this,$n,!0);const e=[];for(const t of l(this,pt).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,Qe).values())t.enable()}},z_=function(){if(this.unselectAll(),l(this,$n)){m(this,$n,!1);for(const e of l(this,pt).values())e.disable();for(const e of l(this,Qe).values())e.disable()}},Ip=function(e){const t=l(this,pt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},q_=function(){let e=null;for(e of l(this,_e));return e},ec=function(){if(l(this,Qe).size===0)return!0;if(l(this,Qe).size===1)for(const e of l(this,Qe).values())return e.isEmpty();return!1},Op=function(e){for(const t of l(this,_e))t.unselect();l(this,_e).clear();for(const t of e)t.isEmpty()||(l(this,_e).add(t),t.select());b(this,D,It).call(this,{hasSelectedEditor:this.hasSelection})},G(yo,"TRANSLATE_SMALL",1),G(yo,"TRANSLATE_BIG",10);let $a=yo;var ht,fi,$s,Lo,pi,is,Fo,gi,Vt,Gi,zr,mi,Hn,ti,tc,Vu;const Ot=class Ot{constructor(e){_(this,ti);_(this,ht,null);_(this,fi,!1);_(this,$s,null);_(this,Lo,null);_(this,pi,null);_(this,is,null);_(this,Fo,!1);_(this,gi,null);_(this,Vt,null);_(this,Gi,null);_(this,zr,null);_(this,mi,!1);m(this,Vt,e),m(this,mi,e._uiManager.useNewAltTextFlow),l(Ot,Hn)||m(Ot,Hn,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ot._l10n??(Ot._l10n=e)}async render(){const e=m(this,$s,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=m(this,Lo,document.createElement("span"));e.append(t),l(this,mi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(Ot,Hn).missing),t.setAttribute("data-l10n-id",l(Ot,Hn)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,Vt)._uiManager._signal;e.addEventListener("contextmenu",ks,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),l(this,Vt)._uiManager.editAltText(l(this,Vt)),l(this,mi)&&l(this,Vt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,ti,tc)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(m(this,Fo,!0),i(r))},{signal:s}),await b(this,ti,Vu).call(this),e}finish(){l(this,$s)&&(l(this,$s).focus({focusVisible:l(this,Fo)}),m(this,Fo,!1))}isEmpty(){return l(this,mi)?l(this,ht)===null:!l(this,ht)&&!l(this,fi)}hasData(){return l(this,mi)?l(this,ht)!==null||!!l(this,Gi):this.isEmpty()}get guessedText(){return l(this,Gi)}async setGuessedText(e){l(this,ht)===null&&(m(this,Gi,e),m(this,zr,await Ot._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),b(this,ti,Vu).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,mi)||l(this,ht)){(t=l(this,gi))==null||t.remove(),m(this,gi,null);return}if(!l(this,gi)){const s=m(this,gi,document.createElement("div"));s.className="noAltTextBadge",l(this,Vt).div.append(s)}l(this,gi).classList.toggle("hidden",!e)}serialize(e){let t=l(this,ht);return!e&&l(this,Gi)===t&&(t=l(this,zr)),{altText:t,decorative:l(this,fi),guessedText:l(this,Gi),textWithDisclaimer:l(this,zr)}}get data(){return{altText:l(this,ht),decorative:l(this,fi)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(m(this,Gi,s),m(this,zr,i)),!(l(this,ht)===e&&l(this,fi)===t)&&(r||(m(this,ht,e),m(this,fi,t)),b(this,ti,Vu).call(this))}toggle(e=!1){l(this,$s)&&(!e&&l(this,is)&&(clearTimeout(l(this,is)),m(this,is,null)),l(this,$s).disabled=!e)}shown(){l(this,Vt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,ti,tc)}})}destroy(){var e,t;(e=l(this,$s))==null||e.remove(),m(this,$s,null),m(this,Lo,null),m(this,pi,null),(t=l(this,gi))==null||t.remove(),m(this,gi,null)}};ht=new WeakMap,fi=new WeakMap,$s=new WeakMap,Lo=new WeakMap,pi=new WeakMap,is=new WeakMap,Fo=new WeakMap,gi=new WeakMap,Vt=new WeakMap,Gi=new WeakMap,zr=new WeakMap,mi=new WeakMap,Hn=new WeakMap,ti=new WeakSet,tc=function(){return l(this,ht)&&"added"||l(this,ht)===null&&this.guessedText&&"review"||"missing"},Vu=async function(){var i,r,a;const e=l(this,$s);if(!e)return;if(l(this,mi)){if(e.classList.toggle("done",!!l(this,ht)),e.setAttribute("data-l10n-id",l(Ot,Hn)[l(this,ti,tc)]),(i=l(this,Lo))==null||i.setAttribute("data-l10n-id",l(Ot,Hn)[`${l(this,ti,tc)}-label`]),!l(this,ht)){(r=l(this,pi))==null||r.remove();return}}else{if(!l(this,ht)&&!l(this,fi)){e.classList.remove("done"),(a=l(this,pi))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,pi);if(!t){m(this,pi,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,Vt).id}`;const o=100,c=l(this,Vt)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(l(this,is)),m(this,is,null)},{once:!0}),e.addEventListener("mouseenter",()=>{m(this,is,setTimeout(()=>{m(this,is,null),l(this,pi).classList.add("show"),l(this,Vt)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:c}),e.addEventListener("mouseleave",()=>{var h;l(this,is)&&(clearTimeout(l(this,is)),m(this,is,null)),(h=l(this,pi))==null||h.classList.remove("show")},{signal:c})}l(this,fi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,ht)),t.parentNode||e.append(t);const s=l(this,Vt).getImageForAltText();s==null||s.setAttribute("aria-describedby",t.id)},_(Ot,Hn,null),G(Ot,"_l10n",null);let Id=Ot;var qr,Us,Fe,Do,Vr,gt,Wr,zn,hh,Gr,qn,uh,Xr,Xi,yi,No,jo,bs,dh,Wd,ee,Mp,fh,Lp,Fp,V_,W_,Dp,Np,jp,G_,$p,X_,K_,Z_,Up,sc;const be=class be{constructor(e){_(this,ee);_(this,qr,null);_(this,Us,null);_(this,Fe,null);_(this,Do,!1);_(this,Vr,!1);_(this,gt,null);_(this,Wr,null);_(this,zn,null);_(this,hh,"");_(this,Gr,!1);_(this,qn,null);_(this,uh,!1);_(this,Xr,!1);_(this,Xi,!1);_(this,yi,null);_(this,No,0);_(this,jo,0);_(this,bs,null);G(this,"_editToolbar",null);G(this,"_initialOptions",Object.create(null));G(this,"_initialData",null);G(this,"_isVisible",!0);G(this,"_uiManager",null);G(this,"_focusEventsAllowed",!0);_(this,dh,!1);_(this,Wd,be._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,a];const[o,c]=this.parentDimensions;this.x=e.x/o,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=be.prototype._resizeWithKeyboard,t=$a.TRANSLATE_SMALL,s=$a.TRANSLATE_BIG;return he(this,"_resizerKeyboardManager",new mu([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],be.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return he(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new pC({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(be._l10n??(be._l10n=e),be._l10nResizer||(be._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),be._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);be._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Re("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,dh)}set _isDraggable(e){var t;m(this,dh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,Wd)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):b(this,ee,sc).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,Gr)?m(this,Gr,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/a,this.fixAndSetPosition()}translate(e,t){b(this,ee,Mp).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,qn)||m(this,qn,[this.x,this.y]),b(this,ee,Mp).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){l(this,qn)||m(this,qn,[this.x,this.y]);const[s,i]=this.parentDimensions;if(this.x+=e/s,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[o,c]=this.getBaseTranslation();r+=o,a+=c,this.div.style.left=`${(100*r).toFixed(2)}%`,this.div.style.top=`${(100*a).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!l(this,qn)&&(l(this,qn)[0]!==this.x||l(this,qn)[1]!==this.y)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=be,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const[t,s]=this.pageDimensions;let{x:i,y:r,width:a,height:o}=this;if(a*=t,o*=s,i*=t,r*=s,this._mustFixPosition)switch(e){case 0:i=Math.max(0,Math.min(t-a,i)),r=Math.max(0,Math.min(s-o,r));break;case 90:i=Math.max(0,Math.min(t-o,i)),r=Math.min(s,Math.max(a,r));break;case 180:i=Math.min(t,Math.max(a,i)),r=Math.min(s,Math.max(o,r));break;case 270:i=Math.min(t,Math.max(o,i)),r=Math.max(0,Math.min(s-a,r));break}this.x=i/=t,this.y=r/=s;const[c,h]=this.getBaseTranslation();i+=c,r+=h;const{style:u}=this.div;u.left=`${(100*i).toFixed(2)}%`,u.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return b(s=be,fh,Lp).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return b(s=be,fh,Lp).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions;this.div.style.width=`${(100*e/s).toFixed(2)}%`,l(this,Vr)||(this.div.style.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),r=!l(this,Vr)&&t.endsWith("%");if(i&&r)return;const[a,o]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!l(this,Vr)&&!r&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}altTextFinish(){var e;(e=l(this,Fe))==null||e.finish()}async addEditToolbar(){return this._editToolbar||l(this,Xr)?this._editToolbar:(this._editToolbar=new xp(this),this.div.append(this._editToolbar.render()),l(this,Fe)&&await this._editToolbar.addAltText(l(this,Fe)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=l(this,Fe))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){l(this,Fe)||(Id.initialize(be._l10n),m(this,Fe,new Id(this)),l(this,qr)&&(l(this,Fe).data=l(this,qr),m(this,qr,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=l(this,Fe))==null?void 0:e.data}set altTextData(e){l(this,Fe)&&(l(this,Fe).data=e)}get guessedAltText(){var e;return(e=l(this,Fe))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,Fe))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,Fe))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,Fe)&&!l(this,Fe).isEmpty()}hasAltTextData(){var e;return((e=l(this,Fe))==null?void 0:e.hasData())??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=l(this,Do)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),b(this,ee,$p).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),Rd(this,this.div,["pointerdown"]),this.div}pointerdown(e){const{isMac:t}=Dt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(m(this,Gr,!0),this._isDraggable){b(this,ee,G_).call(this,e);return}b(this,ee,jp).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}moveInDOM(){l(this,yi)&&clearTimeout(l(this,yi)),m(this,yi,setTimeout(()=>{var e;m(this,yi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,a]=this.pageDimensions,[o,c]=this.pageTranslation,h=e/i,u=t/i,d=this.x*r,f=this.y*a,p=this.width*r,g=this.height*a;switch(s){case 0:return[d+h+o,a-f-u-g+c,d+h+p+o,a-f-u+c];case 90:return[d+u+o,a-f+h+c,d+u+g+o,a-f+h+p+c];case 180:return[d-h-p+o,a-f+u+c,d-h+o,a-f+u+g+c];case 270:return[d-u-g+o,a-f-h-p+c,d-u+o,a-f-h+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,a]=e,o=r-s,c=a-i;switch(this.rotation){case 0:return[s,t-a,o,c];case 90:return[s,t-i,c,o];case 180:return[r,t-i,o,c];case 270:return[r,t-a,c,o];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){m(this,Xr,!0)}disableEditMode(){m(this,Xr,!1)}isInEditMode(){return l(this,Xr)}shouldGetKeyboardEvents(){return l(this,Xi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){b(this,ee,$p).call(this)}rotate(e){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Re("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,m(i,qr,e.accessibilityData);const[r,a]=i.pageDimensions,[o,c,h,u]=i.getRectInCurrentCoords(e.rect,a);return i.x=o/r,i.y=c/a,i.width=h/r,i.height=u/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e;if((e=l(this,zn))==null||e.abort(),m(this,zn,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),l(this,yi)&&(clearTimeout(l(this,yi)),m(this,yi,null)),b(this,ee,sc).call(this),this.removeEditToolbar(),l(this,bs)){for(const t of l(this,bs).values())clearTimeout(t);m(this,bs,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(b(this,ee,V_).call(this),l(this,gt).classList.remove("hidden"),Rd(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),m(this,Wr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,gt).children;if(!l(this,Us)){m(this,Us,Array.from(t));const a=b(this,ee,X_).bind(this),o=b(this,ee,K_).bind(this),c=this._uiManager._signal;for(const h of l(this,Us)){const u=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:c}),h.addEventListener("blur",o,{signal:c}),h.addEventListener("focus",b(this,ee,Z_).bind(this,u),{signal:c}),h.setAttribute("data-l10n-id",be._l10nResizer[u])}}const s=l(this,Us)[0];let i=0;for(const a of t){if(a===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(l(this,Us).length/4);if(r!==i){if(r<i)for(let o=0;o<i-r;o++)l(this,gt).append(l(this,gt).firstChild);else if(r>i)for(let o=0;o<r-i;o++)l(this,gt).firstChild.before(l(this,gt).lastChild);let a=0;for(const o of t){const h=l(this,Us)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",be._l10nResizer[h])}}b(this,ee,Up).call(this,0),m(this,Xi,!0),l(this,gt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,Xi)&&b(this,ee,Np).call(this,l(this,hh),{movementX:e,movementY:t})}_stopResizingWithKeyboard(){b(this,ee,sc).call(this),this.div.focus()}select(){var e,t,s;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,Fe))==null||s.toggleAltTextBadge(!1)}unselect(){var e,t,s,i,r;(e=l(this,gt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=l(this,Fe))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return l(this,uh)}set isEditing(e){m(this,uh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){m(this,Vr,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,bs)||m(this,bs,new Map);const{action:s}=e;let i=l(this,bs).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),l(this,bs).delete(s),l(this,bs).size===0&&m(this,bs,null)},be._telemetryTimeout),l(this,bs).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),m(this,Do,!1)}disable(){this.div&&(this.div.tabIndex=-1),m(this,Do,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};qr=new WeakMap,Us=new WeakMap,Fe=new WeakMap,Do=new WeakMap,Vr=new WeakMap,gt=new WeakMap,Wr=new WeakMap,zn=new WeakMap,hh=new WeakMap,Gr=new WeakMap,qn=new WeakMap,uh=new WeakMap,Xr=new WeakMap,Xi=new WeakMap,yi=new WeakMap,No=new WeakMap,jo=new WeakMap,bs=new WeakMap,dh=new WeakMap,Wd=new WeakMap,ee=new WeakSet,Mp=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this.fixAndSetPosition()},fh=new WeakSet,Lp=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Fp=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},V_=function(){if(l(this,gt))return;m(this,gt,document.createElement("div")),l(this,gt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");l(this,gt).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",b(this,ee,W_).bind(this,s),{signal:t}),i.addEventListener("contextmenu",ks,{signal:t}),i.tabIndex=-1}this.div.prepend(l(this,gt))},W_=function(e,t){var g;t.preventDefault();const{isMac:s}=Dt.platform;if(t.button!==0||t.ctrlKey&&s)return;(g=l(this,Fe))==null||g.toggle(!1);const i=this._isDraggable;this._isDraggable=!1;const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b(this,ee,Np).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("contextmenu",ks,{signal:a});const o=this.x,c=this.y,h=this.width,u=this.height,d=this.parent.div.style.cursor,f=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{var y;r.abort(),this.parent.togglePointerEvents(!0),(y=l(this,Fe))==null||y.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=d,this.div.style.cursor=f,b(this,ee,Dp).call(this,o,c,h,u)};window.addEventListener("pointerup",p,{signal:a}),window.addEventListener("blur",p,{signal:a})},Dp=function(e,t,s,i){const r=this.x,a=this.y,o=this.width,c=this.height;r===e&&a===t&&o===s&&c===i||this.addCommands({cmd:()=>{this.width=o,this.height=c,this.x=r,this.y=a;const[h,u]=this.parentDimensions;this.setDims(h*o,u*c),this.fixAndSetPosition()},undo:()=>{this.width=s,this.height=i,this.x=e,this.y=t;const[h,u]=this.parentDimensions;this.setDims(h*s,u*i),this.fixAndSetPosition()},mustExec:!0})},Np=function(e,t){const[s,i]=this.parentDimensions,r=this.x,a=this.y,o=this.width,c=this.height,h=be.MIN_SIZE/s,u=be.MIN_SIZE/i,d=W=>Math.round(W*1e4)/1e4,f=b(this,ee,Fp).call(this,this.rotation),p=(W,J)=>[f[0]*W+f[2]*J,f[1]*W+f[3]*J],g=b(this,ee,Fp).call(this,360-this.rotation),y=(W,J)=>[g[0]*W+g[2]*J,g[1]*W+g[3]*J];let v,w,A=!1,x=!1;switch(e){case"topLeft":A=!0,v=(W,J)=>[0,0],w=(W,J)=>[W,J];break;case"topMiddle":v=(W,J)=>[W/2,0],w=(W,J)=>[W/2,J];break;case"topRight":A=!0,v=(W,J)=>[W,0],w=(W,J)=>[0,J];break;case"middleRight":x=!0,v=(W,J)=>[W,J/2],w=(W,J)=>[0,J/2];break;case"bottomRight":A=!0,v=(W,J)=>[W,J],w=(W,J)=>[0,0];break;case"bottomMiddle":v=(W,J)=>[W/2,J],w=(W,J)=>[W/2,0];break;case"bottomLeft":A=!0,v=(W,J)=>[0,J],w=(W,J)=>[W,0];break;case"middleLeft":x=!0,v=(W,J)=>[0,J/2],w=(W,J)=>[W,J/2];break}const S=v(o,c),E=w(o,c);let C=p(...E);const T=d(r+C[0]),P=d(a+C[1]);let O=1,U=1,[M,re]=this.screenToPageTranslation(t.movementX,t.movementY);if([M,re]=y(M/s,re/i),A){const W=Math.hypot(o,c);O=U=Math.max(Math.min(Math.hypot(E[0]-S[0]-M,E[1]-S[1]-re)/W,1/o,1/c),h/o,u/c)}else x?O=Math.max(h,Math.min(1,Math.abs(E[0]-S[0]-M)))/o:U=Math.max(u,Math.min(1,Math.abs(E[1]-S[1]-re)))/c;const ae=d(o*O),pe=d(c*U);C=p(...w(ae,pe));const fe=T-C[0],ge=P-C[1];this.width=ae,this.height=pe,this.x=fe,this.y=ge,this.setDims(s*ae,i*pe),this.fixAndSetPosition()},jp=function(e){const{isMac:t}=Dt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},G_=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();const s=new AbortController,i=this._uiManager.combinedSignal(s);if(t){this.div.classList.add("moving"),m(this,No,e.clientX),m(this,jo,e.clientY);const a=o=>{const{clientX:c,clientY:h}=o,[u,d]=this.screenToPageTranslation(c-l(this,No),h-l(this,jo));m(this,No,c),m(this,jo,h),this._uiManager.dragSelectedEditors(u,d)};window.addEventListener("pointermove",a,{passive:!0,capture:!0,signal:i})}const r=()=>{s.abort(),t&&this.div.classList.remove("moving"),m(this,Gr,!1),this._uiManager.endDragSession()||b(this,ee,jp).call(this,e)};window.addEventListener("pointerup",r,{signal:i}),window.addEventListener("blur",r,{signal:i})},$p=function(){if(l(this,zn)||!this.div)return;m(this,zn,new AbortController);const e=this._uiManager.combinedSignal(l(this,zn));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},X_=function(e){be._resizerKeyboardManager.exec(this,e)},K_=function(e){var t;l(this,Xi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,gt)&&b(this,ee,sc).call(this)},Z_=function(e){m(this,hh,l(this,Xi)?e:"")},Up=function(e){if(l(this,Us))for(const t of l(this,Us))t.tabIndex=e},sc=function(){if(m(this,Xi,!1),b(this,ee,Up).call(this,-1),l(this,Wr)){const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=l(this,Wr);b(this,ee,Dp).call(this,e,t,s,i),m(this,Wr,null)}},_(be,fh),G(be,"_l10n",null),G(be,"_l10nResizer",null),G(be,"_borderLineWidth",-1),G(be,"_colorManager",new Cp),G(be,"_zIndex",1),G(be,"_telemetryTimeout",1e3);let we=be;class pC extends we{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const gy=3285377520,ms=4294901760,ri=65535;class Y_{constructor(e){this.h1=e?e&4294967295:gy,this.h2=e?e&4294967295:gy}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let y=0,v=e.length;y<v;y++){const w=e.charCodeAt(y);w<=255?t[s++]=w:(t[s++]=w>>>8,t[s++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,a=new Uint32Array(t.buffer,0,i);let o=0,c=0,h=this.h1,u=this.h2;const d=3432918353,f=461845907,p=d&ri,g=f&ri;for(let y=0;y<i;y++)y&1?(o=a[y],o=o*d&ms|o*p&ri,o=o<<15|o>>>17,o=o*f&ms|o*g&ri,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(c=a[y],c=c*d&ms|c*p&ri,c=c<<15|c>>>17,c=c*f&ms|c*g&ri,u^=c,u=u<<13|u>>>19,u=u*5+3864292196);switch(o=0,r){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*d&ms|o*p&ri,o=o<<15|o>>>17,o=o*f&ms|o*g&ri,i&1?h^=o:u^=o}this.h1=h,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&ms|e*36045&ri,t=t*4283543511&ms|((t<<16|e>>>16)*2950163797&ms)>>>16,e^=t>>>1,e=e*444984403&ms|e*60499&ri,t=t*3301882366&ms|((t<<16|e>>>16)*3120437893&ms)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Bp=Object.freeze({map:null,hash:"",transfer:void 0});var Kr,Zr,ut,Gd,J_;class dm{constructor(){_(this,Gd);_(this,Kr,!1);_(this,Zr,null);_(this,ut,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,ut).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,ut).get(e)}remove(e){if(l(this,ut).delete(e),l(this,ut).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of l(this,ut).values())if(t instanceof we)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,ut).get(e);let i=!1;if(s!==void 0)for(const[r,a]of Object.entries(t))s[r]!==a&&(i=!0,s[r]=a);else i=!0,l(this,ut).set(e,t);i&&b(this,Gd,J_).call(this),t instanceof we&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return l(this,ut).has(e)}getAll(){return l(this,ut).size>0?am(l(this,ut)):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return l(this,ut).size}resetModified(){l(this,Kr)&&(m(this,Kr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Q_(this)}get serializable(){if(l(this,ut).size===0)return Bp;const e=new Map,t=new Y_,s=[],i=Object.create(null);let r=!1;for(const[a,o]of l(this,ut)){const c=o instanceof we?o.serialize(!1,i):o;c&&(e.set(a,c),t.update(`${a}:${JSON.stringify(c)}`),r||(r=!!c.bitmap))}if(r)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Bp}get editorStats(){let e=null;const t=new Map;for(const s of l(this,ut).values()){if(!(s instanceof we))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:r}=i;t.has(r)||t.set(r,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const a=e[r]||(e[r]=new Map);for(const[o,c]of Object.entries(i)){if(o==="type")continue;let h=a.get(o);h||(h=new Map,a.set(o,h));const u=h.get(c)??0;h.set(c,u+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){m(this,Zr,null)}get modifiedIds(){if(l(this,Zr))return l(this,Zr);const e=[];for(const t of l(this,ut).values())!(t instanceof we)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return m(this,Zr,{ids:new Set(e),hash:e.join(",")})}}Kr=new WeakMap,Zr=new WeakMap,ut=new WeakMap,Gd=new WeakSet,J_=function(){l(this,Kr)||(m(this,Kr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var ph;class Q_ extends dm{constructor(t){super();_(this,ph);const{map:s,hash:i,transfer:r}=t.serializable,a=structuredClone(s,r?{transfer:r}:null);m(this,ph,{map:a,hash:i,transfer:r})}get print(){Re("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,ph)}get modifiedIds(){return he(this,"modifiedIds",{ids:new Set,hash:""})}}ph=new WeakMap;var $o;class gC{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){_(this,$o,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,$o).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||l(this,$o).has(e.loadedName))){if(st(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:r}=e,a=new FontFace(s,i,r);this.addNativeFontFace(a);try{await a.load(),l(this,$o).add(s),t==null||t(e)}catch{ie(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Re("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw ie(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return he(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Pt||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),he(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(st(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return he(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(S,E){return S.charCodeAt(E)<<24|S.charCodeAt(E+1)<<16|S.charCodeAt(E+2)<<8|S.charCodeAt(E+3)&255}function i(S,E,C,T){const P=S.substring(0,E),O=S.substring(E+C);return P+T+O}let r,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const c=o.getContext("2d");let h=0;function u(S,E){if(++h>30){ie("Load test font never loaded."),E();return}if(c.font="30px "+S,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){E();return}setTimeout(u.bind(null,S,E))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,d.length,d);const g=16,y=1482184792;let v=s(f,g);for(r=0,a=d.length-3;r<a;r+=4)v=v-y+s(d,r)|0;r<d.length&&(v=v-y+s(d+"XXX",r)|0),f=i(f,g,4,QE(v));const w=`url(data:font/opentype;base64,${btoa(f)});`,A=`@font-face {font-family:"${d}";src:${w}}`;this.insertRule(A);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const S of[e.loadedName,d]){const E=this._document.createElement("span");E.textContent="Hi",E.style.fontFamily=S,x.append(E)}this._document.body.append(x),u(d,()=>{x.remove(),t.complete()})}}$o=new WeakMap;class mC{constructor(e,{disableFontFace:t=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this.disableFontFace=t===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${rC(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let s;try{s=e.get(this.loadedName+"_path_"+t)}catch(r){ie(`getPathGenerator - ignoring character: "${r}".`)}if(!Array.isArray(s)||s.length===0)return this.compiledGlyphs[t]=function(r,a){};const i=[];for(let r=0,a=s.length;r<a;)switch(s[r++]){case Fi.BEZIER_CURVE_TO:{const[o,c,h,u,d,f]=s.slice(r,r+6);i.push(p=>p.bezierCurveTo(o,c,h,u,d,f)),r+=6}break;case Fi.MOVE_TO:{const[o,c]=s.slice(r,r+2);i.push(h=>h.moveTo(o,c)),r+=2}break;case Fi.LINE_TO:{const[o,c]=s.slice(r,r+2);i.push(h=>h.lineTo(o,c)),r+=2}break;case Fi.QUADRATIC_CURVE_TO:{const[o,c,h,u]=s.slice(r,r+4);i.push(d=>d.quadraticCurveTo(o,c,h,u)),r+=4}break;case Fi.RESTORE:i.push(o=>o.restore());break;case Fi.SAVE:i.push(o=>o.save());break;case Fi.SCALE:st(i.length===2,"Scale command is only valid at the third position.");break;case Fi.TRANSFORM:{const[o,c,h,u,d,f]=s.slice(r,r+6);i.push(p=>p.transform(o,c,h,u,d,f)),r+=6}break;case Fi.TRANSLATE:{const[o,c]=s.slice(r,r+2);i.push(h=>h.translate(o,c)),r+=2}break}return this.compiledGlyphs[t]=function(a,o){i[0](a),i[1](a),a.scale(o,-o);for(let c=2,h=i.length;c<h;c++)i[c](a)}}}var gh;class ev{constructor({enableHWA:e=!1}){_(this,gh,!1);m(this,gh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,gh)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Re("Abstract method `_createCanvas` called.")}}gh=new WeakMap;class yC extends ev{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class tv{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Re("Abstract method `_fetch` called.")}}class sv extends tv{async _fetch(e){const t=await _f(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):bf(t)}}class iv{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Yr,Jr,bi,Ki,Et,Xd,Qr,$,At,no,ro,Wu,ao,nv,Hp,oo,ic,nc,zp,rc;class bC extends iv{constructor({docId:t,ownerDocument:s=globalThis.document}){super();_(this,$);_(this,Yr);_(this,Jr);_(this,bi);_(this,Ki);_(this,Et);_(this,Xd);_(this,Qr,0);m(this,Ki,t),m(this,Et,s)}addFilter(t){if(!t)return"none";let s=l(this,$,At).get(t);if(s)return s;const[i,r,a]=b(this,$,Wu).call(this,t),o=t.length===1?i:`${i}${r}${a}`;if(s=l(this,$,At).get(o),s)return l(this,$,At).set(t,s),s;const c=`g_${l(this,Ki)}_transfer_map_${nt(this,Qr)._++}`,h=b(this,$,ao).call(this,c);l(this,$,At).set(t,h),l(this,$,At).set(o,h);const u=b(this,$,oo).call(this,c);return b(this,$,nc).call(this,i,r,a,u),h}addHCMFilter(t,s){var g;const i=`${t}-${s}`,r="base";let a=l(this,$,no).get(r);if((a==null?void 0:a.key)===i||(a?((g=a.filter)==null||g.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},l(this,$,no).set(r,a)),!t||!s))return a.url;const o=b(this,$,rc).call(this,t);t=B.makeHexColor(...o);const c=b(this,$,rc).call(this,s);if(s=B.makeHexColor(...c),l(this,$,ro).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const h=new Array(256);for(let y=0;y<=255;y++){const v=y/255;h[y]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const u=h.join(","),d=`g_${l(this,Ki)}_hcm_filter`,f=a.filter=b(this,$,oo).call(this,d);b(this,$,nc).call(this,u,u,u,f),b(this,$,Hp).call(this,f);const p=(y,v)=>{const w=o[y]/255,A=c[y]/255,x=new Array(v+1);for(let S=0;S<=v;S++)x[S]=w+S/v*(A-w);return x.join(",")};return b(this,$,nc).call(this,p(0,5),p(1,5),p(2,5),f),a.url=b(this,$,ao).call(this,d),a.url}addAlphaFilter(t){let s=l(this,$,At).get(t);if(s)return s;const[i]=b(this,$,Wu).call(this,[t]),r=`alpha_${i}`;if(s=l(this,$,At).get(r),s)return l(this,$,At).set(t,s),s;const a=`g_${l(this,Ki)}_alpha_map_${nt(this,Qr)._++}`,o=b(this,$,ao).call(this,a);l(this,$,At).set(t,o),l(this,$,At).set(r,o);const c=b(this,$,oo).call(this,a);return b(this,$,zp).call(this,i,c),o}addLuminosityFilter(t){let s=l(this,$,At).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=b(this,$,Wu).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=l(this,$,At).get(r),s)return l(this,$,At).set(t,s),s;const a=`g_${l(this,Ki)}_luminosity_map_${nt(this,Qr)._++}`,o=b(this,$,ao).call(this,a);l(this,$,At).set(t,o),l(this,$,At).set(r,o);const c=b(this,$,oo).call(this,a);return b(this,$,nv).call(this,c),t&&b(this,$,zp).call(this,i,c),o}addHighlightHCMFilter(t,s,i,r,a){var A;const o=`${s}-${i}-${r}-${a}`;let c=l(this,$,no).get(t);if((c==null?void 0:c.key)===o||(c?((A=c.filter)==null||A.remove(),c.key=o,c.url="none",c.filter=null):(c={key:o,url:"none",filter:null},l(this,$,no).set(t,c)),!s||!i))return c.url;const[h,u]=[s,i].map(b(this,$,rc).bind(this));let d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[p,g]=[r,a].map(b(this,$,rc).bind(this));f<d&&([d,f,p,g]=[f,d,g,p]),l(this,$,ro).style.color="";const y=(x,S,E)=>{const C=new Array(256),T=(f-d)/E,P=x/255,O=(S-x)/(255*E);let U=0;for(let M=0;M<=E;M++){const re=Math.round(d+M*T),ae=P+M*O;for(let pe=U;pe<=re;pe++)C[pe]=ae;U=re+1}for(let M=U;M<256;M++)C[M]=C[U-1];return C.join(",")},v=`g_${l(this,Ki)}_hcm_${t}_filter`,w=c.filter=b(this,$,oo).call(this,v);return b(this,$,Hp).call(this,w),b(this,$,nc).call(this,y(p[0],g[0],5),y(p[1],g[1],5),y(p[2],g[2],5),w),c.url=b(this,$,ao).call(this,v),c.url}destroy(t=!1){t&&l(this,$,no).size!==0||(l(this,bi)&&(l(this,bi).parentNode.parentNode.remove(),m(this,bi,null)),l(this,Jr)&&(l(this,Jr).clear(),m(this,Jr,null)),m(this,Qr,0))}}Yr=new WeakMap,Jr=new WeakMap,bi=new WeakMap,Ki=new WeakMap,Et=new WeakMap,Xd=new WeakMap,Qr=new WeakMap,$=new WeakSet,At=function(){return l(this,Jr)||m(this,Jr,new Map)},no=function(){return l(this,Xd)||m(this,Xd,new Map)},ro=function(){if(!l(this,bi)){const t=l(this,Et).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=l(this,Et).createElementNS($i,"svg");i.setAttribute("width",0),i.setAttribute("height",0),m(this,bi,l(this,Et).createElementNS($i,"defs")),t.append(i),i.append(l(this,bi)),l(this,Et).body.append(t)}return l(this,bi)},Wu=function(t){if(t.length===1){const h=t[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=h[f]/255;const d=u.join(",");return[d,d,d]}const[s,i,r]=t,a=new Array(256),o=new Array(256),c=new Array(256);for(let h=0;h<256;h++)a[h]=s[h]/255,o[h]=i[h]/255,c[h]=r[h]/255;return[a.join(","),o.join(","),c.join(",")]},ao=function(t){if(l(this,Yr)===void 0){m(this,Yr,"");const s=l(this,Et).URL;s!==l(this,Et).baseURI&&(vf(s)?ie('#createUrl: ignore "data:"-URL for performance reasons.'):m(this,Yr,s.split("#",1)[0]))}return`url(${l(this,Yr)}#${t})`},nv=function(t){const s=l(this,Et).createElementNS($i,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Hp=function(t){const s=l(this,Et).createElementNS($i,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},oo=function(t){const s=l(this,Et).createElementNS($i,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,$,ro).append(s),s},ic=function(t,s,i){const r=l(this,Et).createElementNS($i,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},nc=function(t,s,i,r){const a=l(this,Et).createElementNS($i,"feComponentTransfer");r.append(a),b(this,$,ic).call(this,a,"feFuncR",t),b(this,$,ic).call(this,a,"feFuncG",s),b(this,$,ic).call(this,a,"feFuncB",i)},zp=function(t,s){const i=l(this,Et).createElementNS($i,"feComponentTransfer");s.append(i),b(this,$,ic).call(this,i,"feFuncA",t)},rc=function(t){return l(this,$,ro).style.color=t,um(getComputedStyle(l(this,$,ro)).getPropertyValue("color"))};class rv{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Re("Abstract method `_fetch` called.")}}class av extends rv{async _fetch(e){const t=await _f(e,"arraybuffer");return new Uint8Array(t)}}if(Pt){var qp=Promise.withResolvers(),Sc=null;(async()=>{const e=await Ys(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),t=await Ys(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),s=await Ys(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),i=await Ys(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);let r,a;return new Map(Object.entries({fs:e,http:t,https:s,url:i,canvas:r,path2d:a}))})().then(e=>{Sc=e,qp.resolve()},e=>{ie(`loadPackages: ${e}`),Sc=new Map,qp.resolve()})}class yr{static get promise(){return qp.promise}static get(e){return Sc==null?void 0:Sc.get(e)}}async function ov(n){const t=await yr.get("fs").promises.readFile(n);return new Uint8Array(t)}class _C extends iv{}class vC extends ev{_createCanvas(e,t){return yr.get("canvas").createCanvas(e,t)}}class wC extends tv{async _fetch(e){return ov(e)}}class AC extends rv{async _fetch(e){return ov(e)}}const Lt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Vp(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}class fm{getPattern(){Re("Abstract method `getPattern` called.")}}class xC extends fm{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let r;if(i===Lt.STROKE||i===Lt.FILL){const a=t.current.getClippedPathBoundingBox(i,Ne(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,c),u=h.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-a[0],-a[1]),s=B.transform(s,[1,0,0,1,a[0],a[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),Vp(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),r=e.createPattern(h.canvas,"no-repeat");const d=new DOMMatrix(s);r.setTransform(d)}else Vp(e,this._bbox),r=this._createGradient(e);return r}}function Bf(n,e,t,s,i,r,a,o){const c=e.coords,h=e.colors,u=n.data,d=n.width*4;let f;c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=r,r=a,a=f),c[s+1]>c[i+1]&&(f=s,s=i,i=f,f=a,a=o,o=f),c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=r,r=a,a=f);const p=(c[t]+e.offsetX)*e.scaleX,g=(c[t+1]+e.offsetY)*e.scaleY,y=(c[s]+e.offsetX)*e.scaleX,v=(c[s+1]+e.offsetY)*e.scaleY,w=(c[i]+e.offsetX)*e.scaleX,A=(c[i+1]+e.offsetY)*e.scaleY;if(g>=A)return;const x=h[r],S=h[r+1],E=h[r+2],C=h[a],T=h[a+1],P=h[a+2],O=h[o],U=h[o+1],M=h[o+2],re=Math.round(g),ae=Math.round(A);let pe,fe,ge,W,J,xn,Li,gs;for(let vt=re;vt<=ae;vt++){if(vt<v){const Ie=vt<g?0:(g-vt)/(g-v);pe=p-(p-y)*Ie,fe=x-(x-C)*Ie,ge=S-(S-T)*Ie,W=E-(E-P)*Ie}else{let Ie;vt>A?Ie=1:v===A?Ie=0:Ie=(v-vt)/(v-A),pe=y-(y-w)*Ie,fe=C-(C-O)*Ie,ge=T-(T-U)*Ie,W=P-(P-M)*Ie}let Xe;vt<g?Xe=0:vt>A?Xe=1:Xe=(g-vt)/(g-A),J=p-(p-w)*Xe,xn=x-(x-O)*Xe,Li=S-(S-U)*Xe,gs=E-(E-M)*Xe;const Ya=Math.round(Math.min(pe,J)),zl=Math.round(Math.max(pe,J));let Ut=d*vt+Ya*4;for(let Ie=Ya;Ie<=zl;Ie++)Xe=(pe-Ie)/(pe-J),Xe<0?Xe=0:Xe>1&&(Xe=1),u[Ut++]=fe-(fe-xn)*Xe|0,u[Ut++]=ge-(ge-Li)*Xe|0,u[Ut++]=W-(W-gs)*Xe|0,u[Ut++]=255}}function SC(n,e,t){const s=e.coords,i=e.colors;let r,a;switch(e.type){case"lattice":const o=e.verticesPerRow,c=Math.floor(s.length/o)-1,h=o-1;for(r=0;r<c;r++){let u=r*o;for(let d=0;d<h;d++,u++)Bf(n,t,s[u],s[u+1],s[u+o],i[u],i[u+1],i[u+o]),Bf(n,t,s[u+o+1],s[u+1],s[u+o],i[u+o+1],i[u+1],i[u+o])}break;case"triangles":for(r=0,a=s.length;r<a;r+=3)Bf(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class EC extends fm{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,u=Math.ceil(this._bounds[3])-c,d=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),p=h/d,g=u/f,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-c,scaleX:1/p,scaleY:1/g},v=d+2*2,w=f+2*2,A=s.getCanvas("mesh",v,w),x=A.context,S=x.createImageData(d,f);if(t){const C=S.data;for(let T=0,P=C.length;T<P;T+=4)C[T]=t[0],C[T+1]=t[1],C[T+2]=t[2],C[T+3]=255}for(const C of this._figures)SC(S,C,y);return x.putImageData(S,2,2),{canvas:A.canvas,offsetX:o-2*p,offsetY:c-2*g,scaleX:p,scaleY:g}}getPattern(e,t,s,i){Vp(e,this._bbox);let r;if(i===Lt.SHADING)r=B.singularValueDecompose2dScale(Ne(e));else if(r=B.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=B.singularValueDecompose2dScale(this.matrix);r=[r[0]*o[0],r[1]*o[1]]}const a=this._createMeshCanvas(r,i===Lt.SHADING?null:this._background,t.cachedCanvases);return i!==Lt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class CC extends fm{getPattern(){return"hotpink"}}function kC(n){switch(n[0]){case"RadialAxial":return new xC(n);case"Mesh":return new EC(n);case"Dummy":return new CC}throw new Error(`Unknown IR type: ${n[0]}`)}const my={COLORED:1,UNCOLORED:2},Kd=class Kd{constructor(e,t,s,i,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:r,color:a,canvasGraphicsFactory:o}=this;let{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),mf("TilingType: "+r);const u=t[0],d=t[1],f=t[2],p=t[3],g=f-u,y=p-d,v=B.singularValueDecompose2dScale(this.matrix),w=B.singularValueDecompose2dScale(this.baseTransform),A=v[0]*w[0],x=v[1]*w[1];let S=g,E=y,C=!1,T=!1;const P=Math.ceil(c*A),O=Math.ceil(h*x),U=Math.ceil(g*A),M=Math.ceil(y*x);P>=U?S=c:C=!0,O>=M?E=h:T=!0;const re=this.getSizeAndScale(S,this.ctx.canvas.width,A),ae=this.getSizeAndScale(E,this.ctx.canvas.height,x),pe=e.cachedCanvases.getCanvas("pattern",re.size,ae.size),fe=pe.context,ge=o.createCanvasGraphics(fe);if(ge.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(ge,i,a),fe.translate(-re.scale*u,-ae.scale*d),ge.transform(re.scale,0,0,ae.scale,0,0),fe.save(),this.clipBbox(ge,u,d,f,p),ge.baseTransform=Ne(ge.ctx),ge.executeOperatorList(s),ge.endDrawing(),fe.restore(),C||T){const W=pe.canvas;C&&(S=c),T&&(E=h);const J=this.getSizeAndScale(S,this.ctx.canvas.width,A),xn=this.getSizeAndScale(E,this.ctx.canvas.height,x),Li=J.size,gs=xn.size,vt=e.cachedCanvases.getCanvas("pattern-workaround",Li,gs),Xe=vt.context,Ya=C?Math.floor(g/c):0,zl=T?Math.floor(y/h):0;for(let Ut=0;Ut<=Ya;Ut++)for(let Ie=0;Ie<=zl;Ie++)Xe.drawImage(W,Li*Ut,gs*Ie,Li,gs,0,0,Li,gs);return{canvas:vt.canvas,scaleX:J.scale,scaleY:xn.scale,offsetX:u,offsetY:d}}return{canvas:pe.canvas,scaleX:re.scale,scaleY:ae.scale,offsetX:u,offsetY:d}}getSizeAndScale(e,t,s){const i=Math.max(Kd.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const a=i-t,o=r-s;e.ctx.rect(t,s,a,o),e.current.updateRectMinMax(Ne(e.ctx),[t,s,i,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case my.COLORED:const a=this.ctx;i.fillStyle=a.fillStyle,i.strokeStyle=a.strokeStyle,r.fillColor=a.fillStyle,r.strokeColor=a.strokeStyle;break;case my.UNCOLORED:const o=B.makeHexColor(s[0],s[1],s[2]);i.fillStyle=o,i.strokeStyle=o,r.fillColor=o,r.strokeColor=o;break;default:throw new JE(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,i){let r=s;i!==Lt.SHADING&&(r=B.transform(r,t.baseTransform),this.matrix&&(r=B.transform(r,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(r);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");return c.setTransform(o),c}};G(Kd,"MAX_PATTERN_SIZE",3e3);let Wp=Kd;function TC({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const o=Dt.isLittleEndian?4278190080:255,[c,h]=a?[r,o]:[o,r],u=s>>3,d=s&7,f=n.length;t=new Uint32Array(t.buffer);let p=0;for(let g=0;g<i;g++){for(const v=e+u;e<v;e++){const w=e<f?n[e]:255;t[p++]=w&128?h:c,t[p++]=w&64?h:c,t[p++]=w&32?h:c,t[p++]=w&16?h:c,t[p++]=w&8?h:c,t[p++]=w&4?h:c,t[p++]=w&2?h:c,t[p++]=w&1?h:c}if(d===0)continue;const y=e<f?n[e++]:255;for(let v=0;v<d;v++)t[p++]=y&1<<7-v?h:c}return{srcPos:e,destPos:p}}const yy=16,by=100,PC=15,_y=10,vy=1e3,Xt=16;function RC(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(s,i){e.translate(s,i),this.__originalTranslate(s,i)},n.scale=function(s,i){e.scale(s,i),this.__originalScale(s,i)},n.transform=function(s,i,r,a,o,c){e.transform(s,i,r,a,o,c),this.__originalTransform(s,i,r,a,o,c)},n.setTransform=function(s,i,r,a,o,c){e.setTransform(s,i,r,a,o,c),this.__originalSetTransform(s,i,r,a,o,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){e.rotate(s),this.__originalRotate(s)},n.clip=function(s){e.clip(s),this.__originalClip(s)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,a,o){e.bezierCurveTo(t,s,i,r,a,o),this.__originalBezierCurveTo(t,s,i,r,a,o)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class IC{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Tu(n,e,t,s,i,r,a,o,c,h){const[u,d,f,p,g,y]=Ne(n);if(d===0&&f===0){const A=a*u+g,x=Math.round(A),S=o*p+y,E=Math.round(S),C=(a+c)*u+g,T=Math.abs(Math.round(C)-x)||1,P=(o+h)*p+y,O=Math.abs(Math.round(P)-E)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(p),x,E),n.drawImage(e,t,s,i,r,0,0,T,O),n.setTransform(u,d,f,p,g,y),[T,O]}if(u===0&&p===0){const A=o*f+g,x=Math.round(A),S=a*d+y,E=Math.round(S),C=(o+h)*f+g,T=Math.abs(Math.round(C)-x)||1,P=(a+c)*d+y,O=Math.abs(Math.round(P)-E)||1;return n.setTransform(0,Math.sign(d),Math.sign(f),0,x,E),n.drawImage(e,t,s,i,r,0,0,O,T),n.setTransform(u,d,f,p,g,y),[O,T]}n.drawImage(e,t,s,i,r,a,o,c,h);const v=Math.hypot(u,d),w=Math.hypot(f,p);return[v*c,w*h]}function OC(n){const{width:e,height:t}=n;if(e>vy||t>vy)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1;let a=new Uint8Array(r*(t+1)),o,c,h;const u=e+7&-8;let d=new Uint8Array(u*t),f=0;for(const w of n.data){let A=128;for(;A>0;)d[f++]=w&A?0:255,A>>=1}let p=0;for(f=0,d[f]!==0&&(a[0]=1,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(a[c]=d[f]?2:1,++p),f++;for(d[f]!==0&&(a[c]=2,++p),o=1;o<t;o++){f=o*u,h=o*r,d[f-u]!==d[f]&&(a[h]=d[f]?1:8,++p);let w=(d[f]?4:0)+(d[f-u]?8:0);for(c=1;c<e;c++)w=(w>>2)+(d[f+1]?4:0)+(d[f-u+1]?8:0),i[w]&&(a[h+c]=i[w],++p),f++;if(d[f-u]!==d[f]&&(a[h+c]=d[f]?2:4,++p),p>s)return null}for(f=u*(t-1),h=o*r,d[f]!==0&&(a[h]=8,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(a[h+c]=d[f]?4:8,++p),f++;if(d[f]!==0&&(a[h+c]=4,++p),p>s)return null;const g=new Int32Array([0,r,-1,0,-r,0,0,0,1]),y=new Path2D;for(o=0;p&&o<=t;o++){let w=o*r;const A=w+e;for(;w<A&&!a[w];)w++;if(w===A)continue;y.moveTo(w%r,o);const x=w;let S=a[w];do{const E=g[S];do w+=E;while(!a[w]);const C=a[w];C!==5&&C!==10?(S=C,a[w]=0):(S=C&51*S>>4,a[w]&=S>>2|S<<2),y.lineTo(w%r,w/r|0),a[w]||--p}while(x!==w);--o}return d=null,a=null,function(w){w.save(),w.scale(1/e,-1/t),w.translate(0,-t),w.fill(y),w.beginPath(),w.restore()}}class wy{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=S_,this.textMatrixScale=1,this.fontMatrix=bp,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=wt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=B.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=B.applyTransform(t,e),i=B.applyTransform(t.slice(2),e),r=B.applyTransform([t[0],t[3]],e),a=B.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],i[0],r[0],a[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],a[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],a[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],a[1])}updateScalingPathMinMax(e,t){B.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,i,r,a,o,c,h,u){const d=B.bezierBoundingBox(t,s,i,r,a,o,c,h,u);u||this.updateRectMinMax(e,d)}getPathBoundingBox(e=Lt.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===Lt.STROKE){t||Re("Stroke bounding box must include transform.");const i=B.singularValueDecompose2dScale(t),r=i[0]*this.lineWidth/2,a=i[1]*this.lineWidth/2;s[0]-=r,s[1]-=a,s[2]+=r,s[3]+=a}return s}updateClipFromPath(){const e=B.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Lt.FILL,t=null){return B.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Ay(n,e){if(typeof ImageData<"u"&&e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Xt,r=(t-i)/Xt,a=i===0?r:r+1,o=n.createImageData(s,Xt);let c=0,h;const u=e.data,d=o.data;let f,p,g,y;if(e.kind===$u.GRAYSCALE_1BPP){const v=u.byteLength,w=new Uint32Array(d.buffer,0,d.byteLength>>2),A=w.length,x=s+7>>3,S=4294967295,E=Dt.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(g=f<r?Xt:i,h=0,p=0;p<g;p++){const C=v-c;let T=0;const P=C>x?s:C*8-7,O=P&-8;let U=0,M=0;for(;T<O;T+=8)M=u[c++],w[h++]=M&128?S:E,w[h++]=M&64?S:E,w[h++]=M&32?S:E,w[h++]=M&16?S:E,w[h++]=M&8?S:E,w[h++]=M&4?S:E,w[h++]=M&2?S:E,w[h++]=M&1?S:E;for(;T<P;T++)U===0&&(M=u[c++],U=128),w[h++]=M&U?S:E,U>>=1}for(;h<A;)w[h++]=0;n.putImageData(o,0,f*Xt)}}else if(e.kind===$u.RGBA_32BPP){for(p=0,y=s*Xt*4,f=0;f<r;f++)d.set(u.subarray(c,c+y)),c+=y,n.putImageData(o,0,p),p+=Xt;f<a&&(y=s*i*4,d.set(u.subarray(c,c+y)),n.putImageData(o,0,p))}else if(e.kind===$u.RGB_24BPP)for(g=Xt,y=s*g,f=0;f<a;f++){for(f>=r&&(g=i,y=s*g),h=0,p=y;p--;)d[h++]=u[c++],d[h++]=u[c++],d[h++]=u[c++],d[h++]=255;n.putImageData(o,0,f*Xt)}else throw new Error(`bad image kind: ${e.kind}`)}function xy(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Xt,r=(t-i)/Xt,a=i===0?r:r+1,o=n.createImageData(s,Xt);let c=0;const h=e.data,u=o.data;for(let d=0;d<a;d++){const f=d<r?Xt:i;({srcPos:c}=TC({src:h,srcPos:c,dest:u,width:s,height:f,nonBlackColor:0})),n.putImageData(o,0,d*Xt)}}function Xl(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Pu(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!Pt){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function Sy(n,e){if(e)return!0;const t=B.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*mr.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const MC=["butt","round","square"],LC=["miter","round","bevel"],FC={},Ey={};var _r,Gp,Xp;const Vm=class Vm{constructor(e,t,s,i,r,{optionalContentConfig:a,markedContentStack:o=null},c,h){_(this,_r);this.ctx=e,this.current=new wy(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new IC(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,s){const c=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Ne(this.compositeCtx))}this.ctx.save(),Pu(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ne(this.ctx)}executeOperatorList(e,t,s,i){const r=e.argsArray,a=e.fnArray;let o=t||0;const c=r.length;if(c===o)return o;const h=c-o>_y&&typeof s=="function",u=h?Date.now()+PC:0;let d=0;const f=this.commonObjs,p=this.objs;let g;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(g=a[o],g!==Ms.dependency)this[g].apply(this,r[o]);else for(const y of r[o]){const v=y.startsWith("g_")?f:p;if(!v.has(y))return v.get(y,s),o}if(o++,o===c)return o;if(h&&++d>_y){if(Date.now()>u)return s(),o;d=0}}}endDrawing(){b(this,_r,Gp).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),b(this,_r,Xp).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,c=i,h="prescale1",u,d;for(;r>2&&o>1||a>2&&c>1;){let f=o,p=c;r>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),r/=o/f),a>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/p),u=this.cachedCanvases.getCanvas(h,f,p),d=u.context,d.clearRect(0,0,f,p),d.drawImage(e,0,0,o,c,0,0,f,p),e=u.canvas,o=f,c=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,r=this.current.fillColor,a=this.current.patternFill,o=Ne(t);let c,h,u,d;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;h=JSON.stringify(a?o:[o.slice(0,4),r]),c=this._cachedBitmapsMap.get(P),c||(c=new Map,this._cachedBitmapsMap.set(P,c));const O=c.get(h);if(O&&!a){const U=Math.round(Math.min(o[0],o[2])+o[4]),M=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:O,offsetX:U,offsetY:M}}u=O}u||(d=this.cachedCanvases.getCanvas("maskCanvas",s,i),xy(d.context,e));let f=B.transform(o,[1/s,0,0,-1/i,0,0]);f=B.transform(f,[1,0,0,1,0,-i]);const[p,g,y,v]=B.getAxialAlignedBoundingBox([0,0,s,i],f),w=Math.round(y-p)||1,A=Math.round(v-g)||1,x=this.cachedCanvases.getCanvas("fillCanvas",w,A),S=x.context,E=p,C=g;S.translate(-E,-C),S.transform(...f),u||(u=this._scaleImage(d.canvas,Di(S)),u=u.img,c&&a&&c.set(h,u)),S.imageSmoothingEnabled=Sy(Ne(S),e.interpolate),Tu(S,u,0,0,u.width,u.height,0,0,s,i),S.globalCompositeOperation="source-in";const T=B.transform(Di(S),[1,0,0,1,-E,-C]);return S.fillStyle=a?r.getPattern(t,this,T,Lt.FILL):r,S.fillRect(0,0,s,i),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(h,x.canvas)),{canvas:x.canvas,offsetX:Math.round(E),offsetY:Math.round(C)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=MC[e]}setLineJoin(e){this.ctx.lineJoin=LC[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform(...Ne(this.suspendedCtx)),Xl(this.suspendedCtx,r),RC(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Xl(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],a=i[1],o=i[2]-r,c=i[3]-a;o===0||c===0||(this.genericComposeSMask(t.context,s,o,c,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,a,o,c,h,u,d){let f=e.canvas,p=c-u,g=h-d;if(a){const v=B.makeHexColor(...a);if(p<0||g<0||p+s>f.width||g+i>f.height){const w=this.cachedCanvases.getCanvas("maskExtension",s,i),A=w.context;A.drawImage(f,-p,-g),A.globalCompositeOperation="destination-atop",A.fillStyle=v,A.fillRect(0,0,s,i),A.globalCompositeOperation="source-over",f=w.canvas,p=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const w=new Path2D;w.rect(p,g,s,i),e.clip(w),e.globalCompositeOperation="destination-atop",e.fillStyle=v,e.fillRect(p,g,s,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(c,h,s,i),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(f,p,g,s,i,c,h,s,i),t.restore()}save(){this.inSMaskMode?(Xl(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Xl(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,i,r,a){this.ctx.transform(e,t,s,i,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const i=this.ctx,r=this.current;let a=r.x,o=r.y,c,h;const u=Ne(i),d=u[0]===0&&u[3]===0||u[1]===0&&u[2]===0,f=d?s.slice(0):null;for(let p=0,g=0,y=e.length;p<y;p++)switch(e[p]|0){case Ms.rectangle:a=t[g++],o=t[g++];const v=t[g++],w=t[g++],A=a+v,x=o+w;i.moveTo(a,o),v===0||w===0?i.lineTo(A,x):(i.lineTo(A,o),i.lineTo(A,x),i.lineTo(a,x)),d||r.updateRectMinMax(u,[a,o,A,x]),i.closePath();break;case Ms.moveTo:a=t[g++],o=t[g++],i.moveTo(a,o),d||r.updatePathMinMax(u,a,o);break;case Ms.lineTo:a=t[g++],o=t[g++],i.lineTo(a,o),d||r.updatePathMinMax(u,a,o);break;case Ms.curveTo:c=a,h=o,a=t[g+4],o=t[g+5],i.bezierCurveTo(t[g],t[g+1],t[g+2],t[g+3],a,o),r.updateCurvePathMinMax(u,c,h,t[g],t[g+1],t[g+2],t[g+3],a,o,f),g+=6;break;case Ms.curveTo2:c=a,h=o,i.bezierCurveTo(a,o,t[g],t[g+1],t[g+2],t[g+3]),r.updateCurvePathMinMax(u,c,h,a,o,t[g],t[g+1],t[g+2],t[g+3],f),a=t[g+2],o=t[g+3],g+=4;break;case Ms.curveTo3:c=a,h=o,a=t[g+2],o=t[g+3],i.bezierCurveTo(t[g],t[g+1],a,o,a,o),r.updateCurvePathMinMax(u,c,h,t[g],t[g+1],a,o,a,o,f),g+=4;break;case Ms.closePath:i.closePath();break}d&&r.updateScalingPathMinMax(u,f),r.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(t.save(),t.strokeStyle=s.getPattern(t,this,Di(t),Lt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let r=!1;i&&(t.save(),t.fillStyle=s.getPattern(t,this,Di(t),Lt.FILL),r=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=FC}eoClip(){this.pendingClip=Ey}beginText(){this.current.textMatrix=S_,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}t.save(),t.beginPath();for(const s of e)t.setTransform(...s.transform),t.translate(s.x,s.y),s.addToPath(t,s.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var u;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||bp,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&ie("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const r=s.loadedName||"sans-serif",a=((u=s.systemFontInfo)==null?void 0:u.css)||`"${r}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const c=s.italic?"italic":"normal";let h=t;t<yy?h=yy:t>by&&(h=by),this.current.fontSizeScale=t/h,this.ctx.font=`${c} ${o} ${h}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,i,r,a){this.current.textMatrix=[e,t,s,i,r,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i){const r=this.ctx,a=this.current,o=a.font,c=a.textRenderingMode,h=a.fontSize/a.fontSizeScale,u=c&wt.FILL_STROKE_MASK,d=!!(c&wt.ADD_TO_PATH_FLAG),f=a.patternFill&&!o.missingFile;let p;(o.disableFontFace||d||f)&&(p=o.getPathGenerator(this.commonObjs,e)),o.disableFontFace||f?(r.save(),r.translate(t,s),r.beginPath(),p(r,h),i&&r.setTransform(...i),(u===wt.FILL||u===wt.FILL_STROKE)&&r.fill(),(u===wt.STROKE||u===wt.FILL_STROKE)&&r.stroke(),r.restore()):((u===wt.FILL||u===wt.FILL_STROKE)&&r.fillText(e,t,s),(u===wt.STROKE||u===wt.FILL_STROKE)&&r.strokeText(e,t,s)),d&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ne(r),x:t,y:s,fontSize:h,addToPath:p})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return he(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const r=this.ctx,a=t.fontSizeScale,o=t.charSpacing,c=t.wordSpacing,h=t.fontDirection,u=t.textHScale*h,d=e.length,f=s.vertical,p=f?1:-1,g=s.defaultVMetrics,y=i*t.fontMatrix[0],v=t.textRenderingMode===wt.FILL&&!s.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),h>0?r.scale(u,-1):r.scale(u,1);let w;if(t.patternFill){r.save();const C=t.fillColor.getPattern(r,this,Di(r),Lt.FILL);w=Ne(r),r.restore(),r.fillStyle=C}let A=t.lineWidth;const x=t.textMatrixScale;if(x===0||A===0){const C=t.textRenderingMode&wt.FILL_STROKE_MASK;(C===wt.STROKE||C===wt.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=x;if(a!==1&&(r.scale(a,a),A/=a),r.lineWidth=A,s.isInvalidPDFjsFont){const C=[];let T=0;for(const P of e)C.push(P.unicode),T+=P.width;r.fillText(C.join(""),0,0),t.x+=T*y*u,r.restore(),this.compose();return}let S=0,E;for(E=0;E<d;++E){const C=e[E];if(typeof C=="number"){S+=p*C*i/1e3;continue}let T=!1;const P=(C.isSpace?c:0)+o,O=C.fontChar,U=C.accent;let M,re,ae=C.width;if(f){const fe=C.vmetric||g,ge=-(C.vmetric?fe[1]:ae*.5)*y,W=fe[2]*y;ae=fe?-fe[0]:ae,M=ge/a,re=(S+W)/a}else M=S/a,re=0;if(s.remeasure&&ae>0){const fe=r.measureText(O).width*1e3/i*a;if(ae<fe&&this.isFontSubpixelAAEnabled){const ge=ae/fe;T=!0,r.save(),r.scale(ge,1),M/=ge}else ae!==fe&&(M+=(ae-fe)/2e3*i/a)}if(this.contentVisible&&(C.isInFont||s.missingFile)){if(v&&!U)r.fillText(O,M,re);else if(this.paintChar(O,M,re,w),U){const fe=M+i*U.offset.x/a,ge=re-i*U.offset.y/a;this.paintChar(U.fontChar,fe,ge,w)}}const pe=f?ae*y-P*h:ae*y+P*h;S+=pe,T&&r.restore()}f?t.y-=S:t.x+=S*u,r.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,r=s.fontSize,a=s.fontDirection,o=i.vertical?1:-1,c=s.charSpacing,h=s.wordSpacing,u=s.textHScale*a,d=s.fontMatrix||bp,f=e.length,p=s.textRenderingMode===wt.INVISIBLE;let g,y,v,w;if(!(p||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(u,a),g=0;g<f;++g){if(y=e[g],typeof y=="number"){w=o*y*r/1e3,this.ctx.translate(w,0),s.x+=w*u;continue}const A=(y.isSpace?h:0)+c,x=i.charProcOperatorList[y.operatorListId];if(!x){ie(`Type3 character "${y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=y,this.save(),t.scale(r,r),t.transform(...d),this.executeOperatorList(x),this.restore()),v=B.applyTransform([y.width,0],d)[0]*r+A,t.translate(v,0),s.x+=v*u}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,r,a){this.ctx.rect(s,i,r-s,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],i=this.baseTransform||Ne(this.ctx),r={createCanvasGraphics:a=>new Vm(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Wp(e,s,this.ctx,r,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=B.makeHexColor(e,t,s)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=B.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=kC(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,Di(t),Lt.SHADING);const i=Di(t);if(i){const{width:r,height:a}=t.canvas,[o,c,h,u]=B.getAxialAlignedBoundingBox([0,0,r,a],i);this.ctx.fillRect(o,c,h-o,u-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Re("Should not call beginInlineImage")}beginImageData(){Re("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Ne(this.ctx),t)){const s=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],s,i),this.current.updateRectMinMax(Ne(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||mf("TODO: Support non-isolated groups."),e.knockout&&ie("Knockout groups not supported.");const s=Ne(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=B.getAxialAlignedBoundingBox(e.bbox,Ne(t));const r=[0,0,t.canvas.width,t.canvas.height];i=B.intersect(i,r)||[0,0,0,0];const a=Math.floor(i[0]),o=Math.floor(i[1]),c=Math.max(Math.ceil(i[2])-a,1),h=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,c,h]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(u,c,h),f=d.context;f.translate(-a,-o),f.transform(...s),e.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),Xl(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Ne(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const r=B.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,s,i,r){if(b(this,_r,Gp).call(this),Pu(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[c,h]=B.singularValueDecompose2dScale(Ne(this.ctx)),{viewportScale:u}=this,d=Math.ceil(a*this.outputScaleX*u),f=Math.ceil(o*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(d,f);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(c,0,0,-h,0,o*h),Pu(this.ctx)}else Pu(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new wy(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),b(this,_r,Xp).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=OC(e)),i.compiled)){i.compiled(s);return}const r=this._createMaskCanvas(e),a=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,r,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const c=Ne(o);o.transform(t,s,i,r,0,0);const h=this._createMaskCanvas(e);o.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]);for(let u=0,d=a.length;u<d;u+=2){const f=B.transform(c,[t,s,i,r,a[u],a[u+1]]),[p,g]=B.applyTransform([0,0],f);o.drawImage(h.canvas,p,g)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const r of e){const{data:a,width:o,height:c,transform:h}=r,u=this.cachedCanvases.getCanvas("maskCanvas",o,c),d=u.context;d.save();const f=this.getObject(a,r);xy(d,f),d.globalCompositeOperation="source-in",d.fillStyle=i?s.getPattern(d,this,Di(t),Lt.FILL):s,d.fillRect(0,0,o,c),d.restore(),t.save(),t.transform(...h),t.scale(1,-1),Tu(t,u.canvas,0,0,o,c,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){ie("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const r=this.getObject(e);if(!r){ie("Dependent image isn't ready yet");return}const a=r.width,o=r.height,c=[];for(let h=0,u=i.length;h<u;h+=2)c.push({transform:[t,0,0,s,i[h],i[h+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(r,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;if(this.save(),!Pt){const{filter:o}=i;o!=="none"&&o!==""&&(i.filter="none")}i.scale(1/t,-1/s);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",t,s).context;Ay(c,e),r=this.applyTransferMapsToCanvas(c)}const a=this._scaleImage(r,Di(i));i.imageSmoothingEnabled=Sy(Ne(i),e.interpolate),Tu(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const r=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",r,a).context;Ay(c,e),i=this.applyTransferMapsToCanvas(c)}for(const r of t)s.save(),s.transform(...r.transform),s.scale(1,-1),Tu(s,i,r.x,r.y,r.w,r.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===Ey?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ne(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const c=Math.abs(t),h=Math.abs(r);if(c===h)if(e===0)a=o=1/c;else{const u=c*e;a=o=u<1?1/u:1}else if(e===0)a=1/c,o=1/h;else{const u=c*e,d=h*e;a=u<1?1/u:1,o=d<1?1/d:1}}else{const c=Math.abs(t*r-s*i),h=Math.hypot(t,s),u=Math.hypot(i,r);if(e===0)a=u/c,o=h/c;else{const d=e*c;a=u>d?u/d:1,o=h>d?h/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[i,r]=this.getScaleForStroking();if(t.lineWidth=s||1,i===1&&r===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(i,r),a.length>0){const o=Math.max(i,r);t.setLineDash(a.map(c=>c/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};_r=new WeakSet,Gp=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Xp=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}};let vo=Vm;for(const n in Ms)vo.prototype[n]!==void 0&&(vo.prototype[Ms[n]]=vo.prototype[n]);var mh,yh;class gn{static get workerPort(){return l(this,mh)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");m(this,mh,e)}static get workerSrc(){return l(this,yh)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");m(this,yh,e)}}mh=new WeakMap,yh=new WeakMap,_(gn,mh,null),_(gn,yh,"");const Ru={DATA:1,ERROR:2},Ve={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Jt(n){switch(n instanceof Error||typeof n=="object"&&n!==null||Re('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Xa(n.message);case"MissingPDFException":return new Ga(n.message);case"PasswordException":return new _p(n.message,n.code);case"UnexpectedResponseException":return new yf(n.message,n.status);case"UnknownErrorException":return new vp(n.message,n.details);default:return new vp(n.message,n.toString())}}var Uo,Es,lv,cv,hv,Gu;class ac{constructor(e,t,s){_(this,Es);_(this,Uo,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",b(this,Es,lv).bind(this),{signal:l(this,Uo).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(a){r.reject(a)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,a=this.sourceName,o=this.targetName,c=this.comObj;return new ReadableStream({start:h=>{const u=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:o,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),u.promise},pull:h=>{const u=Promise.withResolvers();return this.streamControllers[r].pullCall=u,c.postMessage({sourceName:a,targetName:o,stream:Ve.PULL,streamId:r,desiredSize:h.desiredSize}),u.promise},cancel:h=>{st(h instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[r].cancelCall=u,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:a,targetName:o,stream:Ve.CANCEL,streamId:r,reason:Jt(h)}),u.promise}},s)}destroy(){var e;(e=l(this,Uo))==null||e.abort(),m(this,Uo,null)}}Uo=new WeakMap,Es=new WeakSet,lv=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){b(this,Es,hv).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Ru.DATA)i.resolve(e.data);else if(e.callback===Ru.ERROR)i.reject(Jt(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;new Promise(function(a){a(t(e.data))}).then(function(a){r.postMessage({sourceName:s,targetName:i,callback:Ru.DATA,callbackId:e.callbackId,data:a})},function(a){r.postMessage({sourceName:s,targetName:i,callback:Ru.ERROR,callbackId:e.callbackId,reason:Jt(a)})});return}if(e.streamId){b(this,Es,cv).call(this,e);return}t(e.data)},cv=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this,o=this.actionHandler[e.action],c={enqueue(h,u=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Ve.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Ve.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){st(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Ve.ERROR,streamId:t,reason:Jt(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,new Promise(function(h){h(o(e.data,c))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ve.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:Ve.START_COMPLETE,streamId:t,reason:Jt(h)})})},hv=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Ve.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Jt(e.reason));break;case Ve.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Jt(e.reason));break;case Ve.PULL:if(!o){r.postMessage({sourceName:s,targetName:i,stream:Ve.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,new Promise(function(c){var h;c((h=o.onPull)==null?void 0:h.call(o))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ve.PULL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Ve.PULL_COMPLETE,streamId:t,reason:Jt(c)})});break;case Ve.ENQUEUE:if(st(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Ve.CLOSE:if(st(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),b(this,Es,Gu).call(this,a,t);break;case Ve.ERROR:st(a,"error should have stream controller"),a.controller.error(Jt(e.reason)),b(this,Es,Gu).call(this,a,t);break;case Ve.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Jt(e.reason)),b(this,Es,Gu).call(this,a,t);break;case Ve.CANCEL:if(!o)break;new Promise(function(c){var h;c((h=o.onCancel)==null?void 0:h.call(o,Jt(e.reason)))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ve.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Ve.CANCEL_COMPLETE,streamId:t,reason:Jt(c)})}),o.sinkCapability.reject(Jt(e.reason)),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Gu=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var ea,bh;class DC{constructor({parsedData:e,rawData:t}){_(this,ea);_(this,bh);m(this,ea,e),m(this,bh,t)}getRaw(){return l(this,bh)}get(e){return l(this,ea).get(e)??null}getAll(){return am(l(this,ea))}has(e){return l(this,ea).has(e)}}ea=new WeakMap,bh=new WeakMap;const lo=Symbol("INTERNAL");var _h,vh,wh,Bo;class NC{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){_(this,_h,!1);_(this,vh,!1);_(this,wh,!1);_(this,Bo,!0);m(this,_h,!!(e&us.DISPLAY)),m(this,vh,!!(e&us.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(l(this,wh))return l(this,Bo);if(!l(this,Bo))return!1;const{print:e,view:t}=this.usage;return l(this,_h)?(t==null?void 0:t.viewState)!=="OFF":l(this,vh)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==lo&&Re("Internal method `_setVisible` called."),m(this,wh,s),m(this,Bo,t)}}_h=new WeakMap,vh=new WeakMap,wh=new WeakMap,Bo=new WeakMap;var Vn,ve,Ho,zo,Ah,Kp;class jC{constructor(e,t=us.DISPLAY){_(this,Ah);_(this,Vn,null);_(this,ve,new Map);_(this,Ho,null);_(this,zo,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,m(this,zo,e.order);for(const s of e.groups)l(this,ve).set(s.id,new NC(t,s));if(e.baseState==="OFF")for(const s of l(this,ve).values())s._setVisible(lo,!1);for(const s of e.on)l(this,ve).get(s)._setVisible(lo,!0);for(const s of e.off)l(this,ve).get(s)._setVisible(lo,!1);m(this,Ho,this.getHash())}}isVisible(e){if(l(this,ve).size===0)return!0;if(!e)return mf("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,ve).has(e.id)?l(this,ve).get(e.id).visible:(ie(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return b(this,Ah,Kp).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,ve).has(t))return ie(`Optional content group not found: ${t}`),!0;if(l(this,ve).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,ve).has(t))return ie(`Optional content group not found: ${t}`),!0;if(!l(this,ve).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,ve).has(t))return ie(`Optional content group not found: ${t}`),!0;if(!l(this,ve).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,ve).has(t))return ie(`Optional content group not found: ${t}`),!0;if(l(this,ve).get(t).visible)return!1}return!0}return ie(`Unknown optional content policy ${e.policy}.`),!0}return ie(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=l(this,ve).get(e);if(!i){ie(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==e&&((r=l(this,ve).get(o))==null||r._setVisible(lo,!1,!0));i._setVisible(lo,!!t,!0),m(this,Vn,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=l(this,ve).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}m(this,Vn,null)}get hasInitialVisibility(){return l(this,Ho)===null||this.getHash()===l(this,Ho)}getOrder(){return l(this,ve).size?l(this,zo)?l(this,zo).slice():[...l(this,ve).keys()]:null}getGroups(){return l(this,ve).size>0?am(l(this,ve)):null}getGroup(e){return l(this,ve).get(e)||null}getHash(){if(l(this,Vn)!==null)return l(this,Vn);const e=new Y_;for(const[t,s]of l(this,ve))e.update(`${t}:${s.visible}`);return m(this,Vn,e.hexdigest())}}Vn=new WeakMap,ve=new WeakMap,Ho=new WeakMap,zo=new WeakMap,Ah=new WeakSet,Kp=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let a;if(Array.isArray(r))a=b(this,Ah,Kp).call(this,r);else if(l(this,ve).has(r))a=l(this,ve).get(r).visible;else return ie(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class $C{constructor(e,{disableRange:t=!1,disableStream:s=!1}){st(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(r==null?void 0:r.length)>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,h)=>{this._onReceiveData({begin:c,chunk:h})}),e.addProgressListener((c,h)=>{this._onProgress({loaded:c,total:h})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});st(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){st(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new UC(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new BC(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class UC{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=cm(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class BC{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function HC(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let u=o(t);return u=unescape(u),u=c(u),u=h(u),r(u)}if(t=a(n),t){const u=h(t);return r(u)}if(t=s("filename","i").exec(n),t){t=t[1];let u=o(t);return u=h(u),r(u)}function s(u,d){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(u,d){if(u){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(u,{fatal:!0}),p=bf(d);d=f.decode(p),e=!1}catch{}}return d}function r(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function a(u){const d=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(u))!==null;){let[,y,v,w]=f;if(y=parseInt(y,10),y in d){if(y===0)break;continue}d[y]=[v,w]}const g=[];for(let y=0;y<d.length&&y in d;++y){let[v,w]=d[y];w=o(w),v&&(w=unescape(w),y===0&&(w=c(w))),g.push(w)}return g.join("")}function o(u){if(u.startsWith('"')){const d=u.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}u=d.join('"')}return u}function c(u){const d=u.indexOf("'");if(d===-1)return u;const f=u.slice(0,d),g=u.slice(d+1).replace(/^[^']*'/,"");return i(f,g)}function h(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,g){if(p==="q"||p==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,v){return String.fromCharCode(parseInt(v,16))}),i(f,g);try{g=atob(g)}catch{}return i(f,g)})}return""}function pm(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function gm({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function mm(n){const e=n.get("Content-Disposition");if(e){let t=HC(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(cm(t))return t}return null}function wf(n,e){return n===404||n===0&&e.startsWith("file:")?new Ga('Missing PDF "'+e+'".'):new yf(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function uv(n){return n===200||n===206}function dv(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function fv(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(ie(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class Cy{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=pm(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return st(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new zC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new qC(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class zC{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,dv(s,this._withCredentials,this._abortController)).then(r=>{if(!uv(r.status))throw wf(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const a=r.headers,{allowRangeRequests:o,suggestedLength:c}=gm({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=c||this._contentLength,this._filename=mm(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xa("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:fv(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class qC{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const a=i.url;fetch(a,dv(r,this._withCredentials,this._abortController)).then(o=>{if(!uv(o.status))throw wf(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:fv(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Hf=200,zf=206;function VC(n){const e=n.response;return typeof e!="string"?e:bf(e).buffer}class WC{constructor({url:e,httpHeaders:t,withCredentials:s}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=pm(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,s){const i={begin:e,end:t};for(const r in s)i[r]=s[r];return this.request(i)}requestFull(e){return this.request(e)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,a]of this.headers)t.setRequestHeader(r,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=zf):i.expectedStatus=Hf,t.responseType="arraybuffer",e.onError&&(t.onerror=function(r){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){var c,h,u;const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){(c=s.onError)==null||c.call(s,i.status);return}const r=i.status||Hf;if(!(r===Hf&&s.expectedStatus===zf)&&r!==s.expectedStatus){(h=s.onError)==null||h.call(s,i.status);return}const o=VC(i);if(r===zf){const d=i.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);s.onDone({begin:parseInt(f[1],10),chunk:o})}else o?s.onDone({begin:0,chunk:o}):(u=s.onError)==null||u.call(s,i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class GC{constructor(e){this._source=e,this._manager=new WC(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return st(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new XC(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new KC(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class XC{constructor(e,t){this._manager=e;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(s),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),s=new Headers(t.getAllResponseHeaders().trim().split(/[\r\n]+/).map(a=>{const[o,...c]=a.split(": ");return[o,c.join(": ")]})),{allowRangeRequests:i,suggestedLength:r}=gm({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=mm(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=wf(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class KC{constructor(e,t,s){this._manager=e;const i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,s,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=wf(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ZC=/^[a-z][a-z0-9\-+.]+:/i;function YC(n){if(ZC.test(n))return new URL(n);const e=yr.get("url");return new URL(e.pathToFileURL(n))}function pv(n,e,t){return n.protocol==="http:"?yr.get("http").request(n,{headers:e},t):yr.get("https").request(n,{headers:e},t)}class JC{constructor(e){this.source=e,this.url=YC(e.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.headers=pm(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return st(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new tk(this):new QC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=this.isFsUrl?new sk(this,e,t):new ek(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class gv{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xa("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class mv{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class QC extends gv{constructor(e){super(e);const t=Object.fromEntries(e.headers),s=i=>{if(i.statusCode===404){const c=new Ga(`Missing PDF "${this._url}".`);this._storedError=c,this._headersCapability.reject(c);return}this._headersCapability.resolve(),this._setReadableStream(i);const r=new Headers(this._readableStream.headers),{allowRangeRequests:a,suggestedLength:o}=gm({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=o||this._contentLength,this._filename=mm(r)};this._request=pv(this._url,t,s),this._request.on("error",i=>{this._storedError=i,this._headersCapability.reject(i)}),this._request.end()}}class ek extends mv{constructor(e,t,s){super(e);const i=Object.fromEntries(e.headers);i.Range=`bytes=${t}-${s-1}`;const r=a=>{if(a.statusCode===404){const o=new Ga(`Missing PDF "${this._url}".`);this._storedError=o;return}this._setReadableStream(a)};this._request=pv(this._url,i,r),this._request.on("error",a=>{this._storedError=a}),this._request.end()}}class tk extends gv{constructor(e){super(e);const t=yr.get("fs");t.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(t.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new Ga(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}}class sk extends mv{constructor(e,t,s){super(e);const i=yr.get("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:s-1}))}}const ik=1e5,Ht=30,nk=.8;var ab,Wn,Wt,xh,Sh,ta,Zi,Eh,Ch,sa,qo,Vo,Gn,Wo,kh,Go,ia,Th,Ph,na,ra,Rh,Xn,Xo,wn,yv,bv,Zp,ps,Xu,Yp,_v,vv;const Ye=class Ye{constructor({textContentSource:e,container:t,viewport:s}){_(this,wn);_(this,Wn,Promise.withResolvers());_(this,Wt,null);_(this,xh,!1);_(this,Sh,!!((ab=globalThis.FontInspector)!=null&&ab.enabled));_(this,ta,null);_(this,Zi,null);_(this,Eh,0);_(this,Ch,0);_(this,sa,null);_(this,qo,null);_(this,Vo,0);_(this,Gn,0);_(this,Wo,Object.create(null));_(this,kh,[]);_(this,Go,null);_(this,ia,[]);_(this,Th,new WeakMap);_(this,Ph,null);var c;if(e instanceof ReadableStream)m(this,Go,e);else if(typeof e=="object")m(this,Go,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');m(this,Wt,m(this,qo,t)),m(this,Gn,s.scale*(globalThis.devicePixelRatio||1)),m(this,Vo,s.rotation),m(this,Zi,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:a,pageY:o}=s.rawDims;m(this,Ph,[1,0,0,-1,-a,o+r]),m(this,Ch,i),m(this,Eh,r),b(c=Ye,ps,_v).call(c),ja(t,s),l(this,Wn).promise.finally(()=>{l(Ye,Xo).delete(this),m(this,Zi,null),m(this,Wo,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Dt.platform;return he(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,sa).read().then(({value:t,done:s})=>{if(s){l(this,Wn).resolve();return}l(this,ta)??m(this,ta,t.lang),Object.assign(l(this,Wo),t.styles),b(this,wn,yv).call(this,t.items),e()},l(this,Wn).reject)};return m(this,sa,l(this,Go).getReader()),l(Ye,Xo).add(this),e(),l(this,Wn).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==l(this,Vo)&&(t==null||t(),m(this,Vo,i),ja(l(this,qo),{rotation:i})),s!==l(this,Gn)){t==null||t(),m(this,Gn,s);const a={div:null,properties:null,ctx:b(r=Ye,ps,Xu).call(r,l(this,ta))};for(const o of l(this,ia))a.properties=l(this,Th).get(o),a.div=o,b(this,wn,Zp).call(this,a)}}cancel(){var t;const e=new Xa("TextLayer task cancelled.");(t=l(this,sa))==null||t.cancel(e).catch(()=>{}),m(this,sa,null),l(this,Wn).reject(e)}get textDivs(){return l(this,ia)}get textContentItemsStr(){return l(this,kh)}static cleanup(){if(!(l(this,Xo).size>0)){l(this,na).clear();for(const{canvas:e}of l(this,ra).values())e.remove();l(this,ra).clear()}}};Wn=new WeakMap,Wt=new WeakMap,xh=new WeakMap,Sh=new WeakMap,ta=new WeakMap,Zi=new WeakMap,Eh=new WeakMap,Ch=new WeakMap,sa=new WeakMap,qo=new WeakMap,Vo=new WeakMap,Gn=new WeakMap,Wo=new WeakMap,kh=new WeakMap,Go=new WeakMap,ia=new WeakMap,Th=new WeakMap,Ph=new WeakMap,na=new WeakMap,ra=new WeakMap,Rh=new WeakMap,Xn=new WeakMap,Xo=new WeakMap,wn=new WeakSet,yv=function(e){var i,r;if(l(this,xh))return;(r=l(this,Zi)).ctx??(r.ctx=b(i=Ye,ps,Xu).call(i,l(this,ta)));const t=l(this,ia),s=l(this,kh);for(const a of e){if(t.length>ik){ie("Ignoring additional textDivs for performance reasons."),m(this,xh,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=l(this,Wt);m(this,Wt,document.createElement("span")),l(this,Wt).classList.add("markedContent"),a.id!==null&&l(this,Wt).setAttribute("id",`${a.id}`),o.append(l(this,Wt))}else a.type==="endMarkedContent"&&m(this,Wt,l(this,Wt).parentNode);continue}s.push(a.str),b(this,wn,bv).call(this,a)}},bv=function(e){var y;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,ia).push(t);const i=B.transform(l(this,Ph),e.transform);let r=Math.atan2(i[1],i[0]);const a=l(this,Wo)[e.fontName];a.vertical&&(r+=Math.PI/2);let o=l(this,Sh)&&a.fontSubstitution||a.fontFamily;o=Ye.fontFamilyMap.get(o)||o;const c=Math.hypot(i[2],i[3]),h=c*b(y=Ye,ps,vv).call(y,o,l(this,ta));let u,d;r===0?(u=i[4],d=i[5]-h):(u=i[4]+h*Math.sin(r),d=i[5]-h*Math.cos(r));const f="calc(var(--scale-factor)*",p=t.style;l(this,Wt)===l(this,qo)?(p.left=`${(100*u/l(this,Ch)).toFixed(2)}%`,p.top=`${(100*d/l(this,Eh)).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(l(Ye,Xn)*c).toFixed(2)}px)`,p.fontFamily=o,s.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,Sh)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const v=Math.abs(e.transform[0]),w=Math.abs(e.transform[3]);v!==w&&Math.max(v,w)/Math.min(v,w)>1.5&&(g=!0)}if(g&&(s.canvasWidth=a.vertical?e.height:e.width),l(this,Th).set(t,s),l(this,Zi).div=t,l(this,Zi).properties=s,b(this,wn,Zp).call(this,l(this,Zi)),s.hasText&&l(this,Wt).append(t),s.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),l(this,Wt).append(v)}},Zp=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:r}=t;let a="";if(l(Ye,Xn)>1&&(a=`scale(${1/l(Ye,Xn)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=r,{canvasWidth:h,fontSize:u}=s;b(o=Ye,ps,Yp).call(o,i,u*l(this,Gn),c);const{width:d}=i.measureText(t.textContent);d>0&&(a=`scaleX(${h*l(this,Gn)/d}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(r.transform=a)},ps=new WeakSet,Xu=function(e=null){let t=l(this,ra).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,ra).set(e,t),l(this,Rh).set(t,{size:0,family:""})}return t},Yp=function(e,t,s){const i=l(this,Rh).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},_v=function(){if(l(this,Xn)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),m(this,Xn,e.getBoundingClientRect().height),e.remove()},vv=function(e,t){const s=l(this,na).get(e);if(s)return s;const i=b(this,ps,Xu).call(this,t);i.canvas.width=i.canvas.height=Ht,b(this,ps,Yp).call(this,i,Ht,e);const r=i.measureText("");let a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);if(a){const u=a/(a+o);return l(this,na).set(e,u),i.canvas.width=i.canvas.height=0,u}i.strokeStyle="red",i.clearRect(0,0,Ht,Ht),i.strokeText("g",0,0);let c=i.getImageData(0,0,Ht,Ht).data;o=0;for(let u=c.length-1-3;u>=0;u-=4)if(c[u]>0){o=Math.ceil(u/4/Ht);break}i.clearRect(0,0,Ht,Ht),i.strokeText("A",0,Ht),c=i.getImageData(0,0,Ht,Ht).data,a=0;for(let u=0,d=c.length;u<d;u+=4)if(c[u]>0){a=Ht-Math.floor(u/4/Ht);break}i.canvas.width=i.canvas.height=0;const h=a?a/(a+o):nk;return l(this,na).set(e,h),h},_(Ye,ps),_(Ye,na,new Map),_(Ye,ra,new Map),_(Ye,Rh,new WeakMap),_(Ye,Xn,null),_(Ye,Xo,new Set);let zc=Ye;class qc{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var c;if(!r)return;let a=null;const o=r.name;if(o==="#text")a=r.value;else if(qc.shouldBuildText(o))(c=r==null?void 0:r.attributes)!=null&&c.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&t.push({str:a}),!!r.children)for(const h of r.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const rk=65536,ak=100,ok=5e3,lk=Pt?vC:yC,ck=Pt?wC:sv,hk=Pt?_C:bC,uk=Pt?AC:av;function dk(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new Jp,{docId:t}=e,s=n.url?fk(n.url):null,i=n.data?pk(n.data):null,r=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,c=n.range instanceof wv?n.range:null,h=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:rk;let u=n.worker instanceof wo?n.worker:null;const d=n.verbosity,f=typeof n.docBaseUrl=="string"&&!vf(n.docBaseUrl)?n.docBaseUrl:null,p=typeof n.cMapUrl=="string"?n.cMapUrl:null,g=n.cMapPacked!==!1,y=n.CMapReaderFactory||ck,v=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,w=n.StandardFontDataFactory||uk,A=n.stopAtErrors!==!0,x=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,S=n.isEvalSupported!==!1,E=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Pt,C=typeof n.isChrome=="boolean"?n.isChrome:!Dt.platform.isFirefox&&typeof window<"u"&&!!(window!=null&&window.chrome),T=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,P=typeof n.disableFontFace=="boolean"?n.disableFontFace:Pt,O=n.fontExtraProperties===!0,U=n.enableXfa===!0,M=n.ownerDocument||globalThis.document,re=n.disableRange===!0,ae=n.disableStream===!0,pe=n.disableAutoFetch===!0,fe=n.pdfBug===!0,ge=n.CanvasFactory||lk,W=n.FilterFactory||hk,J=n.enableHWA===!0,xn=c?c.length:n.length??NaN,Li=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Pt&&!P,gs=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:y===sv&&w===av&&p&&v&&Ql(p,document.baseURI)&&Ql(v,document.baseURI);n.canvasFactory&&py("`canvasFactory`-instance option, please use `CanvasFactory` instead."),n.filterFactory&&py("`filterFactory`-instance option, please use `FilterFactory` instead.");const vt=null;XE(d);const Xe={canvasFactory:new ge({ownerDocument:M,enableHWA:J}),filterFactory:new W({docId:t,ownerDocument:M}),cMapReaderFactory:gs?null:new y({baseUrl:p,isCompressed:g}),standardFontDataFactory:gs?null:new w({baseUrl:v})};if(!u){const Ut={verbosity:d,port:gn.workerPort};u=Ut.port?wo.fromPort(Ut):new wo(Ut),e._worker=u}const Ya={docId:t,apiVersion:"4.8.69",data:i,password:o,disableAutoFetch:pe,rangeChunkSize:h,length:xn,docBaseUrl:f,enableXfa:U,evaluatorOptions:{maxImageSize:x,disableFontFace:P,ignoreErrors:A,isEvalSupported:S,isOffscreenCanvasSupported:E,isChrome:C,canvasMaxAreaInBytes:T,fontExtraProperties:O,useSystemFonts:Li,cMapUrl:gs?p:null,standardFontDataUrl:gs?v:null}},zl={disableFontFace:P,fontExtraProperties:O,ownerDocument:M,pdfBug:fe,styleElement:vt,loadingParams:{disableAutoFetch:pe,enableXfa:U}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Ut=u.messageHandler.sendWithPromise("GetDocRequest",Ya,i?[i.buffer]:null);let Ie;if(c)Ie=new $C(c,{disableRange:re,disableStream:ae});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let ql;Pt?ql=typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype&&Ql(s)?Cy:JC:ql=Ql(s)?Cy:GC,Ie=new ql({url:s,length:xn,httpHeaders:r,withCredentials:a,rangeChunkSize:h,disableRange:re,disableStream:ae})}return Ut.then(ql=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Tf=new ac(t,ql,u.port),q0=new bk(Tf,e,Ie,zl,Xe);e._transport=q0,Tf.send("Ready",null)})}).catch(e._capability.reject),e}function fk(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(Pt&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function pk(n){if(Pt&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return bf(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ky(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var Zd;const Yd=class Yd{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${nt(Yd,Zd)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,i}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};Zd=new WeakMap,_(Yd,Zd,0);let Jp=Yd;class wv{constructor(e,t,s=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Re("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class gk{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return he(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Kn,Yi,xs,co,Ku;class mk{constructor(e,t,s,i=!1){_(this,xs);_(this,Kn,null);_(this,Yi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new fy:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Av,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new gu({viewBox:this.view,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return he(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Mn.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:u=null,isEditing:d=!1}){var S,E;(S=this._stats)==null||S.time("Overall");const f=this._transport.getRenderingIntent(s,i,u,d),{renderingIntent:p,cacheKey:g}=f;m(this,Yi,!1),b(this,xs,Ku).call(this),o||(o=this._transport.getOptionalContentConfig(p));let y=this._intentStates.get(g);y||(y=Object.create(null),this._intentStates.set(g,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const v=!!(p&us.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(E=this._stats)==null||E.time("Page Request"),this._pumpOperatorList(f));const w=C=>{var T;y.renderTasks.delete(A),(this._maybeCleanupAfterRender||v)&&m(this,Yi,!0),b(this,xs,co).call(this,!v),C?(A.capability.reject(C),this._abortOperatorList({intentState:y,reason:C instanceof Error?C:new Error(C)})):A.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(T=globalThis.Stats)!=null&&T.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},A=new eg({callback:w,params:{canvasContext:e,viewport:t,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:h});(y.renderTasks||(y.renderTasks=new Set)).add(A);const x=A.task;return Promise.all([y.displayReadyCapability.promise,o]).then(([C,T])=>{var P;if(this.destroyed){w();return}if((P=this._stats)==null||P.time("Rendering"),!(T.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");A.initializeGraphics({transparency:C,optionalContentConfig:T}),A.operatorListChanged()}).catch(w),x}getOperatorList({intent:e="display",annotationMode:t=Mn.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function r(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(c))}const a=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let c;return o.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(c),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>qc.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){a.read().then(function({value:c,done:h}){if(h){s(o);return}o.lang??(o.lang=c.lang),Object.assign(o.styles,c.styles),o.items.push(...c.items),r()},i)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),m(this,Yi,!1),b(this,xs,Ku).call(this),Promise.all(e)}cleanup(e=!1){m(this,Yi,!0);const t=b(this,xs,co).call(this,!1);return e&&t&&this._stats&&(this._stats=new fy),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&b(this,xs,co).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:a}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},a).getReader(),h=this._intentStates.get(t);h.streamReader=c;const u=()=>{c.read().then(({value:d,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),u())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();b(this,xs,co).call(this,!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};u()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof lm){let i=ak;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Xa(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}Kn=new WeakMap,Yi=new WeakMap,xs=new WeakSet,co=function(e=!1){if(b(this,xs,Ku).call(this),!l(this,Yi)||this.destroyed)return!1;if(e)return m(this,Kn,setTimeout(()=>{m(this,Kn,null),b(this,xs,co).call(this,!1)},ok)),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),m(this,Yi,!1),!0},Ku=function(){l(this,Kn)&&(clearTimeout(l(this,Kn)),m(this,Kn,null))};var Ji,Jd;class yk{constructor(){_(this,Ji,new Map);_(this,Jd,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,Jd).then(()=>{for(const[i]of l(this,Ji))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){ie("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}l(this,Ji).set(t,i)}removeEventListener(e,t){const s=l(this,Ji).get(t);s==null||s(),l(this,Ji).delete(t)}terminate(){for(const[,e]of l(this,Ji))e==null||e();l(this,Ji).clear()}}Ji=new WeakMap,Jd=new WeakMap;var Qd,aa,oa,Ko,Zu,Zo,Yu;const Oe=class Oe{constructor({name:e=null,port:t=null,verbosity:s=KE()}={}){_(this,Ko);var i;if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((i=l(Oe,oa))!=null&&i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(l(Oe,oa)||m(Oe,oa,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return Pt?Promise.all([yr.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new ac("main","worker",e),this._messageHandler.on("ready",function(){}),b(this,Ko,Zu).call(this)}_initialize(){if(l(Oe,aa)||l(Oe,Zo,Yu)){this._setupFakeWorker();return}let{workerSrc:e}=Oe;try{Oe._isSameOrigin(window.location.href,e)||(e=Oe._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new ac("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),s.on("test",o=>{if(r.abort(),this.destroyed||!o){i();return}this._messageHandler=s,this._port=t,this._webWorker=t,b(this,Ko,Zu).call(this)}),s.on("ready",o=>{if(r.abort(),this.destroyed){i();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{mf("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){l(Oe,aa)||(ie("Setting up fake worker."),m(Oe,aa,!0)),Oe._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new yk;this._port=t;const s=`fake${nt(Oe,Qd)._++}`,i=new ac(s+"_worker",s,t);e.setup(i,t),this._messageHandler=new ac(s,s+"_worker",t),b(this,Ko,Zu).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(e=l(Oe,oa))==null||e.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){var s;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(s=l(this,oa))==null?void 0:s.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Oe(e)}static get workerSrc(){if(gn.workerSrc)return gn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return he(this,"_setupFakeWorkerGlobal",(async()=>l(this,Zo,Yu)?l(this,Zo,Yu):(await import(this.workerSrc)).WorkerMessageHandler)())}};Qd=new WeakMap,aa=new WeakMap,oa=new WeakMap,Ko=new WeakSet,Zu=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Zo=new WeakSet,Yu=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},_(Oe,Zo),_(Oe,Qd,0),_(Oe,aa,!1),_(Oe,oa),Pt&&(m(Oe,aa,!0),gn.workerSrc||(gn.workerSrc="./pdf.worker.mjs")),Oe._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(t,s);return s.origin===i.origin},Oe._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let wo=Oe;var Qi,_i,Yo,Jo,vi,la,oc;class bk{constructor(e,t,s,i,r){_(this,la);_(this,Qi,new Map);_(this,_i,new Map);_(this,Yo,new Map);_(this,Jo,new Map);_(this,vi,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Av,this.fontLoader=new gC({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return he(this,"annotationStorage",new dm)}getRenderingIntent(e,t=Mn.ENABLE,s=null,i=!1,r=!1){let a=us.DISPLAY,o=Bp;switch(e){case"any":a=us.ANY;break;case"display":break;case"print":a=us.PRINT;break;default:ie(`getRenderingIntent - invalid intent: ${e}`)}const c=a&us.PRINT&&s instanceof Q_?s:this.annotationStorage;switch(t){case Mn.DISABLE:a+=us.ANNOTATIONS_DISABLE;break;case Mn.ENABLE:break;case Mn.ENABLE_FORMS:a+=us.ANNOTATIONS_FORMS;break;case Mn.ENABLE_STORAGE:a+=us.ANNOTATIONS_STORAGE,o=c.serializable;break;default:ie(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(a+=us.IS_EDITING),r&&(a+=us.OPLIST);const{ids:h,hash:u}=c.modifiedIds,d=[a,o.hash,u];return{renderingIntent:a,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,vi))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of l(this,_i).values())e.push(i._destroy());l(this,_i).clear(),l(this,Yo).clear(),l(this,Jo).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i;this.commonObjs.clear(),this.fontLoader.clear(),l(this,Qi).clear(),this.filterFactory.destroy(),zc.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Xa("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{st(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:a}){if(a){i.close();return}st(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:a}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:a}}),e.on("GetRangeReader",(s,i)=>{st(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:a,done:o}){if(o){i.close();return}st(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{r.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new gk(s,this))}),e.on("DocException",function(s){let i;switch(s.name){case"PasswordException":i=new _p(s.message,s.code);break;case"InvalidPDFException":i=new E_(s.message);break;case"MissingPDFException":i=new Ga(s.message);break;case"UnexpectedResponseException":i=new yf(s.message,s.status);break;case"UnknownErrorException":i=new vp(s.message,s.details);break;default:Re("DocException - expected a valid Error.")}t._capability.reject(i)}),e.on("PasswordRequest",s=>{if(m(this,vi,Promise.withResolvers()),t.onPassword){const i=r=>{r instanceof Error?l(this,vi).reject(r):l(this,vi).resolve({password:r})};try{t.onPassword(i,s.code)}catch(r){l(this,vi).reject(r)}}else l(this,vi).reject(new _p(s.message,s.code));return l(this,vi).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,_i).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:o,fontExtraProperties:c,pdfBug:h}=this._params;if("error"in r){const p=r.error;ie(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const u=h&&((a=globalThis.FontInspector)!=null&&a.enabled)?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,d=new mC(r,{disableFontFace:o,inspectFont:u});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c&&d.data&&(d.data=null),this.commonObjs.resolve(s,d)});break;case"CopyLocalImage":const{imageRef:f}=r;st(f,"The imageRef must be defined.");for(const p of l(this,_i).values())for(const[,g]of p.objs)if((g==null?void 0:g.ref)===f)return g.dataLen?(this.commonObjs.resolve(s,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,a])=>{var c;if(this.destroyed)return;const o=l(this,_i).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(c=a==null?void 0:a.bitmap)==null||c.close();return}switch(r){case"Image":o.objs.resolve(s,a),(a==null?void 0:a.dataLen)>qE&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&ie("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,Yo).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&l(this,Jo).set(r.refStr,e);const a=new mk(t,r,this,this._params.pdfBug);return l(this,_i).set(t,a),a});return l(this,Yo).set(t,i),i}getPageIndex(e){return ky(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return b(this,la,oc).call(this,"GetFieldObjects")}hasJSActions(){return b(this,la,oc).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return b(this,la,oc).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return b(this,la,oc).call(this,"GetOptionalContentConfig").then(t=>new jC(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,Qi).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,a;return{info:i[0],metadata:i[1]?new DC(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return l(this,Qi).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,_i).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,Qi).clear(),this.filterFactory.destroy(!0),zc.cleanup()}}cachedPageNumber(e){if(!ky(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,Jo).get(t)??null}}Qi=new WeakMap,_i=new WeakMap,Yo=new WeakMap,Jo=new WeakMap,vi=new WeakMap,la=new WeakSet,oc=function(e,t=null){const s=l(this,Qi).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return l(this,Qi).set(e,i),i};const Iu=Symbol("INITIAL_DATA");var Bs,Ih,Qp;class Av{constructor(){_(this,Ih);_(this,Bs,Object.create(null))}get(e,t=null){if(t){const i=b(this,Ih,Qp).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=l(this,Bs)[e];if(!s||s.data===Iu)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,Bs)[e];return!!t&&t.data!==Iu}resolve(e,t=null){const s=b(this,Ih,Qp).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,Bs)){const{data:s}=l(this,Bs)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}m(this,Bs,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,Bs)){const{data:t}=l(this,Bs)[e];t!==Iu&&(yield[e,t])}}}Bs=new WeakMap,Ih=new WeakSet,Qp=function(e){var t;return(t=l(this,Bs))[e]||(t[e]={...Promise.withResolvers(),data:Iu})};var Zn;class _k{constructor(e){_(this,Zn,null);m(this,Zn,e),this.onContinue=null}get promise(){return l(this,Zn).capability.promise}cancel(e=0){l(this,Zn).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,Zn).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,Zn);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Zn=new WeakMap;var Yn,ca;const Or=class Or{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:c,filterFactory:h,useRequestAnimationFrame:u=!1,pdfBug:d=!1,pageColors:f=null}){_(this,Yn,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=c,this.filterFactory=h,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new _k(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,c;if(this.cancelled)return;if(this._canvas){if(l(Or,ca).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(Or,ca).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:r,background:a}=this.params;this.gfx=new vo(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(c=this.graphicsReadyCallback)==null||c.call(this)}cancel(e=null,t=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,Yn)&&(window.cancelAnimationFrame(l(this,Yn)),m(this,Yn,null)),l(Or,ca).delete(this._canvas),this.callback(e||new lm(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?m(this,Yn,window.requestAnimationFrame(()=>{m(this,Yn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(Or,ca).delete(this._canvas),this.callback())))}};Yn=new WeakMap,ca=new WeakMap,_(Or,ca,new WeakSet);let eg=Or;const vk="4.8.69",wk="3634dab10";function Ty(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Kl(n){return Math.max(0,Math.min(255,255*n))}class Py{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Kl(e),[e,e,e]}static G_HTML([e]){const t=Ty(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Kl)}static RGB_HTML(e){return`#${e.map(Ty).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[Kl(1-Math.min(1,e+i)),Kl(1-Math.min(1,s+i)),Kl(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,a=1-s,o=Math.min(i,r,a);return["CMYK",i,r,a,o]}}class Ak{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Re("Abstract method `_createSVG` called.")}}class ym extends Ak{_createSVG(e){return document.createElementNS($i,e)}}class xv{static setupStorage(e,t,s,i,r){const a=i.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const c=o.target.options,h=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[c,h]of Object.entries(a))if(h!=null)switch(c){case"class":h.length&&e.setAttribute(c,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,h)}o&&r.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var d,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:r,linkService:s});const o=r!=="richText",c=e.div;if(c.append(a),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}o&&c.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);a.append(p),o&&qc.shouldBuildText(i.name)&&h.push(p)}return{textDivs:h}}const u=[[i,-1,a]];for(;u.length>0;){const[p,g,y]=u.at(-1);if(g+1===p.children.length){u.pop();continue}const v=p.children[++u.at(-1)[1]];if(v===null)continue;const{name:w}=v;if(w==="#text"){const x=document.createTextNode(v.value);h.push(x),y.append(x);continue}const A=(d=v==null?void 0:v.attributes)!=null&&d.xmlns?document.createElementNS(v.attributes.xmlns,w):document.createElement(w);if(y.append(A),v.attributes&&this.setAttributes({html:A,element:v,storage:t,intent:r,linkService:s}),((f=v.children)==null?void 0:f.length)>0)u.push([v,-1,A]);else if(v.value){const x=document.createTextNode(v.value);o&&qc.shouldBuildText(w)&&h.push(x),A.append(x)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const yu=1e3,xk=9,Ua=new WeakSet;function yn(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class Sk{static create(e){switch(e.data.annotationType){case Ze.LINK:return new Sv(e);case Ze.TEXT:return new Ek(e);case Ze.WIDGET:switch(e.data.fieldType){case"Tx":return new Ck(e);case"Btn":return e.data.radioButton?new kv(e):e.data.checkBox?new Tk(e):new Pk(e);case"Ch":return new Rk(e);case"Sig":return new kk(e)}return new Ka(e);case Ze.POPUP:return new sg(e);case Ze.FREETEXT:return new Ov(e);case Ze.LINE:return new Ok(e);case Ze.SQUARE:return new Mk(e);case Ze.CIRCLE:return new Lk(e);case Ze.POLYLINE:return new Mv(e);case Ze.CARET:return new Dk(e);case Ze.INK:return new bm(e);case Ze.POLYGON:return new Fk(e);case Ze.HIGHLIGHT:return new Lv(e);case Ze.UNDERLINE:return new Nk(e);case Ze.SQUIGGLY:return new jk(e);case Ze.STRIKEOUT:return new $k(e);case Ze.STAMP:return new Fv(e);case Ze.FILEATTACHMENT:return new Uk(e);default:return new qe(e)}}}var ha,Qo,el,Oh,tg;const Wm=class Wm{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){_(this,Oh);_(this,ha,null);_(this,Qo,!1);_(this,el,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Wm._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;l(this,ha)||m(this,ha,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&b(this,Oh,tg).call(this,t),(s=l(this,el))==null||s.popup.updateEdited(e)}resetEdited(){var e;l(this,ha)&&(b(this,Oh,tg).call(this,l(this,ha).rect),(e=l(this,el))==null||e.popup.resetEdited(),m(this,ha,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof Ka||(r.tabIndex=yu);const{style:a}=r;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof sg){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,r),r}const{width:o,height:c}=yn(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,v=t.borderStyle.verticalCornerRadius;if(y>0||v>0){const A=`calc(${y}px * var(--scale-factor)) / calc(${v}px * var(--scale-factor))`;a.borderRadius=A}else if(this instanceof kv){const A=`calc(${o}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;a.borderRadius=A}switch(t.borderStyle.style){case Gl.SOLID:a.borderStyle="solid";break;case Gl.DASHED:a.borderStyle="dashed";break;case Gl.BEVELED:ie("Unimplemented border style: beveled");break;case Gl.INSET:ie("Unimplemented border style: inset");break;case Gl.UNDERLINE:a.borderBottomStyle="solid";break}const w=t.borderColor||null;w?(m(this,Qo,!0),a.borderColor=B.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):a.borderWidth=0}const h=B.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:d,pageX:f,pageY:p}=i.rawDims;a.left=`${100*(h[0]-f)/u}%`,a.top=`${100*(h[1]-p)/d}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(a.width=`${100*o/u}%`,a.height=`${100*c/d}%`):this.setRotation(g,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:a}=yn(this.data.rect);let o,c;e%180===0?(o=100*r/s,c=100*a/i):(o=100*a/s,c=100*r/i),t.style.width=`${o}%`,t.style.height=`${c}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],a=r[0],o=r.slice(1);i.target.style[s]=Py[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:Py[`${a}_rgb`](o)})};return he(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const a=s[i];if(a){const o={detail:{[i]:r},target:e};a(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,v,w,A]=e.subarray(2,6);if(i===y&&r===v&&t===w&&s===A)return}const{style:a}=this.container;let o;if(l(this,Qo)){const{borderColor:y,borderWidth:v}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const c=i-t,h=r-s,{svgFactory:u}=this,d=u.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const f=u.createElement("defs");d.append(f);const p=u.createElement("clipPath"),g=`clippath_${this.data.id}`;p.setAttribute("id",g),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let y=2,v=e.length;y<v;y+=8){const w=e[y],A=e[y+1],x=e[y+2],S=e[y+3],E=u.createElement("rect"),C=(x-t)/c,T=(r-A)/h,P=(w-x)/c,O=(A-S)/h;E.setAttribute("x",C),E.setAttribute("y",T),E.setAttribute("width",P),E.setAttribute("height",O),p.append(E),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${T}" width="${P}" height="${O}"/>`)}l(this,Qo)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=m(this,el,new sg({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Re("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:a,exportValues:o}of i){if(r===-1||a===t)continue;const c=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Ua.has(h)){ie(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:c,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,a=i.getAttribute("data-element-id");a!==t&&Ua.has(i)&&s.push({id:a,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};ha=new WeakMap,Qo=new WeakMap,el=new WeakMap,Oh=new WeakSet,tg=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:c}}}}=this;s==null||s.splice(0,4,...e);const{width:h,height:u}=yn(e);t.left=`${100*(e[0]-o)/r}%`,t.top=`${100*(a-e[3]+c)/a}%`,i===0?(t.width=`${100*h/r}%`,t.height=`${100*u/a}%`):this.setRotation(i)};let qe=Wm;var ds,Er,Ev,Cv;class Sv extends qe{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});_(this,ds);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action),r=!0):t.attachment?(b(this,ds,Ev).call(this,i,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(b(this,ds,Cv).call(this,i,t.setOCGState),r=!0):t.dest?(this._bindLink(i,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&b(this,ds,Er).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),b(this,ds,Er).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const a=i.get(r);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),b(this,ds,Er).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),b(this,ds,Er).call(this),!this._fieldObjects){ie('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var d;i==null||i();const{fields:r,refs:a,include:o}=s,c=[];if(r.length!==0||a.length!==0){const f=new Set(a);for(const p of r){const g=this._fieldObjects[p]||[];for(const{id:y}of g)f.add(y)}for(const p of Object.values(this._fieldObjects))for(const g of p)f.has(g.id)===o&&c.push(g)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const h=this.annotationStorage,u=[];for(const f of c){const{id:p}=f;switch(u.push(p),f.type){case"text":{const y=f.defaultValue||"";h.setValue(p,{value:y});break}case"checkbox":case"radiobutton":{const y=f.defaultValue===f.exportValues;h.setValue(p,{value:y});break}case"combobox":case"listbox":{const y=f.defaultValue||"";h.setValue(p,{value:y});break}default:continue}const g=document.querySelector(`[data-element-id="${p}"]`);if(g){if(!Ua.has(g)){ie(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}ds=new WeakSet,Er=function(){this.container.setAttribute("data-internal-link","")},Ev=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(s.content,s.filename,i),!1},b(this,ds,Er).call(this)},Cv=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),b(this,ds,Er).call(this)};class Ek extends qe{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Ka extends qe{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Dt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a)}}))})}_setEventListeners(e,t,s,i){var r,a,o;for(const[c,h]of s)(h==="Action"||(r=this.data.actions)!=null&&r[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,h,i),h==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":B.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||xk,r=e.style;let a;const o=2,c=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),u=Math.round(h/(jf*i))||1,d=h/u;a=Math.min(i,c(d/jf))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,c(h/jf))}r.fontSize=`calc(${a}px * var(--scale-factor))`,r.color=B.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Ck extends Ka{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),r.setValue(a.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let h=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const u={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ua.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=yu,this._setRequired(s,this.data.required),c&&(s.maxLength=c),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),u.formattedValue=null}),s.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";s.value=u.userValue=p,u.formattedValue=null});let d=f=>{const{formattedValue:p}=u;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{var y;if(u.focused)return;const{target:g}=p;u.userValue&&(g.value=u.userValue),u.lastCommittedValue=g.value,u.commitKey=1,(y=this.data.actions)!=null&&y.Focus||(u.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const g={value(y){u.userValue=y.detail.value??"",e.setValue(t,{value:u.userValue.toString()}),y.target.value=u.userValue},formattedValue(y){const{formattedValue:v}=y.detail;u.formattedValue=v,v!=null&&y.target!==document.activeElement&&(y.target.value=v),e.setValue(t,{formattedValue:v})},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{var x;const{charLimit:v}=y.detail,{target:w}=y;if(v===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",v);let A=u.userValue;!A||A.length<=v||(A=A.slice(0,v),w.value=u.userValue=A,e.setValue(t,{value:A}),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(g,p)}),s.addEventListener("keydown",p=>{var v;u.commitKey=1;let g=-1;if(p.key==="Escape"?g=0:p.key==="Enter"&&!this.data.multiLine?g=2:p.key==="Tab"&&(u.commitKey=3),g===-1)return;const{value:y}=p.target;u.lastCommittedValue!==y&&(u.lastCommittedValue=y,u.userValue=y,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:g,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=d;d=null,s.addEventListener("blur",p=>{var y,v;if(!u.focused||!p.relatedTarget)return;(y=this.data.actions)!=null&&y.Blur||(u.focused=!1);const{value:g}=p.target;u.userValue=g,u.lastCommittedValue!==g&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:u.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",p=>{var E;u.lastCommittedValue=null;const{data:g,target:y}=p,{value:v,selectionStart:w,selectionEnd:A}=y;let x=w,S=A;switch(p.inputType){case"deleteWordBackward":{const C=v.substring(0,w).match(/\w*[^\w]*$/);C&&(x-=C[0].length);break}case"deleteWordForward":{const C=v.substring(w).match(/^[^\w]*\w*/);C&&(S+=C[0].length);break}case"deleteContentBackward":w===A&&(x-=1);break;case"deleteContentForward":w===A&&(S+=1);break}p.preventDefault(),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,change:g||"",willCommit:!1,selStart:x,selEnd:S}})}),this._setEventListeners(s,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(d&&s.addEventListener("blur",d),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/c;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class kk extends Ka{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Tk extends Ka{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Ua.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=yu,r.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const h of this._getElementsByName(o,s)){const u=c&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=u),e.setValue(h.id,{value:u})}e.setValue(s,{value:c})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const o={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class kv extends Ka{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const r=document.createElement("input");if(Ua.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=yu,r.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:c})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;r.addEventListener("updatefromsandbox",o=>{const c={value:h=>{const u=a===h.detail.value;for(const d of this._getElementsByName(h.target.name)){const f=u&&d.id===s;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Pk extends Sv{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class Rk extends Ka{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Ua.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=yu;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const d=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===d});for(const u of this.data.options){const d=document.createElement("option");d.textContent=u.displayValue,d.value=u.exportValue,s.value.includes(u.exportValue)&&(d.setAttribute("selected",!0),r=!1),i.append(d)}let a=null;if(r){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),a=()=>{u.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=u=>{const d=u?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,g=>g.selected).map(g=>g[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let c=o(!1);const h=u=>{const d=u.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const d={value(f){a==null||a();const p=f.detail.value,g=new Set(Array.isArray(p)?p:[p]);for(const y of i.options)y.selected=g.has(y.value);e.setValue(t,{value:o(!0)}),c=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,g=f.detail.remove;p[g].selected=!1,i.remove(g),p.length>0&&Array.prototype.findIndex.call(p,v=>v.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),c=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),c=o(!1)},insert(f){const{index:p,displayValue:g,exportValue:y}=f.detail.insert,v=i.children[p],w=document.createElement("option");w.textContent=g,w.value=y,v?v.before(w):i.append(w),e.setValue(t,{value:o(!0),items:h(f)}),c=o(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const g of p){const{displayValue:y,exportValue:v}=g,w=document.createElement("option");w.textContent=y,w.value=v,i.append(w)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),c=o(!1)},indices(f){const p=new Set(f.detail.indices);for(const g of f.target.options)g.selected=p.has(g.index);e.setValue(t,{value:o(!0)}),c=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,u)}),i.addEventListener("input",u=>{var p;const d=o(!0),f=o(!1);e.setValue(t,{value:d}),u.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class sg extends qe{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:qe._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Ik({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${om}${s}`).join(",")),this.container}}var tl,ef,tf,sl,ua,Be,en,il,Mh,Lh,nl,tn,Hs,sn,Fh,nn,Dh,da,fa,ke,Ju,ig,Tv,Pv,Rv,Iv,Qu,ed,ng;class Ik{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:o,parent:c,rect:h,parentRect:u,open:d}){_(this,ke);_(this,tl,b(this,ke,Rv).bind(this));_(this,ef,b(this,ke,ng).bind(this));_(this,tf,b(this,ke,ed).bind(this));_(this,sl,b(this,ke,Qu).bind(this));_(this,ua,null);_(this,Be,null);_(this,en,null);_(this,il,null);_(this,Mh,null);_(this,Lh,null);_(this,nl,null);_(this,tn,!1);_(this,Hs,null);_(this,sn,null);_(this,Fh,null);_(this,nn,null);_(this,Dh,null);_(this,da,null);_(this,fa,!1);var f;m(this,Be,e),m(this,Dh,i),m(this,en,a),m(this,nn,o),m(this,Lh,c),m(this,ua,t),m(this,Fh,h),m(this,nl,u),m(this,Mh,s),m(this,il,hm.toDateObject(r)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",l(this,sl)),p.addEventListener("mouseenter",l(this,tf)),p.addEventListener("mouseleave",l(this,ef)),p.classList.add("popupTriggerArea");for(const p of s)(f=p.container)==null||f.addEventListener("keydown",l(this,tl));l(this,Be).hidden=!0,d&&b(this,ke,Qu).call(this)}render(){if(l(this,Hs))return;const e=m(this,Hs,document.createElement("div"));if(e.className="popup",l(this,ua)){const r=e.style.outlineColor=B.makeHexColor(...l(this,ua));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=B.makeHexColor(...l(this,ua).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=l(this,Dh),e.append(t),l(this,il)){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,il).valueOf()})),t.append(r)}const i=l(this,ke,Ju);if(i)xv.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(l(this,en));e.append(r)}l(this,Be).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let r=0,a=i.length;r<a;++r){const o=i[r];s.append(document.createTextNode(o)),r<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;l(this,da)||m(this,da,{contentsObj:l(this,en),richText:l(this,nn)}),e&&m(this,sn,null),t&&(m(this,nn,b(this,ke,Pv).call(this,t)),m(this,en,null)),(s=l(this,Hs))==null||s.remove(),m(this,Hs,null)}resetEdited(){var e;l(this,da)&&({contentsObj:nt(this,en)._,richText:nt(this,nn)._}=l(this,da),m(this,da,null),(e=l(this,Hs))==null||e.remove(),m(this,Hs,null),m(this,sn,null))}forceHide(){m(this,fa,this.isVisible),l(this,fa)&&(l(this,Be).hidden=!0)}maybeShow(){l(this,fa)&&(l(this,Hs)||b(this,ke,ed).call(this),m(this,fa,!1),l(this,Be).hidden=!1)}get isVisible(){return l(this,Be).hidden===!1}}tl=new WeakMap,ef=new WeakMap,tf=new WeakMap,sl=new WeakMap,ua=new WeakMap,Be=new WeakMap,en=new WeakMap,il=new WeakMap,Mh=new WeakMap,Lh=new WeakMap,nl=new WeakMap,tn=new WeakMap,Hs=new WeakMap,sn=new WeakMap,Fh=new WeakMap,nn=new WeakMap,Dh=new WeakMap,da=new WeakMap,fa=new WeakMap,ke=new WeakSet,Ju=function(){const e=l(this,nn),t=l(this,en);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,nn).html||null},ig=function(){var e,t,s;return((s=(t=(e=l(this,ke,Ju))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Tv=function(){var e,t,s;return((s=(t=(e=l(this,ke,Ju))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Pv=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:l(this,ke,Tv),fontSize:l(this,ke,ig)?`calc(${l(this,ke,ig)}px * var(--scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},Rv=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,tn))&&b(this,ke,Qu).call(this)},Iv=function(){if(l(this,sn)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=l(this,Lh);let a=!!l(this,nl),o=a?l(this,nl):l(this,Fh);for(const g of l(this,Mh))if(!o||B.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const c=B.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),u=a?o[2]-o[0]+5:0,d=c[0]+u,f=c[1];m(this,sn,[100*(d-i)/t,100*(f-r)/s]);const{style:p}=l(this,Be);p.left=`${l(this,sn)[0]}%`,p.top=`${l(this,sn)[1]}%`},Qu=function(){m(this,tn,!l(this,tn)),l(this,tn)?(b(this,ke,ed).call(this),l(this,Be).addEventListener("click",l(this,sl)),l(this,Be).addEventListener("keydown",l(this,tl))):(b(this,ke,ng).call(this),l(this,Be).removeEventListener("click",l(this,sl)),l(this,Be).removeEventListener("keydown",l(this,tl)))},ed=function(){l(this,Hs)||this.render(),this.isVisible?l(this,tn)&&l(this,Be).classList.add("focused"):(b(this,ke,Iv).call(this),l(this,Be).hidden=!1,l(this,Be).style.zIndex=parseInt(l(this,Be).style.zIndex)+1e3)},ng=function(){l(this,Be).classList.remove("focused"),!(l(this,tn)||!this.isVisible)&&(l(this,Be).hidden=!0,l(this,Be).style.zIndex=parseInt(l(this,Be).style.zIndex)-1e3)};class Ov extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Q.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Nh;class Ok extends qe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});_(this,Nh,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:s,height:i}=yn(t.rect),r=this.svgFactory.create(s,i,!0),a=m(this,Nh,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Nh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nh=new WeakMap;var jh;class Mk extends qe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});_(this,jh,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:s,height:i}=yn(t.rect),r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=m(this,jh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,jh)}addHighlightArea(){this.container.classList.add("highlightArea")}}jh=new WeakMap;var $h;class Lk extends qe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});_(this,$h,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:s,height:i}=yn(t.rect),r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=m(this,$h,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,$h)}addHighlightArea(){this.container.classList.add("highlightArea")}}$h=new WeakMap;var Uh;class Mv extends qe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});_(this,Uh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r}}=this;if(!s)return this.container;const{width:a,height:o}=yn(t),c=this.svgFactory.create(a,o,!0);let h=[];for(let d=0,f=s.length;d<f;d+=2){const p=s[d]-t[0],g=t[3]-s[d+1];h.push(`${p},${g}`)}h=h.join(" ");const u=m(this,Uh,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",h),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),c.append(u),this.container.append(c),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Uh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Uh=new WeakMap;class Fk extends Mv{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Dk extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Bh;class bm extends qe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});_(this,Bh,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Q.HIGHLIGHT:Q.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,inkLists:s,borderStyle:i,popupRef:r}}=this,{width:a,height:o}=yn(t),c=this.svgFactory.create(a,o,!0);for(const h of s){let u=[];for(let f=0,p=h.length;f<p;f+=2){const g=h[f]-t[0],y=t[3]-h[f+1];u.push(`${g},${y}`)}u=u.join(" ");const d=this.svgFactory.createElement(this.svgElementName);l(this,Bh).push(d),d.setAttribute("points",u),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),c.append(d)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}getElementsToTriggerPopup(){return l(this,Bh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Bh=new WeakMap;class Lv extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Q.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Nk extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class jk extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class $k extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Fv extends qe{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Q.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Hh,zh,rg;class Uk extends qe{constructor(t){var i;super(t,{isRenderable:!0});_(this,zh);_(this,Hh,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",b(this,zh,rg).bind(this)),m(this,Hh,i);const{isMac:r}=Dt.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(r?a.metaKey:a.ctrlKey)&&b(this,zh,rg).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return l(this,Hh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hh=new WeakMap,zh=new WeakSet,rg=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var qh,pa,ga,Vh,Ha,Dv,ag;class Bk{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a,structTreeLayer:o}){_(this,Ha);_(this,qh,null);_(this,pa,null);_(this,ga,new Map);_(this,Vh,null);this.div=e,m(this,qh,t),m(this,pa,s),m(this,Vh,o||null),this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return l(this,ga).size>0}async render(e){var a;const{annotations:t}=e,s=this.div;ja(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new ym,annotationStorage:e.annotationStorage||new dm,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const c=o.annotationType===Ze.POPUP;if(c){const d=i.get(o.id);if(!d)continue;r.elements=d}else{const{width:d,height:f}=yn(o.rect);if(d<=0||f<=0)continue}r.data=o;const h=Sk.create(r);if(!h.isRenderable)continue;if(!c&&o.popupRef){const d=i.get(o.popupRef);d?d.push(h):i.set(o.popupRef,[h])}const u=h.render();o.hidden&&(u.style.visibility="hidden"),await b(this,Ha,Dv).call(this,u,o.id),h._isEditable&&(l(this,ga).set(h.data.id,h),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(h))}b(this,Ha,ag).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,ja(t,{rotation:e.rotation}),b(this,Ha,ag).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,ga).values())}getEditableAnnotation(e){return l(this,ga).get(e)}}qh=new WeakMap,pa=new WeakMap,ga=new WeakMap,Vh=new WeakMap,Ha=new WeakSet,Dv=async function(e,t){var a,o;const s=e.firstChild||e,i=s.id=`${om}${t}`,r=await((a=l(this,Vh))==null?void 0:a.getAriaAttributes(i));if(r)for(const[c,h]of r)s.setAttribute(c,h);this.div.append(e),(o=l(this,qh))==null||o.moveElementInDOM(this.div,e,s,!1)},ag=function(){if(!l(this,pa))return;const e=this.div;for(const[t,s]of l(this,pa)){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s)}l(this,pa).clear()};const Ou=/\r\n?|\n/g;var zs,ns,Wh,ma,rs,Ge,Nv,jv,$v,td,_n,sd,id,Uv,lg,Bv;const Pe=class Pe extends we{constructor(t){super({...t,name:"freeTextEditor"});_(this,Ge);_(this,zs);_(this,ns,"");_(this,Wh,`${this.id}-editor`);_(this,ma,null);_(this,rs);m(this,zs,t.color||Pe._defaultColor||we._defaultLineColor),m(this,rs,t.fontSize||Pe._defaultFontSize)}static get _keyboardManager(){const t=Pe.prototype,s=a=>a.isEmpty(),i=$a.TRANSLATE_SMALL,r=$a.TRANSLATE_BIG;return he(this,"_keyboardManager",new mu([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){we.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case X.FREETEXT_SIZE:Pe._defaultFontSize=s;break;case X.FREETEXT_COLOR:Pe._defaultColor=s;break}}updateParams(t,s){switch(t){case X.FREETEXT_SIZE:b(this,Ge,Nv).call(this,s);break;case X.FREETEXT_COLOR:b(this,Ge,jv).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[X.FREETEXT_SIZE,Pe._defaultFontSize],[X.FREETEXT_COLOR,Pe._defaultColor||we._defaultLineColor]]}get propertiesToUpdate(){return[[X.FREETEXT_SIZE,l(this,rs)],[X.FREETEXT_COLOR,l(this,zs)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Pe._internalPadding*t,-(Pe._internalPadding+l(this,rs))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Q.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),m(this,ma,new AbortController);const t=this._uiManager.combinedSignal(l(this,ma));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,Wh)),this._isDraggable=!0,(t=l(this,ma))==null||t.abort(),m(this,ma,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var t;this.width||(this.enableEditMode(),this.editorDiv.focus(),(t=this._initialOptions)!=null&&t.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,ns),s=m(this,ns,b(this,Ge,$v).call(this).trimEnd());if(t===s)return;const i=r=>{if(m(this,ns,r),!r){this.remove();return}b(this,Ge,id).call(this),this._uiManager.rebuild(this),b(this,Ge,td).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),b(this,Ge,td).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Pe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,Wh)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${l(this,rs)}px * var(--scale-factor))`,i.color=l(this,zs),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Rd(this,this.div,["dblclick","keydown"]),this.width){const[r,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[c,h]=this.getInitialTranslation();[c,h]=this.pageTranslationToScreen(c,h);const[u,d]=this.pageDimensions,[f,p]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(o[0]-f)/u,y=s+this.height-(o[1]-p)/d;break;case 90:g=t+(o[0]-f)/u,y=s-(o[1]-p)/d,[c,h]=[h,-c];break;case 180:g=t-this.width+(o[0]-f)/u,y=s-(o[1]-p)/d,[c,h]=[-c,-h];break;case 270:g=t+(o[0]-f-this.height*d)/u,y=s+(o[1]-p-this.width*u)/d,[c,h]=[-h,c];break}this.setAt(g*r,y*a,c,h)}else this.setAt(t*r,s*a,this.width*r,this.height*a);b(this,Ge,id).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var g,y,v;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=b(g=Pe,_n,lg).call(g,s.getData("text")||"").replaceAll(Ou,`
`);if(!r)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:c,startOffset:h}=o,u=[],d=[];if(c.nodeType===Node.TEXT_NODE){const w=c.parentElement;if(d.push(c.nodeValue.slice(h).replaceAll(Ou,"")),w!==this.editorDiv){let A=u;for(const x of this.editorDiv.childNodes){if(x===w){A=d;continue}A.push(b(y=Pe,_n,sd).call(y,x))}}u.push(c.nodeValue.slice(0,h).replaceAll(Ou,""))}else if(c===this.editorDiv){let w=u,A=0;for(const x of this.editorDiv.childNodes)A++===h&&(w=d),w.push(b(v=Pe,_n,sd).call(v,x))}m(this,ns,`${u.join(`
`)}${r}${d.join(`
`)}`),b(this,Ge,id).call(this);const f=new Range;let p=u.reduce((w,A)=>w+A.length,0);for(const{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){const A=w.nodeValue.length;if(p<=A){f.setStart(w,p),f.setEnd(w,p);break}p-=A}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var o;let r=null;if(t instanceof Ov){const{data:{defaultAppearanceData:{fontSize:c,fontColor:h},rect:u,rotation:d,id:f,popupRef:p},textContent:g,textPosition:y,parent:{page:{pageNumber:v}}}=t;if(!g||g.length===0)return null;r=t={annotationType:Q.FREETEXT,color:Array.from(h),fontSize:c,value:g.join(`
`),position:y,pageIndex:v-1,rect:u.slice(0),rotation:d,id:f,deleted:!1,popupRef:p}}const a=await super.deserialize(t,s,i);return m(a,rs,t.fontSize),m(a,zs,B.makeHexColor(...t.color)),m(a,ns,b(o=Pe,_n,lg).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=r,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Pe._internalPadding*this.parentScale,i=this.getRect(s,s),r=we._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:l(this,zs)),a={annotationType:Q.FREETEXT,color:r,fontSize:l(this,rs),value:b(this,Ge,Uv).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!b(this,Ge,Bv).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${l(this,rs)}px * var(--scale-factor))`,i.color=l(this,zs),s.replaceChildren();for(const a of l(this,ns).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const r=Pe._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:l(this,ns)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};zs=new WeakMap,ns=new WeakMap,Wh=new WeakMap,ma=new WeakMap,rs=new WeakMap,Ge=new WeakSet,Nv=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-l(this,rs))*this.parentScale),m(this,rs,r),b(this,Ge,td).call(this)},i=l(this,rs);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},jv=function(t){const s=r=>{m(this,zs,this.editorDiv.style.color=r)},i=l(this,zs);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},$v=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(b(i=Pe,_n,sd).call(i,r)),s=r);return t.join(`
`)},td=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:a}=this,o=a.style.display,c=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},_n=new WeakSet,sd=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ou,"")},id=function(){if(this.editorDiv.replaceChildren(),!!l(this,ns))for(const t of l(this,ns).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Uv=function(){return l(this,ns).replaceAll(" "," ")},lg=function(t){return t.replaceAll(" "," ")},Bv=function(t){const{value:s,fontSize:i,color:r,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,c)=>o!==r[c])||t.pageIndex!==a},_(Pe,_n),G(Pe,"_freeTextDefaultContent",""),G(Pe,"_internalPadding",0),G(Pe,"_defaultColor",null),G(Pe,"_defaultFontSize",10),G(Pe,"_type","freetext"),G(Pe,"_editorType",Q.FREETEXT);let og=Pe;class Hv{toSVGPath(){Re("Abstract method `toSVGPath` must be implemented.")}get box(){Re("Abstract getter `box` must be implemented.")}serialize(e,t){Re("Abstract method `serialize` must be implemented.")}get classNamesForDrawing(){Re("Abstract getter `classNamesForDrawing` must be implemented.")}get classNamesForOutlining(){Re("Abstract getter `classNamesForOutlining` must be implemented.")}get mustRemoveSelfIntersections(){return!1}}var as,qs,rl,al,wi,ne,ya,ba,Gh,Xh,ol,ll,Jn,Kh,sf,nf,it,lc,zv,qv,Vv,Wv,Gv,Xv;const zi=class zi{constructor({x:e,y:t},s,i,r,a,o=0){_(this,it);_(this,as);_(this,qs,[]);_(this,rl);_(this,al);_(this,wi,[]);_(this,ne,new Float64Array(18));_(this,ya);_(this,ba);_(this,Gh);_(this,Xh);_(this,ol);_(this,ll);_(this,Jn,[]);m(this,as,s),m(this,ll,r*i),m(this,al,a),l(this,ne).set([NaN,NaN,NaN,NaN,e,t],6),m(this,rl,o),m(this,Xh,l(zi,Kh)*i),m(this,Gh,l(zi,nf)*i),m(this,ol,i),l(this,Jn).push(e,t)}isEmpty(){return isNaN(l(this,ne)[8])}add({x:e,y:t}){var O;m(this,ya,e),m(this,ba,t);const[s,i,r,a]=l(this,as);let[o,c,h,u]=l(this,ne).subarray(8,12);const d=e-h,f=t-u,p=Math.hypot(d,f);if(p<l(this,Gh))return!1;const g=p-l(this,Xh),y=g/p,v=y*d,w=y*f;let A=o,x=c;o=h,c=u,h+=v,u+=w,(O=l(this,Jn))==null||O.push(e,t);const S=-w/g,E=v/g,C=S*l(this,ll),T=E*l(this,ll);return l(this,ne).set(l(this,ne).subarray(2,8),0),l(this,ne).set([h+C,u+T],4),l(this,ne).set(l(this,ne).subarray(14,18),12),l(this,ne).set([h-C,u-T],16),isNaN(l(this,ne)[6])?(l(this,wi).length===0&&(l(this,ne).set([o+C,c+T],2),l(this,wi).push(NaN,NaN,NaN,NaN,(o+C-s)/r,(c+T-i)/a),l(this,ne).set([o-C,c-T],14),l(this,qs).push(NaN,NaN,NaN,NaN,(o-C-s)/r,(c-T-i)/a)),l(this,ne).set([A,x,o,c,h,u],6),!this.isEmpty()):(l(this,ne).set([A,x,o,c,h,u],6),Math.abs(Math.atan2(x-c,A-o)-Math.atan2(w,v))<Math.PI/2?([o,c,h,u]=l(this,ne).subarray(2,6),l(this,wi).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/r,((c+u)/2-i)/a),[o,c,A,x]=l(this,ne).subarray(14,18),l(this,qs).push(NaN,NaN,NaN,NaN,((A+o)/2-s)/r,((x+c)/2-i)/a),!0):([A,x,o,c,h,u]=l(this,ne).subarray(0,6),l(this,wi).push(((A+5*o)/6-s)/r,((x+5*c)/6-i)/a,((5*o+h)/6-s)/r,((5*c+u)/6-i)/a,((o+h)/2-s)/r,((c+u)/2-i)/a),[h,u,o,c,A,x]=l(this,ne).subarray(12,18),l(this,qs).push(((A+5*o)/6-s)/r,((x+5*c)/6-i)/a,((5*o+h)/6-s)/r,((5*c+u)/6-i)/a,((o+h)/2-s)/r,((c+u)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,wi),t=l(this,qs);if(isNaN(l(this,ne)[6])&&!this.isEmpty())return b(this,it,zv).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);b(this,it,Vv).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return b(this,it,qv).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,a){return new Kv(e,t,s,i,r,a)}getOutlines(){var d;const e=l(this,wi),t=l(this,qs),s=l(this,ne),[i,r,a,o]=l(this,as),c=new Float64Array((((d=l(this,Jn))==null?void 0:d.length)??0)+2);for(let f=0,p=c.length-2;f<p;f+=2)c[f]=(l(this,Jn)[f]-i)/a,c[f+1]=(l(this,Jn)[f+1]-r)/o;if(c[c.length-2]=(l(this,ya)-i)/a,c[c.length-1]=(l(this,ba)-r)/o,isNaN(s[6])&&!this.isEmpty())return b(this,it,Wv).call(this,c);const h=new Float64Array(l(this,wi).length+24+l(this,qs).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}u=b(this,it,Xv).call(this,h,u);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){h[u]=h[u+1]=NaN,u+=2;continue}h[u]=t[f+p],h[u+1]=t[f+p+1],u+=2}return b(this,it,Gv).call(this,h,u),this.newFreeDrawOutline(h,c,l(this,as),l(this,ol),l(this,rl),l(this,al))}};as=new WeakMap,qs=new WeakMap,rl=new WeakMap,al=new WeakMap,wi=new WeakMap,ne=new WeakMap,ya=new WeakMap,ba=new WeakMap,Gh=new WeakMap,Xh=new WeakMap,ol=new WeakMap,ll=new WeakMap,Jn=new WeakMap,Kh=new WeakMap,sf=new WeakMap,nf=new WeakMap,it=new WeakSet,lc=function(){const e=l(this,ne).subarray(4,6),t=l(this,ne).subarray(16,18),[s,i,r,a]=l(this,as);return[(l(this,ya)+(e[0]-t[0])/2-s)/r,(l(this,ba)+(e[1]-t[1])/2-i)/a,(l(this,ya)+(t[0]-e[0])/2-s)/r,(l(this,ba)+(t[1]-e[1])/2-i)/a]},zv=function(){const[e,t,s,i]=l(this,as),[r,a,o,c]=b(this,it,lc).call(this);return`M${(l(this,ne)[2]-e)/s} ${(l(this,ne)[3]-t)/i} L${(l(this,ne)[4]-e)/s} ${(l(this,ne)[5]-t)/i} L${r} ${a} L${o} ${c} L${(l(this,ne)[16]-e)/s} ${(l(this,ne)[17]-t)/i} L${(l(this,ne)[14]-e)/s} ${(l(this,ne)[15]-t)/i} Z`},qv=function(e){const t=l(this,qs);e.push(`L${t[4]} ${t[5]} Z`)},Vv=function(e){const[t,s,i,r]=l(this,as),a=l(this,ne).subarray(4,6),o=l(this,ne).subarray(16,18),[c,h,u,d]=b(this,it,lc).call(this);e.push(`L${(a[0]-t)/i} ${(a[1]-s)/r} L${c} ${h} L${u} ${d} L${(o[0]-t)/i} ${(o[1]-s)/r}`)},Wv=function(e){const t=l(this,ne),[s,i,r,a]=l(this,as),[o,c,h,u]=b(this,it,lc).call(this),d=new Float64Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/a,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/a,NaN,NaN,NaN,NaN,o,c,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/a,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/a],0),this.newFreeDrawOutline(d,e,l(this,as),l(this,ol),l(this,rl),l(this,al))},Gv=function(e,t){const s=l(this,qs);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},Xv=function(e,t){const s=l(this,ne).subarray(4,6),i=l(this,ne).subarray(16,18),[r,a,o,c]=l(this,as),[h,u,d,f]=b(this,it,lc).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-a)/c,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-a)/c],t),t+=24},_(zi,Kh,8),_(zi,sf,2),_(zi,nf,l(zi,Kh)+l(zi,sf));let Od=zi;var cl,_a,rn,Zh,os,Yh,ze,Zt,cc,hc,Zv;class Kv extends Hv{constructor(t,s,i,r,a,o){super();_(this,Zt);_(this,cl);_(this,_a,null);_(this,rn);_(this,Zh);_(this,os);_(this,Yh);_(this,ze);m(this,ze,t),m(this,os,s),m(this,cl,i),m(this,Yh,r),m(this,rn,a),m(this,Zh,o),b(this,Zt,Zv).call(this,o);const{x:c,y:h,width:u,height:d}=l(this,_a);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-c)/u,t[f+1]=(t[f+1]-h)/d;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-c)/u,s[f+1]=(s[f+1]-h)/d}toSVGPath(){const t=[`M${l(this,ze)[4]} ${l(this,ze)[5]}`];for(let s=6,i=l(this,ze).length;s<i;s+=6){if(isNaN(l(this,ze)[s])){t.push(`L${l(this,ze)[s+4]} ${l(this,ze)[s+5]}`);continue}t.push(`C${l(this,ze)[s]} ${l(this,ze)[s+1]} ${l(this,ze)[s+2]} ${l(this,ze)[s+3]} ${l(this,ze)[s+4]} ${l(this,ze)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],a){const o=i-t,c=r-s;let h,u;switch(a){case 0:h=b(this,Zt,cc).call(this,l(this,ze),t,r,o,-c),u=b(this,Zt,cc).call(this,l(this,os),t,r,o,-c);break;case 90:h=b(this,Zt,hc).call(this,l(this,ze),t,s,o,c),u=b(this,Zt,hc).call(this,l(this,os),t,s,o,c);break;case 180:h=b(this,Zt,cc).call(this,l(this,ze),i,s,-o,c),u=b(this,Zt,cc).call(this,l(this,os),i,s,-o,c);break;case 270:h=b(this,Zt,hc).call(this,l(this,ze),i,r,-o,-c),u=b(this,Zt,hc).call(this,l(this,os),i,r,-o,-c);break}return{outline:Array.from(h),points:[Array.from(u)]}}get box(){return l(this,_a)}newOutliner(t,s,i,r,a,o=0){return new Od(t,s,i,r,a,o)}getNewOutline(t,s){const{x:i,y:r,width:a,height:o}=l(this,_a),[c,h,u,d]=l(this,cl),f=a*u,p=o*d,g=i*u+c,y=r*d+h,v=this.newOutliner({x:l(this,os)[0]*f+g,y:l(this,os)[1]*p+y},l(this,cl),l(this,Yh),t,l(this,Zh),s??l(this,rn));for(let w=2;w<l(this,os).length;w+=2)v.add({x:l(this,os)[w]*f+g,y:l(this,os)[w+1]*p+y});return v.getOutlines()}get mustRemoveSelfIntersections(){return!0}}cl=new WeakMap,_a=new WeakMap,rn=new WeakMap,Zh=new WeakMap,os=new WeakMap,Yh=new WeakMap,ze=new WeakMap,Zt=new WeakSet,cc=function(t,s,i,r,a){const o=new Float64Array(t.length);for(let c=0,h=t.length;c<h;c+=2)o[c]=s+t[c]*r,o[c+1]=i+t[c+1]*a;return o},hc=function(t,s,i,r,a){const o=new Float64Array(t.length);for(let c=0,h=t.length;c<h;c+=2)o[c]=s+t[c+1]*r,o[c+1]=i+t[c]*a;return o},Zv=function(t){const s=l(this,ze);let i=s[4],r=s[5],a=i,o=r,c=i,h=r,u=i,d=r;const f=t?Math.max:Math.min;for(let w=6,A=s.length;w<A;w+=6){if(isNaN(s[w]))a=Math.min(a,s[w+4]),o=Math.min(o,s[w+5]),c=Math.max(c,s[w+4]),h=Math.max(h,s[w+5]),d<s[w+5]?(u=s[w+4],d=s[w+5]):d===s[w+5]&&(u=f(u,s[w+4]));else{const x=B.bezierBoundingBox(i,r,...s.slice(w,w+6));a=Math.min(a,x[0]),o=Math.min(o,x[1]),c=Math.max(c,x[2]),h=Math.max(h,x[3]),d<x[3]?(u=x[2],d=x[3]):d===x[3]&&(u=f(u,x[2]))}i=s[w+4],r=s[w+5]}const p=a-l(this,rn),g=o-l(this,rn),y=c-a+2*l(this,rn),v=h-o+2*l(this,rn);m(this,_a,{x:p,y:g,width:y,height:v,lastPoint:[u,d]})};var Jh,Qn,Vs,jt,Yv,nd,Jv,Qv,cg;class Ry{constructor(e,t=0,s=0,i=!0){_(this,jt);_(this,Jh);_(this,Qn,[]);_(this,Vs,[]);let r=1/0,a=-1/0,o=1/0,c=-1/0;const u=10**-4;for(const{x:w,y:A,width:x,height:S}of e){const E=Math.floor((w-t)/u)*u,C=Math.ceil((w+x+t)/u)*u,T=Math.floor((A-t)/u)*u,P=Math.ceil((A+S+t)/u)*u,O=[E,T,P,!0],U=[C,T,P,!1];l(this,Qn).push(O,U),r=Math.min(r,E),a=Math.max(a,C),o=Math.min(o,T),c=Math.max(c,P)}const d=a-r+2*s,f=c-o+2*s,p=r-s,g=o-s,y=l(this,Qn).at(i?-1:-2),v=[y[0],y[2]];for(const w of l(this,Qn)){const[A,x,S]=w;w[0]=(A-p)/d,w[1]=(x-g)/f,w[2]=(S-g)/f}m(this,Jh,{x:p,y:g,width:d,height:f,lastPoint:v})}getOutlines(){l(this,Qn).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,Qn))t[3]?(e.push(...b(this,jt,cg).call(this,t)),b(this,jt,Jv).call(this,t)):(b(this,jt,Qv).call(this,t),e.push(...b(this,jt,cg).call(this,t)));return b(this,jt,Yv).call(this,e)}}Jh=new WeakMap,Qn=new WeakMap,Vs=new WeakMap,jt=new WeakSet,Yv=function(e){const t=[],s=new Set;for(const a of e){const[o,c,h]=a;t.push([o,c,a],[o,h,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const c=t[a][2],h=t[a+1][2];c.push(h),h.push(c),s.add(c),s.add(h)}const i=[];let r;for(;s.size>0;){const a=s.values().next().value;let[o,c,h,u,d]=a;s.delete(a);let f=o,p=c;for(r=[o,h],i.push(r);;){let g;if(s.has(u))g=u;else if(s.has(d))g=d;else break;s.delete(g),[o,c,h,u,d]=g,f!==o&&(r.push(f,p,o,p===c?c:h),f=o),p=p===c?h:c}r.push(f,p)}return new Hk(i,l(this,Jh))},nd=function(e){const t=l(this,Vs);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,a=t[r][0];if(a===e)return r;a<e?s=r+1:i=r-1}return i+1},Jv=function([,e,t]){const s=b(this,jt,nd).call(this,e);l(this,Vs).splice(s,0,[e,t])},Qv=function([,e,t]){const s=b(this,jt,nd).call(this,e);for(let i=s;i<l(this,Vs).length;i++){const[r,a]=l(this,Vs)[i];if(r!==e)break;if(r===e&&a===t){l(this,Vs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,a]=l(this,Vs)[i];if(r!==e)break;if(r===e&&a===t){l(this,Vs).splice(i,1);return}}},cg=function(e){const[t,s,i]=e,r=[[t,s,i]],a=b(this,jt,nd).call(this,i);for(let o=0;o<a;o++){const[c,h]=l(this,Vs)[o];for(let u=0,d=r.length;u<d;u++){const[,f,p]=r[u];if(!(h<=f||p<=c)){if(f>=c){if(p>h)r[u][1]=h;else{if(d===1)return[];r.splice(u,1),u--,d--}continue}r[u][2]=c,p>h&&r.push([t,h,p])}}}return r};var Qh,hl;class Hk extends Hv{constructor(t,s){super();_(this,Qh);_(this,hl);m(this,hl,t),m(this,Qh,s)}toSVGPath(){const t=[];for(const s of l(this,hl)){let[i,r]=s;t.push(`M${i} ${r}`);for(let a=2;a<s.length;a+=2){const o=s[a],c=s[a+1];o===i?(t.push(`V${c}`),r=c):c===r&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],a){const o=[],c=i-t,h=r-s;for(const u of l(this,hl)){const d=new Array(u.length);for(let f=0;f<u.length;f+=2)d[f]=t+u[f]*c,d[f+1]=r-u[f+1]*h;o.push(d)}return o}get box(){return l(this,Qh)}get classNamesForDrawing(){return["highlight"]}get classNamesForOutlining(){return["highlightOutline"]}}Qh=new WeakMap,hl=new WeakMap;class hg extends Od{newFreeDrawOutline(e,t,s,i,r,a){return new zk(e,t,s,i,r,a)}get classNamesForDrawing(){return["highlight","free"]}}class zk extends Kv{get classNamesForDrawing(){return["highlight","free"]}get classNamesForOutlining(){return["highlightOutline","free"]}newOutliner(e,t,s,i,r,a=0){return new hg(e,t,s,i,r,a)}}var Ws,va,ul,et,eu,dl,tu,su,er,Gs,fl,iu,Ce,ug,dg,fg,Cr,ew,Tn;const qt=class qt{constructor({editor:e=null,uiManager:t=null}){_(this,Ce);_(this,Ws,null);_(this,va,null);_(this,ul);_(this,et,null);_(this,eu,!1);_(this,dl,!1);_(this,tu,null);_(this,su);_(this,er,null);_(this,Gs,null);_(this,fl);var s;e?(m(this,dl,!1),m(this,fl,X.HIGHLIGHT_COLOR),m(this,tu,e)):(m(this,dl,!0),m(this,fl,X.HIGHLIGHT_DEFAULT_COLOR)),m(this,Gs,(e==null?void 0:e._uiManager)||t),m(this,su,l(this,Gs)._eventBus),m(this,ul,(e==null?void 0:e.color)||((s=l(this,Gs))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),l(qt,iu)||m(qt,iu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return he(this,"_keyboardManager",new mu([[["Escape","mac+Escape"],qt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],qt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],qt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],qt.prototype._moveToPrevious],[["Home","mac+Home"],qt.prototype._moveToBeginning],[["End","mac+End"],qt.prototype._moveToEnd]]))}renderButton(){const e=m(this,Ws,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=l(this,Gs)._signal;e.addEventListener("click",b(this,Ce,Cr).bind(this),{signal:t}),e.addEventListener("keydown",b(this,Ce,fg).bind(this),{signal:t});const s=m(this,va,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=l(this,ul),e.append(s),e}renderMainDropdown(){const e=m(this,et,b(this,Ce,ug).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===l(this,Ws)){b(this,Ce,Cr).call(this,e);return}const t=e.target.getAttribute("data-color");t&&b(this,Ce,dg).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,Ce,Tn)){b(this,Ce,Cr).call(this,e);return}if(e.target===l(this,Ws)){(t=l(this,et).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,et))==null?void 0:t.firstChild)||e.target===l(this,Ws)){l(this,Ce,Tn)&&this._hideDropdownFromKeyboard();return}l(this,Ce,Tn)||b(this,Ce,Cr).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,Ce,Tn)){b(this,Ce,Cr).call(this,e);return}(t=l(this,et).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,Ce,Tn)){b(this,Ce,Cr).call(this,e);return}(t=l(this,et).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,et))==null||e.classList.add("hidden"),(t=l(this,er))==null||t.abort(),m(this,er,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,dl)){if(!l(this,Ce,Tn)){(e=l(this,tu))==null||e.unselect();return}this.hideDropdown(),l(this,Ws).focus({preventScroll:!0,focusVisible:l(this,eu)})}}updateColor(e){if(l(this,va)&&(l(this,va).style.backgroundColor=e),!l(this,et))return;const t=l(this,Gs).highlightColors.values();for(const s of l(this,et).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=l(this,Ws))==null||e.remove(),m(this,Ws,null),m(this,va,null),(t=l(this,et))==null||t.remove(),m(this,et,null)}};Ws=new WeakMap,va=new WeakMap,ul=new WeakMap,et=new WeakMap,eu=new WeakMap,dl=new WeakMap,tu=new WeakMap,su=new WeakMap,er=new WeakMap,Gs=new WeakMap,fl=new WeakMap,iu=new WeakMap,Ce=new WeakSet,ug=function(){const e=document.createElement("div"),t=l(this,Gs)._signal;e.addEventListener("contextmenu",ks,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of l(this,Gs).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",l(qt,iu)[s]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=i,r.setAttribute("aria-selected",i===l(this,ul)),r.addEventListener("click",b(this,Ce,dg).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",b(this,Ce,fg).bind(this),{signal:t}),e},dg=function(e,t){t.stopPropagation(),l(this,su).dispatch("switchannotationeditorparams",{source:this,type:l(this,fl),value:e})},fg=function(e){qt._keyboardManager.exec(this,e)},Cr=function(e){if(l(this,Ce,Tn)){this.hideDropdown();return}if(m(this,eu,e.detail===0),l(this,er)||(m(this,er,new AbortController),window.addEventListener("pointerdown",b(this,Ce,ew).bind(this),{signal:l(this,Gs).combinedSignal(l(this,er))})),l(this,et)){l(this,et).classList.remove("hidden");return}const t=m(this,et,b(this,Ce,ug).call(this));l(this,Ws).append(t)},ew=function(e){var t;(t=l(this,et))!=null&&t.contains(e.target)||this.hideDropdown()},Tn=function(){return l(this,et)&&!l(this,et).classList.contains("hidden")},_(qt,iu,null);let Md=qt;var pl,nu,an,wa,gl,_s,ru,au,Aa,Xs,Ct,Gt,ml,on,tt,yl,vs,ou,Z,pg,rd,tw,sw,iw,gg,kr,Ss,ho,nw,ad,uc,rw,aw,ow,lw,cw;const ye=class ye extends we{constructor(t){super({...t,name:"highlightEditor"});_(this,Z);_(this,pl,null);_(this,nu,0);_(this,an);_(this,wa,null);_(this,gl,null);_(this,_s,null);_(this,ru,null);_(this,au,0);_(this,Aa,null);_(this,Xs,null);_(this,Ct,null);_(this,Gt,!1);_(this,ml,null);_(this,on);_(this,tt,null);_(this,yl,"");_(this,vs);_(this,ou,"");this.color=t.color||ye._defaultColor,m(this,vs,t.thickness||ye._defaultThickness),m(this,on,t.opacity||ye._defaultOpacity),m(this,an,t.boxes||null),m(this,ou,t.methodOfCreation||""),m(this,yl,t.text||""),this._isDraggable=!1,t.highlightId>-1?(m(this,Gt,!0),b(this,Z,rd).call(this,t),b(this,Z,kr).call(this)):l(this,an)&&(m(this,pl,t.anchorNode),m(this,nu,t.anchorOffset),m(this,ru,t.focusNode),m(this,au,t.focusOffset),b(this,Z,pg).call(this),b(this,Z,kr).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=ye.prototype;return he(this,"_keyboardManager",new mu([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,Gt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:l(this,vs),methodOfCreation:l(this,ou)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;we.initialize(t,s),ye._defaultColor||(ye._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case X.HIGHLIGHT_DEFAULT_COLOR:ye._defaultColor=s;break;case X.HIGHLIGHT_THICKNESS:ye._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,ml)}updateParams(t,s){switch(t){case X.HIGHLIGHT_COLOR:b(this,Z,tw).call(this,s);break;case X.HIGHLIGHT_THICKNESS:b(this,Z,sw).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[X.HIGHLIGHT_DEFAULT_COLOR,ye._defaultColor],[X.HIGHLIGHT_THICKNESS,ye._defaultThickness]]}get propertiesToUpdate(){return[[X.HIGHLIGHT_COLOR,this.color||ye._defaultColor],[X.HIGHLIGHT_THICKNESS,l(this,vs)||ye._defaultThickness],[X.HIGHLIGHT_FREE,l(this,Gt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(m(this,gl,new Md({editor:this})),t.addColorPicker(l(this,gl))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(b(this,Z,uc).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,b(this,Z,uc).call(this))}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){b(this,Z,gg).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(b(this,Z,kr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?b(this,Z,gg).call(this):t&&(b(this,Z,kr).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,a,o;const{drawLayer:s}=this.parent;let i;l(this,Gt)?(t=(t-this.rotation+360)%360,i=b(r=ye,Ss,ho).call(r,l(this,Xs).box,t)):i=b(a=ye,Ss,ho).call(a,this,t),s.rotate(l(this,Ct),t),s.rotate(l(this,tt),t),s.updateBox(l(this,Ct),i),s.updateBox(l(this,tt),b(o=ye,Ss,ho).call(o,l(this,_s).box,t))}render(){if(this.div)return this.div;const t=super.render();l(this,yl)&&(t.setAttribute("aria-label",l(this,yl)),t.setAttribute("role","mark")),l(this,Gt)?t.classList.add("free"):this.div.addEventListener("keydown",b(this,Z,nw).bind(this),{signal:this._uiManager._signal});const s=m(this,Aa,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,wa);const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),Rd(this,l(this,Aa),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent.drawLayer.addClass(l(this,tt),"hovered")}pointerleave(){this.isSelected||this.parent.drawLayer.removeClass(l(this,tt),"hovered")}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:b(this,Z,ad).call(this,!0);break;case 1:case 3:b(this,Z,ad).call(this,!1);break}}select(){var t,s;super.select(),l(this,tt)&&((t=this.parent)==null||t.drawLayer.removeClass(l(this,tt),"hovered"),(s=this.parent)==null||s.drawLayer.addClass(l(this,tt),"selected"))}unselect(){var t;super.unselect(),l(this,tt)&&((t=this.parent)==null||t.drawLayer.removeClass(l(this,tt),"selected"),l(this,Gt)||b(this,Z,ad).call(this,!1))}get _mustFixPosition(){return!l(this,Gt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(l(this,Ct),t),this.parent.drawLayer.show(l(this,tt),t))}static startHighlighting(t,s,{target:i,x:r,y:a}){const{x:o,y:c,width:h,height:u}=i.getBoundingClientRect(),d=new AbortController,f=t.combinedSignal(d),p=y=>{y.preventDefault(),y.stopPropagation()},g=y=>{d.abort(),b(this,Ss,lw).call(this,t,y)};window.addEventListener("blur",g,{signal:f}),window.addEventListener("pointerup",g,{signal:f}),window.addEventListener("pointerdown",p,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",ks,{signal:f}),i.addEventListener("pointermove",b(this,Ss,ow).bind(this,t),{signal:f}),this._freeHighlight=new hg({x:r,y:a},[o,c,h,u],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static async deserialize(t,s,i){var y,v,w,A;let r=null;if(t instanceof Lv){const{data:{quadPoints:x,rect:S,rotation:E,id:C,color:T,opacity:P,popupRef:O},parent:{page:{pageNumber:U}}}=t;r=t={annotationType:Q.HIGHLIGHT,color:Array.from(T),opacity:P,quadPoints:x,boxes:null,pageIndex:U-1,rect:S.slice(0),rotation:E,id:C,deleted:!1,popupRef:O}}else if(t instanceof bm){const{data:{inkLists:x,rect:S,rotation:E,id:C,color:T,borderStyle:{rawWidth:P},popupRef:O},parent:{page:{pageNumber:U}}}=t;r=t={annotationType:Q.HIGHLIGHT,color:Array.from(T),thickness:P,inkLists:x,boxes:null,pageIndex:U-1,rect:S.slice(0),rotation:E,id:C,deleted:!1,popupRef:O}}const{color:a,quadPoints:o,inkLists:c,opacity:h}=t,u=await super.deserialize(t,s,i);u.color=B.makeHexColor(...a),m(u,on,h||1),c&&m(u,vs,t.thickness),u.annotationElementId=t.id||null,u._initialData=r;const[d,f]=u.pageDimensions,[p,g]=u.pageTranslation;if(o){const x=m(u,an,[]);for(let S=0;S<o.length;S+=8)x.push({x:(o[S]-p)/d,y:1-(o[S+1]-g)/f,width:(o[S+2]-o[S])/d,height:(o[S+1]-o[S+5])/f});b(y=u,Z,pg).call(y),b(v=u,Z,kr).call(v),u.rotate(u.rotation)}else if(c){m(u,Gt,!0);const x=c[0],S={x:x[0]-p,y:f-(x[1]-g)},E=new hg(S,[0,0,d,f],1,l(u,vs)/2,!0,.001);for(let P=0,O=x.length;P<O;P+=2)S.x=x[P]-p,S.y=f-(x[P+1]-g),E.add(S);const{id:C,clipPathId:T}=s.drawLayer.draw(E,u.color,u._defaultOpacity,!0);b(w=u,Z,rd).call(w,{highlightOutlines:E.getOutlines(),highlightId:C,clipPathId:T}),b(A=u,Z,kr).call(A)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=we._colorManager.convert(this.color),r={annotationType:Q.HIGHLIGHT,color:i,opacity:l(this,on),thickness:l(this,vs),quadPoints:b(this,Z,rw).call(this),outlines:b(this,Z,aw).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:b(this,Z,uc).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!b(this,Z,cw).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};pl=new WeakMap,nu=new WeakMap,an=new WeakMap,wa=new WeakMap,gl=new WeakMap,_s=new WeakMap,ru=new WeakMap,au=new WeakMap,Aa=new WeakMap,Xs=new WeakMap,Ct=new WeakMap,Gt=new WeakMap,ml=new WeakMap,on=new WeakMap,tt=new WeakMap,yl=new WeakMap,vs=new WeakMap,ou=new WeakMap,Z=new WeakSet,pg=function(){const t=new Ry(l(this,an),.001);m(this,Xs,t.getOutlines()),{x:this.x,y:this.y,width:this.width,height:this.height}=l(this,Xs).box;const s=new Ry(l(this,an),.0025,.001,this._uiManager.direction==="ltr");m(this,_s,s.getOutlines());const{lastPoint:i}=l(this,_s).box;m(this,ml,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},rd=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var d,f;if(m(this,Xs,t),m(this,_s,t.getNewOutline(l(this,vs)/2+1.5,.0025)),s>=0)m(this,Ct,s),m(this,wa,i),this.parent.drawLayer.finalizeLine(s,t),m(this,tt,this.parent.drawLayer.drawOutline(l(this,_s)));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(l(this,Ct),t),this.parent.drawLayer.updateBox(l(this,Ct),b(d=ye,Ss,ho).call(d,l(this,Xs).box,(p-this.rotation+360)%360)),this.parent.drawLayer.updateLine(l(this,tt),l(this,_s)),this.parent.drawLayer.updateBox(l(this,tt),b(f=ye,Ss,ho).call(f,l(this,_s).box,p))}const{x:a,y:o,width:c,height:h}=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=c,this.height=h;break;case 90:{const[p,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=c*g/p,this.height=h*p/g;break}case 180:this.x=1-a,this.y=1-o,this.width=c,this.height=h;break;case 270:{const[p,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=c*g/p,this.height=h*p/g;break}}const{lastPoint:u}=l(this,_s).box;m(this,ml,[(u[0]-a)/c,(u[1]-o)/h])},tw=function(t){const s=(a,o)=>{var c,h,u;this.color=a,(c=this.parent)==null||c.drawLayer.changeColor(l(this,Ct),a),(h=l(this,gl))==null||h.updateColor(a),m(this,on,o),(u=this.parent)==null||u.drawLayer.changeOpacity(l(this,Ct),o)},i=this.color,r=l(this,on);this.addCommands({cmd:s.bind(this,t,ye._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},sw=function(t){const s=l(this,vs),i=r=>{m(this,vs,r),b(this,Z,iw).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},iw=function(t){if(!l(this,Gt))return;b(this,Z,rd).call(this,{highlightOutlines:l(this,Xs).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},gg=function(){l(this,Ct)===null||!this.parent||(this.parent.drawLayer.remove(l(this,Ct)),m(this,Ct,null),this.parent.drawLayer.remove(l(this,tt)),m(this,tt,null))},kr=function(t=this.parent){l(this,Ct)===null&&({id:nt(this,Ct)._,clipPathId:nt(this,wa)._}=t.drawLayer.draw(l(this,Xs),this.color,l(this,on)),m(this,tt,t.drawLayer.drawOutline(l(this,_s))),l(this,Aa)&&(l(this,Aa).style.clipPath=l(this,wa)))},Ss=new WeakSet,ho=function({x:t,y:s,width:i,height:r},a){switch(a){case 90:return{x:1-s-r,y:t,width:r,height:i};case 180:return{x:1-t-i,y:1-s-r,width:i,height:r};case 270:return{x:s,y:1-t-i,width:r,height:i}}return{x:t,y:s,width:i,height:r}},nw=function(t){ye._keyboardManager.exec(this,t)},ad=function(t){if(!l(this,pl))return;const s=window.getSelection();t?s.setPosition(l(this,pl),l(this,nu)):s.setPosition(l(this,ru),l(this,au))},uc=function(){return l(this,Gt)?this.rotation:0},rw=function(){if(l(this,Gt))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,a=l(this,an),o=new Float32Array(a.length*8);let c=0;for(const{x:h,y:u,width:d,height:f}of a){const p=h*t+i,g=(1-u-f)*s+r;o[c]=o[c+4]=p,o[c+1]=o[c+3]=g,o[c+2]=o[c+6]=p+d*t,o[c+5]=o[c+7]=g+f*s,c+=8}return o},aw=function(t){return l(this,Xs).serialize(t,b(this,Z,uc).call(this))},ow=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)},lw=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},cw=function(t){const{color:s}=this._initialData;return t.color.some((i,r)=>i!==s[r])},_(ye,Ss),G(ye,"_defaultColor",null),G(ye,"_defaultOpacity",1),G(ye,"_defaultThickness",12),G(ye,"_type","highlight"),G(ye,"_editorType",Q.HIGHLIGHT),G(ye,"_freeHighlightId",-1),G(ye,"_freeHighlight",null),G(ye,"_freeHighlightClipId","");let Ld=ye;var xa,Sa,Ai,ln,ws,Ea,Ca,ka,cn,bl,Ta,Pa,tr,L,hw,uw,dw,fw,yg,pw,bg,gw,mw,yw,bw,_w,Tr,_g,vg,wg,od,ld,uo,Ag,cd,An,vw,xg,ww,Aw,Sg,hd,dc;const Le=class Le extends we{constructor(t){super({...t,name:"inkEditor"});_(this,L);_(this,xa,0);_(this,Sa,0);_(this,Ai,null);_(this,ln,new Path2D);_(this,ws,!1);_(this,Ea,null);_(this,Ca,!1);_(this,ka,!1);_(this,cn,null);_(this,bl,null);_(this,Ta,0);_(this,Pa,0);_(this,tr,null);this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,s){we.initialize(t,s)}static updateDefaultParams(t,s){switch(t){case X.INK_THICKNESS:Le._defaultThickness=s;break;case X.INK_COLOR:Le._defaultColor=s;break;case X.INK_OPACITY:Le._defaultOpacity=s/100;break}}updateParams(t,s){switch(t){case X.INK_THICKNESS:b(this,L,hw).call(this,s);break;case X.INK_COLOR:b(this,L,uw).call(this,s);break;case X.INK_OPACITY:b(this,L,dw).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[X.INK_THICKNESS,Le._defaultThickness],[X.INK_COLOR,Le._defaultColor||we._defaultLineColor],[X.INK_OPACITY,Math.round(Le._defaultOpacity*100)]]}get propertiesToUpdate(){return[[X.INK_THICKNESS,this.thickness||Le._defaultThickness],[X.INK_COLOR,this.color||Le._defaultColor||we._defaultLineColor],[X.INK_OPACITY,Math.round(100*(this.opacity??Le._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(b(this,L,od).call(this),b(this,L,ld).call(this)),this.isAttachedToDOM||(this.parent.add(this),b(this,L,uo).call(this)),b(this,L,dc).call(this)))}remove(){var t;this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,l(this,Ai)&&(clearTimeout(l(this,Ai)),m(this,Ai,null)),(t=l(this,cn))==null||t.disconnect(),m(this,cn,null),super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,s]=this.parentDimensions,i=this.width*t,r=this.height*s;this.setDimensions(i,r)}enableEditMode(){l(this,ws)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,b(this,L,_g).call(this))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),b(this,L,vg).call(this))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){l(this,ws)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),m(this,ws,!0),this.div.classList.add("disabled"),b(this,L,dc).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||l(this,ws)||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),b(this,L,pw).call(this,t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),b(this,L,bg).call(this,t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),b(this,L,wg).call(this,t)}canvasPointerleave(t){b(this,L,wg).call(this,t)}get isResizable(){return!this.isEmpty()&&l(this,ws)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[i,r,a,o]=b(this,L,fw).call(this);if(this.setAt(i,r,0,0),this.setDims(a,o),b(this,L,od).call(this),this.width){const[c,h]=this.parentDimensions;this.setAspectRatio(this.width*c,this.height*h),this.setAt(t*c,s*h,this.width*c,this.height*h),m(this,ka,!0),b(this,L,uo).call(this),this.setDims(this.width*c,this.height*h),b(this,L,Tr).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return b(this,L,ld).call(this),this.div}setDimensions(t,s){const i=Math.round(t),r=Math.round(s);if(l(this,Ta)===i&&l(this,Pa)===r)return;m(this,Ta,i),m(this,Pa,r),this.canvas.style.visibility="hidden";const[a,o]=this.parentDimensions;this.width=t/a,this.height=s/o,this.fixAndSetPosition(),l(this,ws)&&b(this,L,Ag).call(this,t,s),b(this,L,uo).call(this),b(this,L,Tr).call(this),this.canvas.style.visibility="visible",this.fixDims()}static async deserialize(t,s,i){var v,w,A;if(t instanceof bm)return null;const r=await super.deserialize(t,s,i);r.thickness=t.thickness,r.color=B.makeHexColor(...t.color),r.opacity=t.opacity;const[a,o]=r.pageDimensions,c=r.width*a,h=r.height*o,u=r.parentScale,d=t.thickness/2;m(r,ws,!0),m(r,Ta,Math.round(c)),m(r,Pa,Math.round(h));const{paths:f,rect:p,rotation:g}=t;for(let{bezier:x}of f){x=b(v=Le,An,ww).call(v,x,p,g);const S=[];r.paths.push(S);let E=u*(x[0]-d),C=u*(x[1]-d);for(let P=2,O=x.length;P<O;P+=6){const U=u*(x[P]-d),M=u*(x[P+1]-d),re=u*(x[P+2]-d),ae=u*(x[P+3]-d),pe=u*(x[P+4]-d),fe=u*(x[P+5]-d);S.push([[E,C],[U,M],[re,ae],[pe,fe]]),E=pe,C=fe}const T=b(this,An,vw).call(this,S);r.bezierPath2D.push(T)}const y=b(w=r,L,Sg).call(w);return m(r,Sa,Math.max(we.MIN_SIZE,y[2]-y[0])),m(r,xa,Math.max(we.MIN_SIZE,y[3]-y[1])),b(A=r,L,Ag).call(A,c,h),r}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),s=we._colorManager.convert(this.ctx.strokeStyle);return{annotationType:Q.INK,color:s,thickness:this.thickness,opacity:this.opacity,paths:b(this,L,Aw).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};xa=new WeakMap,Sa=new WeakMap,Ai=new WeakMap,ln=new WeakMap,ws=new WeakMap,Ea=new WeakMap,Ca=new WeakMap,ka=new WeakMap,cn=new WeakMap,bl=new WeakMap,Ta=new WeakMap,Pa=new WeakMap,tr=new WeakMap,L=new WeakSet,hw=function(t){const s=r=>{this.thickness=r,b(this,L,dc).call(this)},i=this.thickness;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},uw=function(t){const s=r=>{this.color=r,b(this,L,Tr).call(this)},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},dw=function(t){const s=r=>{this.opacity=r,b(this,L,Tr).call(this)};t/=100;const i=this.opacity;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},fw=function(){const{parentRotation:t,parentDimensions:[s,i]}=this;switch(t){case 90:return[0,i,i,s];case 180:return[s,i,s,i];case 270:return[s,0,i,s];default:return[0,0,s,i]}},yg=function(){const{ctx:t,color:s,opacity:i,thickness:r,parentScale:a,scaleFactor:o}=this;t.lineWidth=r*a/o,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${s}${uC(i)}`},pw=function(t,s){this.canvas.addEventListener("contextmenu",ks,{signal:this._uiManager._signal}),b(this,L,vg).call(this),m(this,Ea,new AbortController);const i=this._uiManager.combinedSignal(l(this,Ea));this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal:i}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal:i}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal:i}),this.isEditing=!0,l(this,ka)||(m(this,ka,!0),b(this,L,uo).call(this),this.thickness||(this.thickness=Le._defaultThickness),this.color||(this.color=Le._defaultColor||we._defaultLineColor),this.opacity??(this.opacity=Le._defaultOpacity)),this.currentPath.push([t,s]),m(this,Ca,!1),b(this,L,yg).call(this),m(this,tr,()=>{b(this,L,yw).call(this),l(this,tr)&&window.requestAnimationFrame(l(this,tr))}),window.requestAnimationFrame(l(this,tr))},bg=function(t,s){const[i,r]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===i&&s===r)return;const a=this.currentPath;let o=l(this,ln);if(a.push([t,s]),m(this,Ca,!0),a.length<=2){o.moveTo(...a[0]),o.lineTo(t,s);return}a.length===3&&(m(this,ln,o=new Path2D),o.moveTo(...a[0])),b(this,L,bw).call(this,o,...a.at(-3),...a.at(-2),t,s)},gw=function(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);l(this,ln).lineTo(...t)},mw=function(t,s){m(this,tr,null),t=Math.min(Math.max(t,0),this.canvas.width),s=Math.min(Math.max(s,0),this.canvas.height),b(this,L,bg).call(this,t,s),b(this,L,gw).call(this);let i;if(this.currentPath.length!==1)i=b(this,L,_w).call(this);else{const h=[t,s];i=[[h,h.slice(),h.slice(),h]]}const r=l(this,ln),a=this.currentPath;this.currentPath=[],m(this,ln,new Path2D);const o=()=>{this.allRawPaths.push(a),this.paths.push(i),this.bezierPath2D.push(r),this._uiManager.rebuild(this)},c=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(b(this,L,od).call(this),b(this,L,ld).call(this)),b(this,L,dc).call(this))};this.addCommands({cmd:o,undo:c,mustExec:!0})},yw=function(){if(!l(this,Ca))return;m(this,Ca,!1);const t=Math.ceil(this.thickness*this.parentScale),s=this.currentPath.slice(-3),i=s.map(o=>o[0]),r=s.map(o=>o[1]);Math.min(...i)-t,Math.max(...i)+t,Math.min(...r)-t,Math.max(...r)+t;const{ctx:a}=this;a.save(),a.clearRect(0,0,this.canvas.width,this.canvas.height);for(const o of this.bezierPath2D)a.stroke(o);a.stroke(l(this,ln)),a.restore()},bw=function(t,s,i,r,a,o,c){const h=(s+r)/2,u=(i+a)/2,d=(r+o)/2,f=(a+c)/2;t.bezierCurveTo(h+2*(r-h)/3,u+2*(a-u)/3,d+2*(r-d)/3,f+2*(a-f)/3,d,f)},_w=function(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const s=[];let i,[r,a]=t[0];for(i=1;i<t.length-2;i++){const[p,g]=t[i],[y,v]=t[i+1],w=(p+y)/2,A=(g+v)/2,x=[r+2*(p-r)/3,a+2*(g-a)/3],S=[w+2*(p-w)/3,A+2*(g-A)/3];s.push([[r,a],x,S,[w,A]]),[r,a]=[w,A]}const[o,c]=t[i],[h,u]=t[i+1],d=[r+2*(o-r)/3,a+2*(c-a)/3],f=[h+2*(o-h)/3,u+2*(c-u)/3];return s.push([[r,a],d,f,[h,u]]),s},Tr=function(){if(this.isEmpty()){b(this,L,cd).call(this);return}b(this,L,yg).call(this);const{canvas:t,ctx:s}=this;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),b(this,L,cd).call(this);for(const i of this.bezierPath2D)s.stroke(i)},_g=function(){if(l(this,bl))return;m(this,bl,new AbortController);const t=this._uiManager.combinedSignal(l(this,bl));this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal:t})},vg=function(){var t;(t=this.pointerdownAC)==null||t.abort(),this.pointerdownAC=null},wg=function(t){var s;(s=l(this,Ea))==null||s.abort(),m(this,Ea,null),b(this,L,_g).call(this),l(this,Ai)&&clearTimeout(l(this,Ai)),m(this,Ai,setTimeout(()=>{m(this,Ai,null),this.canvas.removeEventListener("contextmenu",ks)},10)),b(this,L,mw).call(this,t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()},od=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},ld=function(){m(this,cn,new ResizeObserver(t=>{const s=t[0].contentRect;s.width&&s.height&&this.setDimensions(s.width,s.height)})),l(this,cn).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var t;(t=l(this,cn))==null||t.disconnect(),m(this,cn,null)},{once:!0})},uo=function(){if(!l(this,ka))return;const[t,s]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*s),b(this,L,cd).call(this)},Ag=function(t,s){const i=b(this,L,hd).call(this),r=(t-i)/l(this,Sa),a=(s-i)/l(this,xa);this.scaleFactor=Math.min(r,a)},cd=function(){const t=b(this,L,hd).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)},An=new WeakSet,vw=function(t){const s=new Path2D;for(let i=0,r=t.length;i<r;i++){const[a,o,c,h]=t[i];i===0&&s.moveTo(...a),s.bezierCurveTo(o[0],o[1],c[0],c[1],h[0],h[1])}return s},xg=function(t,s,i){const[r,a,o,c]=s;switch(i){case 0:for(let h=0,u=t.length;h<u;h+=2)t[h]+=r,t[h+1]=c-t[h+1];break;case 90:for(let h=0,u=t.length;h<u;h+=2){const d=t[h];t[h]=t[h+1]+r,t[h+1]=d+a}break;case 180:for(let h=0,u=t.length;h<u;h+=2)t[h]=o-t[h],t[h+1]+=a;break;case 270:for(let h=0,u=t.length;h<u;h+=2){const d=t[h];t[h]=o-t[h+1],t[h+1]=c-d}break;default:throw new Error("Invalid rotation")}return t},ww=function(t,s,i){const[r,a,o,c]=s;switch(i){case 0:for(let h=0,u=t.length;h<u;h+=2)t[h]-=r,t[h+1]=c-t[h+1];break;case 90:for(let h=0,u=t.length;h<u;h+=2){const d=t[h];t[h]=t[h+1]-a,t[h+1]=d-r}break;case 180:for(let h=0,u=t.length;h<u;h+=2)t[h]=o-t[h],t[h+1]-=a;break;case 270:for(let h=0,u=t.length;h<u;h+=2){const d=t[h];t[h]=c-t[h+1],t[h+1]=o-d}break;default:throw new Error("Invalid rotation")}return t},Aw=function(t,s,i,r){var u,d;const a=[],o=this.thickness/2,c=t*s+o,h=t*i+o;for(const f of this.paths){const p=[],g=[];for(let y=0,v=f.length;y<v;y++){const[w,A,x,S]=f[y];if(w[0]===S[0]&&w[1]===S[1]&&v===1){const ae=t*w[0]+c,pe=t*w[1]+h;p.push(ae,pe),g.push(ae,pe);break}const E=t*w[0]+c,C=t*w[1]+h,T=t*A[0]+c,P=t*A[1]+h,O=t*x[0]+c,U=t*x[1]+h,M=t*S[0]+c,re=t*S[1]+h;y===0&&(p.push(E,C),g.push(E,C)),p.push(T,P,O,U,M,re),g.push(T,P),y===v-1&&g.push(M,re)}a.push({bezier:b(u=Le,An,xg).call(u,p,r,this.rotation),points:b(d=Le,An,xg).call(d,g,r,this.rotation)})}return a},Sg=function(){let t=1/0,s=-1/0,i=1/0,r=-1/0;for(const a of this.paths)for(const[o,c,h,u]of a){const d=B.bezierBoundingBox(...o,...c,...h,...u);t=Math.min(t,d[0]),i=Math.min(i,d[1]),s=Math.max(s,d[2]),r=Math.max(r,d[3])}return[t,i,s,r]},hd=function(){return l(this,ws)?Math.ceil(this.thickness*this.parentScale):0},dc=function(t=!1){if(this.isEmpty())return;if(!l(this,ws)){b(this,L,Tr).call(this);return}const s=b(this,L,Sg).call(this),i=b(this,L,hd).call(this);m(this,Sa,Math.max(we.MIN_SIZE,s[2]-s[0])),m(this,xa,Math.max(we.MIN_SIZE,s[3]-s[1]));const r=Math.ceil(i+l(this,Sa)*this.scaleFactor),a=Math.ceil(i+l(this,xa)*this.scaleFactor),[o,c]=this.parentDimensions;this.width=r/o,this.height=a/c,this.setAspectRatio(r,a);const h=this.translationX,u=this.translationY;this.translationX=-s[0],this.translationY=-s[1],b(this,L,uo).call(this),b(this,L,Tr).call(this),m(this,Ta,r),m(this,Pa,a),this.setDims(r,a);const d=t?i/this.scaleFactor/2:0;this.translate(h-this.translationX-d,u-this.translationY-d)},_(Le,An),G(Le,"_defaultColor",null),G(Le,"_defaultOpacity",1),G(Le,"_defaultThickness",1),G(Le,"_type","ink"),G(Le,"_editorType",Q.INK);let mg=Le;var De,mt,sr,hn,ir,_l,xi,un,Si,ls,vl,le,fc,pc,ud,Cg,xw,dd,kg,fd,Sw,Ew;const kc=class kc extends we{constructor(t){super({...t,name:"stampEditor"});_(this,le);_(this,De,null);_(this,mt,null);_(this,sr,null);_(this,hn,null);_(this,ir,null);_(this,_l,"");_(this,xi,null);_(this,un,null);_(this,Si,null);_(this,ls,!1);_(this,vl,!1);m(this,hn,t.bitmapUrl),m(this,ir,t.bitmapFile)}static initialize(t,s){we.initialize(t,s)}static get supportedTypes(){return he(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return he(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,s){s.pasteEditor(Q.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,c=await i.guess({name:"altText",request:{data:r,width:a,height:o,channels:r.length/(a*o)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const h=c.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t,s;l(this,mt)&&(m(this,De,null),this._uiManager.imageManager.deleteId(l(this,mt)),(t=l(this,xi))==null||t.remove(),m(this,xi,null),(s=l(this,un))==null||s.disconnect(),m(this,un,null),l(this,Si)&&(clearTimeout(l(this,Si)),m(this,Si,null))),super.remove()}rebuild(){if(!this.parent){l(this,mt)&&b(this,le,ud).call(this);return}super.rebuild(),this.div!==null&&(l(this,mt)&&l(this,xi)===null&&b(this,le,ud).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(l(this,sr)||l(this,De)||l(this,hn)||l(this,ir)||l(this,mt))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;if(this.width&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),l(this,De)?b(this,le,Cg).call(this):b(this,le,ud).call(this),this.width&&!this.annotationElementId){const[i,r]=this.parentDimensions;this.setAt(t*i,s*r,this.width*i,this.height*r)}return this.div}copyCanvas(t,s,i=!1){var p;t||(t=224);const{width:r,height:a}=l(this,De),o=new Ap;let c=l(this,De),h=r,u=a,d=null;if(s){if(r>s||a>s){const P=Math.min(s/r,s/a);h=Math.floor(r*P),u=Math.floor(a*P)}d=document.createElement("canvas");const g=d.width=Math.ceil(h*o.sx),y=d.height=Math.ceil(u*o.sy);l(this,ls)||(c=b(this,le,dd).call(this,g,y));const v=d.getContext("2d");v.filter=this._uiManager.hcmFilter;let w="white",A="#cfcfd8";this._uiManager.hcmFilter!=="none"?A="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",A="#42414d");const x=15,S=x*o.sx,E=x*o.sy,C=new OffscreenCanvas(S*2,E*2),T=C.getContext("2d");T.fillStyle=w,T.fillRect(0,0,S*2,E*2),T.fillStyle=A,T.fillRect(0,0,S,E),T.fillRect(S,E,S,E),v.fillStyle=v.createPattern(C,"repeat"),v.fillRect(0,0,g,y),v.drawImage(c,0,0,c.width,c.height,0,0,g,y)}let f=null;if(i){let g,y;if(o.symmetric&&c.width<t&&c.height<t)g=c.width,y=c.height;else if(c=l(this,De),r>t||a>t){const A=Math.min(t/r,t/a);g=Math.floor(r*A),y=Math.floor(a*A),l(this,ls)||(c=b(this,le,dd).call(this,g,y))}const w=new OffscreenCanvas(g,y).getContext("2d",{willReadFrequently:!0});w.drawImage(c,0,0,c.width,c.height,0,0,g,y),f={width:g,height:y,data:w.getImageData(0,0,g,y).data}}return{canvas:d,width:h,height:u,imageData:f}}getImageForAltText(){return l(this,xi)}static async deserialize(t,s,i){var y;let r=null;if(t instanceof Fv){const{data:{rect:v,rotation:w,id:A,structParent:x,popupRef:S},container:E,parent:{page:{pageNumber:C}}}=t,T=E.querySelector("canvas"),P=i.imageManager.getFromCanvas(E.id,T);T.remove();const O=((y=await s._structTree.getAriaAttributes(`${om}${A}`))==null?void 0:y.get("aria-label"))||"";r=t={annotationType:Q.STAMP,bitmapId:P.id,bitmap:P.bitmap,pageIndex:C-1,rect:v.slice(0),rotation:w,id:A,deleted:!1,accessibilityData:{decorative:!1,altText:O},isSvg:!1,structParent:x,popupRef:S}}const a=await super.deserialize(t,s,i),{rect:o,bitmap:c,bitmapUrl:h,bitmapId:u,isSvg:d,accessibilityData:f}=t;u&&i.imageManager.isValidId(u)?(m(a,mt,u),c&&m(a,De,c)):m(a,hn,h),m(a,ls,d);const[p,g]=a.pageDimensions;return a.width=(o[2]-o[0])/p,a.height=(o[3]-o[1])/g,a.annotationElementId=t.id||null,f&&(a.altTextData=f),a._initialData=r,m(a,vl,!!r),a}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:Q.STAMP,bitmapId:l(this,mt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:l(this,ls),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=b(this,le,fd).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:r,altText:a}=this.serializeAltText(!1);if(!r&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const c=b(this,le,Ew).call(this,i);if(c.isSame)return null;c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=l(this,ls)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(l(this,mt)))s.stamps.set(l(this,mt),{area:o,serialized:i}),i.bitmap=b(this,le,fd).call(this,!1);else if(l(this,ls)){const c=s.stamps.get(l(this,mt));o>c.area&&(c.area=o,c.serialized.bitmap.close(),c.serialized.bitmap=b(this,le,fd).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};De=new WeakMap,mt=new WeakMap,sr=new WeakMap,hn=new WeakMap,ir=new WeakMap,_l=new WeakMap,xi=new WeakMap,un=new WeakMap,Si=new WeakMap,ls=new WeakMap,vl=new WeakMap,le=new WeakSet,fc=function(t,s=!1){if(!t){this.remove();return}m(this,De,t.bitmap),s||(m(this,mt,t.id),m(this,ls,t.isSvg)),t.file&&m(this,_l,t.file.name),b(this,le,Cg).call(this)},pc=function(){if(m(this,sr,null),this._uiManager.enableWaiting(!1),!!l(this,xi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,De)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,De)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},ud=function(){if(l(this,mt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,mt)).then(i=>b(this,le,fc).call(this,i,!0)).finally(()=>b(this,le,pc).call(this));return}if(l(this,hn)){const i=l(this,hn);m(this,hn,null),this._uiManager.enableWaiting(!0),m(this,sr,this._uiManager.imageManager.getFromUrl(i).then(r=>b(this,le,fc).call(this,r)).finally(()=>b(this,le,pc).call(this)));return}if(l(this,ir)){const i=l(this,ir);m(this,ir,null),this._uiManager.enableWaiting(!0),m(this,sr,this._uiManager.imageManager.getFromFile(i).then(r=>b(this,le,fc).call(this,r)).finally(()=>b(this,le,pc).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=kc.supportedTypesStr;const s=this._uiManager._signal;m(this,sr,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),b(this,le,fc).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>b(this,le,pc).call(this))),t.click()},Cg=function(){const{div:t}=this;let{width:s,height:i}=l(this,De);const[r,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*r,i=this.height*a;else if(s>o*r||i>o*a){const d=Math.min(o*r/s,o*a/i);s*=d,i*=d}const[c,h]=this.parentDimensions;this.setDims(s*c/r,i*h/a),this._uiManager.enableWaiting(!1);const u=m(this,xi,document.createElement("canvas"));u.setAttribute("role","img"),this.addContainer(u),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),b(this,le,kg).call(this,s,i),b(this,le,Sw).call(this),l(this,vl)||(this.parent.addUndoableEditor(this),m(this,vl,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,_l)&&u.setAttribute("aria-label",l(this,_l))},xw=function(t,s){var o;const[i,r]=this.parentDimensions;this.width=t/i,this.height=s/r,(o=this._initialOptions)!=null&&o.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,l(this,Si)!==null&&clearTimeout(l(this,Si)),m(this,Si,setTimeout(()=>{m(this,Si,null),b(this,le,kg).call(this,t,s)},200))},dd=function(t,s){const{width:i,height:r}=l(this,De);let a=i,o=r,c=l(this,De);for(;a>2*t||o>2*s;){const h=a,u=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(a,o);d.getContext("2d").drawImage(c,0,0,h,u,0,0,a,o),c=d.transferToImageBitmap()}return c},kg=function(t,s){const i=new Ap,r=Math.ceil(t*i.sx),a=Math.ceil(s*i.sy),o=l(this,xi);if(!o||o.width===r&&o.height===a)return;o.width=r,o.height=a;const c=l(this,ls)?l(this,De):b(this,le,dd).call(this,r,a),h=o.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,r,a)},fd=function(t){if(t){if(l(this,ls)){const r=this._uiManager.imageManager.getSvgUrl(l(this,mt));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,De),s.getContext("2d").drawImage(l(this,De),0,0),s.toDataURL()}if(l(this,ls)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*mr.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*mr.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,a);return o.getContext("2d").drawImage(l(this,De),0,0,l(this,De).width,l(this,De).height,0,0,r,a),o.transferToImageBitmap()}return structuredClone(l(this,De))},Sw=function(){this._uiManager._signal&&(m(this,un,new ResizeObserver(t=>{const s=t[0].contentRect;s.width&&s.height&&b(this,le,xw).call(this,s.width,s.height)})),l(this,un).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var t;(t=l(this,un))==null||t.disconnect(),m(this,un,null)},{once:!0}))},Ew=function(t){var h;const{rect:s,pageIndex:i,accessibilityData:{altText:r}}=this._initialData,a=t.rect.every((u,d)=>Math.abs(u-s[d])<1),o=t.pageIndex===i,c=(((h=t.accessibilityData)==null?void 0:h.alt)||"")===r;return{isSame:a&&o&&c,isSameAltText:c}},G(kc,"_type","stamp"),G(kc,"_editorType",Q.STAMP);let Eg=kc;var Ra,wl,Ei,nr,dn,cs,rr,Al,xl,kt,fn,q,ar,bt,Cw,Pg,Rg,Ig,pd;const Os=class Os{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:c,viewport:h,l10n:u}){_(this,bt);_(this,Ra);_(this,wl,!1);_(this,Ei,null);_(this,nr,null);_(this,dn,null);_(this,cs,new Map);_(this,rr,!1);_(this,Al,!1);_(this,xl,!1);_(this,kt,null);_(this,fn,null);_(this,q);const d=[...l(Os,ar).values()];if(!Os._initialized){Os._initialized=!0;for(const f of d)f.initialize(u,e)}e.registerEditorTypes(d),m(this,q,e),this.pageIndex=t,this.div=s,m(this,Ra,r),m(this,Ei,a),this.viewport=h,m(this,kt,c),this.drawLayer=o,this._structTree=i,l(this,q).addLayer(this)}get isEmpty(){return l(this,cs).size===0}get isInvisible(){return this.isEmpty&&l(this,q).getMode()===Q.NONE}updateToolbar(e){l(this,q).updateToolbar(e)}updateMode(e=l(this,q).getMode()){switch(b(this,bt,pd).call(this),e){case Q.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Q.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case Q.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of l(Os,ar).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,kt))==null?void 0:t.div)}addInkEditorIfNeeded(e){if(l(this,q).getMode()!==Q.INK)return;if(!e){for(const s of l(this,cs).values())if(s.isEmpty()){s.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){l(this,q).setEditingState(e)}addCommands(e){l(this,q).addCommands(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,Ei))==null||t.div.classList.toggle("disabled",!e)}async enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of l(this,cs).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(l(this,q).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!l(this,Ei))return;const t=l(this,Ei).getEditableAnnotations();for(const s of t){if(s.hide(),l(this,q).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}}disable(){var i;m(this,xl,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const r of l(this,cs).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(i=this.getEditableAnnotation(r.annotationElementId))==null||i.show(),r.remove()}if(l(this,Ei)){const r=l(this,Ei).getEditableAnnotations();for(const a of r){const{id:o}=a.data;if(l(this,q).isDeletedAnnotationElement(o))continue;let c=t.get(o);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=e.get(o),c&&(l(this,q).addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}b(this,bt,pd).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of l(Os,ar).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),m(this,xl,!1)}getEditableAnnotation(e){var t;return((t=l(this,Ei))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,q).getActive()!==e&&l(this,q).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,kt))!=null&&e.div&&!l(this,fn)){m(this,fn,new AbortController);const t=l(this,q).combinedSignal(l(this,fn));l(this,kt).div.addEventListener("pointerdown",b(this,bt,Cw).bind(this),{signal:t}),l(this,kt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,kt))!=null&&e.div&&l(this,fn)&&(l(this,fn).abort(),m(this,fn,null),l(this,kt).div.classList.remove("highlighting"))}enableClick(){if(l(this,nr))return;m(this,nr,new AbortController);const e=l(this,q).combinedSignal(l(this,nr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:e})}disableClick(){var e;(e=l(this,nr))==null||e.abort(),m(this,nr,null)}attach(e){l(this,cs).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,q).isDeletedAnnotationElement(t)&&l(this,q).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,cs).delete(e.id),(t=l(this,Ra))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,xl)&&e.annotationElementId&&l(this,q).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,q).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,l(this,Al)||this.addInkEditorIfNeeded(!1)}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,q).addDeletedAnnotationElement(e.annotationElementId),we.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,q).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),l(this,q).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,dn)&&(e._focusEventsAllowed=!1,m(this,dn,setTimeout(()=>{m(this,dn,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,q)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,Ra))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return l(this,q).getId()}combinedSignal(e){return l(this,q).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,bt,Pg))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){l(this,q).updateToolbar(e),l(this,q).updateMode(e);const{offsetX:s,offsetY:i}=b(this,bt,Ig).call(this),r=this.getNextId(),a=b(this,bt,Rg).call(this,{parent:this,id:r,x:s,y:i,uiManager:l(this,q),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=l(Os,ar).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,q)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=b(this,bt,Rg).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:l(this,q),isCentered:t,...s});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(b(this,bt,Ig).call(this),!0)}setSelected(e){l(this,q).setSelected(e)}toggleSelected(e){l(this,q).toggleSelected(e)}unselect(e){l(this,q).unselect(e)}pointerup(e){const{isMac:t}=Dt.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&l(this,rr)){if(m(this,rr,!1),!l(this,wl)){m(this,wl,!0);return}if(l(this,q).getMode()===Q.STAMP){l(this,q).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(l(this,q).getMode()===Q.HIGHLIGHT&&this.enableTextSelection(),l(this,rr)){m(this,rr,!1);return}const{isMac:t}=Dt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;m(this,rr,!0);const s=l(this,q).getActive();m(this,wl,!s||s.isEmpty())}findNewParent(e,t,s){const i=l(this,q).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}destroy(){var e,t;((e=l(this,q).getActive())==null?void 0:e.parent)===this&&(l(this,q).commitOrRemove(),l(this,q).setActiveEditor(null)),l(this,dn)&&(clearTimeout(l(this,dn)),m(this,dn,null));for(const s of l(this,cs).values())(t=l(this,Ra))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,cs).clear(),l(this,q).removeLayer(this)}render({viewport:e}){this.viewport=e,ja(this.div,e);for(const t of l(this,q).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,q).commitOrRemove(),b(this,bt,pd).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,ja(this.div,{rotation:s}),t!==s)for(const i of l(this,cs).values())i.rotate(s);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,q).viewParameters.realScale}};Ra=new WeakMap,wl=new WeakMap,Ei=new WeakMap,nr=new WeakMap,dn=new WeakMap,cs=new WeakMap,rr=new WeakMap,Al=new WeakMap,xl=new WeakMap,kt=new WeakMap,fn=new WeakMap,q=new WeakMap,ar=new WeakMap,bt=new WeakSet,Cw=function(e){l(this,q).unselectAll();const{target:t}=e;if(t===l(this,kt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,kt).div.contains(t)){const{isMac:s}=Dt.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,q).showAllEditors("highlight",!0,!0),l(this,kt).div.classList.add("free"),this.toggleDrawing(),Ld.startHighlighting(this,l(this,q).direction==="ltr",{target:l(this,kt).div,x:e.x,y:e.y}),l(this,kt).div.addEventListener("pointerup",()=>{l(this,kt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,q)._signal}),e.preventDefault()}},Pg=function(){return l(Os,ar).get(l(this,q).getMode())},Rg=function(e){const t=l(this,bt,Pg);return t?new t.prototype.constructor(e):null},Ig=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,t+i),h=(r+o)/2-e,u=(a+c)/2-t,[d,f]=this.viewport.rotation%180===0?[h,u]:[u,h];return{offsetX:d,offsetY:f}},pd=function(){m(this,Al,!0);for(const e of l(this,cs).values())e.isEmpty()&&e.remove();m(this,Al,!1)},G(Os,"_initialized",!1),_(Os,ar,new Map([og,mg,Eg,Ld].map(e=>[e._editorType,e])));let Tg=Os;var Ci,lu,We,pn,cu,Mg,za,Lg,kw;const ft=class ft{constructor({pageIndex:e}){_(this,za);_(this,Ci,null);_(this,lu,0);_(this,We,new Map);_(this,pn,new Map);this.pageIndex=e}setParent(e){if(!l(this,Ci)){m(this,Ci,e);return}if(l(this,Ci)!==e){if(l(this,We).size>0)for(const t of l(this,We).values())t.remove(),e.append(t);m(this,Ci,e)}}static get _svgFactory(){return he(this,"_svgFactory",new ym)}draw(e,t,s,i=!1){const r=nt(this,lu)._++,a=b(this,za,Lg).call(this,e.box);a.classList.add(...e.classNamesForDrawing);const o=ft._svgFactory.createElement("defs");a.append(o);const c=ft._svgFactory.createElement("path");o.append(c);const h=`path_p${this.pageIndex}_${r}`;c.setAttribute("id",h),c.setAttribute("d",e.toSVGPath()),i&&l(this,pn).set(r,c);const u=b(this,za,kw).call(this,o,h),d=ft._svgFactory.createElement("use");return a.append(d),a.setAttribute("fill",t),a.setAttribute("fill-opacity",s),d.setAttribute("href",`#${h}`),l(this,We).set(r,a),{id:r,clipPathId:`url(#${u})`}}drawOutline(e){const t=nt(this,lu)._++,s=b(this,za,Lg).call(this,e.box);s.classList.add(...e.classNamesForOutlining);const i=ft._svgFactory.createElement("defs");s.append(i);const r=ft._svgFactory.createElement("path");i.append(r);const a=`path_p${this.pageIndex}_${t}`;r.setAttribute("id",a),r.setAttribute("d",e.toSVGPath()),r.setAttribute("vector-effect","non-scaling-stroke");let o;if(e.mustRemoveSelfIntersections){const u=ft._svgFactory.createElement("mask");i.append(u),o=`mask_p${this.pageIndex}_${t}`,u.setAttribute("id",o),u.setAttribute("maskUnits","objectBoundingBox");const d=ft._svgFactory.createElement("rect");u.append(d),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("fill","white");const f=ft._svgFactory.createElement("use");u.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const c=ft._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),o&&c.setAttribute("mask",`url(#${o})`);const h=c.cloneNode();return s.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),l(this,We).set(t,s),t}finalizeLine(e,t){const s=l(this,pn).get(e);l(this,pn).delete(e),this.updateBox(e,t.box),s.setAttribute("d",t.toSVGPath())}updateLine(e,t){l(this,We).get(e).firstChild.firstChild.setAttribute("d",t.toSVGPath())}updatePath(e,t){l(this,pn).get(e).setAttribute("d",t.toSVGPath())}updateBox(e,t){var s;b(s=ft,cu,Mg).call(s,l(this,We).get(e),t)}show(e,t){l(this,We).get(e).classList.toggle("hidden",!t)}rotate(e,t){l(this,We).get(e).setAttribute("data-main-rotation",t)}changeColor(e,t){l(this,We).get(e).setAttribute("fill",t)}changeOpacity(e,t){l(this,We).get(e).setAttribute("fill-opacity",t)}addClass(e,t){l(this,We).get(e).classList.add(t)}removeClass(e,t){l(this,We).get(e).classList.remove(t)}getSVGRoot(e){return l(this,We).get(e)}remove(e){l(this,pn).delete(e),l(this,Ci)!==null&&(l(this,We).get(e).remove(),l(this,We).delete(e))}destroy(){m(this,Ci,null);for(const e of l(this,We).values())e.remove();l(this,We).clear(),l(this,pn).clear()}};Ci=new WeakMap,lu=new WeakMap,We=new WeakMap,pn=new WeakMap,cu=new WeakSet,Mg=function(e,{x:t=0,y:s=0,width:i=1,height:r=1}={}){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*i}%`,a.height=`${100*r}%`},za=new WeakSet,Lg=function(e){var s;const t=ft._svgFactory.create(1,1,!0);return l(this,Ci).append(t),t.setAttribute("aria-hidden",!0),b(s=ft,cu,Mg).call(s,t,e),t},kw=function(e,t){const s=ft._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=ft._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},_(ft,cu);let Og=ft;var qk=K.AbortException,Vk=K.AnnotationEditorLayer,Wk=K.AnnotationEditorParamsType,Gk=K.AnnotationEditorType,Xk=K.AnnotationEditorUIManager,Kk=K.AnnotationLayer,Zk=K.AnnotationMode,Yk=K.ColorPicker,Jk=K.DOMSVGFactory,Qk=K.DrawLayer,eT=K.FeatureTest,tT=K.GlobalWorkerOptions,sT=K.ImageKind,iT=K.InvalidPDFException,nT=K.MissingPDFException,rT=K.OPS,aT=K.OutputScale,oT=K.PDFDataRangeTransport,lT=K.PDFDateString,cT=K.PDFWorker,hT=K.PasswordResponses,uT=K.PermissionFlag,dT=K.PixelsPerInch,fT=K.RenderingCancelledException,pT=K.TextLayer,gT=K.UnexpectedResponseException,mT=K.Util,yT=K.VerbosityLevel,bT=K.XfaLayer,_T=K.build,vT=K.createValidAbsoluteUrl,wT=K.fetchData,Tw=K.getDocument,AT=K.getFilenameFromUrl,xT=K.getPdfFilenameFromUrl,ST=K.getXfaPageViewport,ET=K.isDataScheme,CT=K.isPdfFile,kT=K.noContextMenu,TT=K.normalizeUnicode,PT=K.setLayerDimensions,RT=K.shadow,IT=K.version;const OT=Object.freeze(Object.defineProperty({__proto__:null,AbortException:qk,AnnotationEditorLayer:Vk,AnnotationEditorParamsType:Wk,AnnotationEditorType:Gk,AnnotationEditorUIManager:Xk,AnnotationLayer:Kk,AnnotationMode:Zk,ColorPicker:Yk,DOMSVGFactory:Jk,DrawLayer:Qk,FeatureTest:eT,GlobalWorkerOptions:tT,ImageKind:sT,InvalidPDFException:iT,MissingPDFException:nT,OPS:rT,OutputScale:aT,PDFDataRangeTransport:oT,PDFDateString:lT,PDFWorker:cT,PasswordResponses:hT,PermissionFlag:uT,PixelsPerInch:dT,RenderingCancelledException:fT,TextLayer:pT,UnexpectedResponseException:gT,Util:mT,VerbosityLevel:yT,XfaLayer:bT,build:_T,createValidAbsoluteUrl:vT,fetchData:wT,getDocument:Tw,getFilenameFromUrl:AT,getPdfFilenameFromUrl:xT,getXfaPageViewport:ST,isDataScheme:ET,isPdfFile:CT,noContextMenu:kT,normalizeUnicode:TT,setLayerDimensions:PT,shadow:RT,version:IT},Symbol.toStringTag,{value:"Module"}));function MT({onPdfUpload:n,onTextExtracted:e}){var i,r;const[t,s]=F.useState(BE);return k.jsx("div",{className:"w-full items-center",children:k.jsx(je,{type:"file",accept:".pdf","data-file-name":((i=t.pdf)==null?void 0:i.name)||"",className:`input-component upload-field ${(r=t.pdf)!=null&&r.name?"document-name-label":"document-upload-label"}`,onChange:async a=>{if(!a.target.files||!a.target.files[0]||!a.target.files[0].name)return;const o=a.target.files[0],c=await zE(o),h=await o.arrayBuffer(),u=await Tw({data:h}).promise;let d="";for(let f=1;f<=u.numPages;f++){const y=(await(await u.getPage(f)).getTextContent()).items.map(v=>v.str).join(" ");d+=y+`
`}s({pdf:a.target.files[0],imageSrc:c}),n(c),console.log("fullText",d),e&&e(d)}})})}const Fg="RFC3986",Dg={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},LT="RFC1738",FT=Array.isArray,ai=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),qf=1024,DT=(n,e,t,s,i)=>{if(n.length===0)return n;let r=n;if(typeof n=="symbol"?r=Symbol.prototype.toString.call(n):typeof n!="string"&&(r=String(n)),t==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<r.length;o+=qf){const c=r.length>=qf?r.slice(o,o+qf):r,h=[];for(let u=0;u<c.length;++u){let d=c.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||i===LT&&(d===40||d===41)){h[h.length]=c.charAt(u);continue}if(d<128){h[h.length]=ai[d];continue}if(d<2048){h[h.length]=ai[192|d>>6]+ai[128|d&63];continue}if(d<55296||d>=57344){h[h.length]=ai[224|d>>12]+ai[128|d>>6&63]+ai[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|c.charCodeAt(u)&1023),h[h.length]=ai[240|d>>18]+ai[128|d>>12&63]+ai[128|d>>6&63]+ai[128|d&63]}a+=h.join("")}return a};function NT(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Iy(n,e){if(FT(n)){const t=[];for(let s=0;s<n.length;s+=1)t.push(e(n[s]));return t}return e(n)}const jT=Object.prototype.hasOwnProperty,Pw={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},oi=Array.isArray,$T=Array.prototype.push,Rw=function(n,e){$T.apply(n,oi(e)?e:[e])},UT=Date.prototype.toISOString,Je={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:DT,encodeValuesOnly:!1,format:Fg,formatter:Dg[Fg],indices:!1,serializeDate(n){return UT.call(n)},skipNulls:!1,strictNullHandling:!1};function BT(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const Vf={};function Iw(n,e,t,s,i,r,a,o,c,h,u,d,f,p,g,y,v,w){let A=n,x=w,S=0,E=!1;for(;(x=x.get(Vf))!==void 0&&!E;){const U=x.get(n);if(S+=1,typeof U<"u"){if(U===S)throw new RangeError("Cyclic object value");E=!0}typeof x.get(Vf)>"u"&&(S=0)}if(typeof h=="function"?A=h(e,A):A instanceof Date?A=f==null?void 0:f(A):t==="comma"&&oi(A)&&(A=Iy(A,function(U){return U instanceof Date?f==null?void 0:f(U):U})),A===null){if(r)return c&&!y?c(e,Je.encoder,v,"key",p):e;A=""}if(BT(A)||NT(A)){if(c){const U=y?e:c(e,Je.encoder,v,"key",p);return[(g==null?void 0:g(U))+"="+(g==null?void 0:g(c(A,Je.encoder,v,"value",p)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(A)))]}const C=[];if(typeof A>"u")return C;let T;if(t==="comma"&&oi(A))y&&c&&(A=Iy(A,c)),T=[{value:A.length>0?A.join(",")||null:void 0}];else if(oi(h))T=h;else{const U=Object.keys(A);T=u?U.sort(u):U}const P=o?String(e).replace(/\./g,"%2E"):String(e),O=s&&oi(A)&&A.length===1?P+"[]":P;if(i&&oi(A)&&A.length===0)return O+"[]";for(let U=0;U<T.length;++U){const M=T[U],re=typeof M=="object"&&typeof M.value<"u"?M.value:A[M];if(a&&re===null)continue;const ae=d&&o?M.replace(/\./g,"%2E"):M,pe=oi(A)?typeof t=="function"?t(O,ae):O:O+(d?"."+ae:"["+ae+"]");w.set(n,S);const fe=new WeakMap;fe.set(Vf,w),Rw(C,Iw(re,pe,t,s,i,r,a,o,t==="comma"&&y&&oi(A)?null:c,h,u,d,f,p,g,y,v,fe))}return C}function HT(n=Je){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||Je.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Fg;if(typeof n.format<"u"){if(!jT.call(Dg,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const s=Dg[t];let i=Je.filter;(typeof n.filter=="function"||oi(n.filter))&&(i=n.filter);let r;if(n.arrayFormat&&n.arrayFormat in Pw?r=n.arrayFormat:"indices"in n?r=n.indices?"indices":"repeat":r=Je.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Je.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Je.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Je.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Je.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Je.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Je.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Je.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Je.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Je.encodeValuesOnly,filter:i,format:t,formatter:s,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Je.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Je.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Je.strictNullHandling}}function zT(n,e={}){let t=n;const s=HT(e);let i,r;typeof s.filter=="function"?(r=s.filter,t=r("",t)):oi(s.filter)&&(r=s.filter,i=r);const a=[];if(typeof t!="object"||t===null)return"";const o=Pw[s.arrayFormat],c=o==="comma"&&s.commaRoundTrip;i||(i=Object.keys(t)),s.sort&&i.sort(s.sort);const h=new WeakMap;for(let f=0;f<i.length;++f){const p=i[f];s.skipNulls&&t[p]===null||Rw(a,Iw(t[p],p,o,c,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,h))}const u=a.join(s.delimiter);let d=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const fo="4.73.0";let Oy=!1,Ec,Ow,Mw,Ng,Lw,Fw,Dw,Nw,jw;function qT(n,e={auto:!1}){if(Oy)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Ec)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Ec}'\``);Oy=e.auto,Ec=n.kind,Ow=n.fetch,Mw=n.FormData,Ng=n.File,Lw=n.ReadableStream,Fw=n.getMultipartRequestOptions,Dw=n.getDefaultAgent,Nw=n.fileFromPath,jw=n.isFsReadStream}class VT{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function WT({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,s,i,r;try{t=fetch,s=Request,i=Response,r=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:s,Response:i,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new VT(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Ec||qT(WT(),{auto:!0});class oe extends Error{}class _t extends oe{constructor(e,t,s,i){super(`${_t.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"];const r=t;this.error=r,this.code=r==null?void 0:r.code,this.param=r==null?void 0:r.param,this.type=r==null?void 0:r.type}static makeMessage(e,t,s){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e)return new Af({message:s,cause:$g(t)});const r=t==null?void 0:t.error;return e===400?new $w(e,r,s,i):e===401?new Uw(e,r,s,i):e===403?new Bw(e,r,s,i):e===404?new Hw(e,r,s,i):e===409?new zw(e,r,s,i):e===422?new qw(e,r,s,i):e===429?new Vw(e,r,s,i):e>=500?new Ww(e,r,s,i):new _t(e,r,s,i)}}class Qs extends _t{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Af extends _t{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class _m extends Af{constructor({message:e}={}){super({message:e??"Request timed out."})}}class $w extends _t{constructor(){super(...arguments),this.status=400}}class Uw extends _t{constructor(){super(...arguments),this.status=401}}class Bw extends _t{constructor(){super(...arguments),this.status=403}}class Hw extends _t{constructor(){super(...arguments),this.status=404}}class zw extends _t{constructor(){super(...arguments),this.status=409}}class qw extends _t{constructor(){super(...arguments),this.status=422}}class Vw extends _t{constructor(){super(...arguments),this.status=429}}class Ww extends _t{}class Gw extends oe{constructor(){super("Could not parse response content as the length limit was reached")}}class Xw extends oe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Ba{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=Ba.NEWLINE_CHARS.has(t[t.length-1]||"");let i=t.split(Ba.NEWLINE_REGEXP);return s&&i.pop(),i.length===1&&!s?(this.buffer.push(i[0]),[]):(this.buffer.length>0&&(i=[this.buffer.join("")+i[0],...i.slice(1)],this.buffer=[]),s||(this.buffer=[i.pop()||""]),i)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new oe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new oe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new oe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Ba.NEWLINE_CHARS=new Set([`
`,"\r"]);Ba.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Ri{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(const a of GT(e,t))if(!r){if(a.data.startsWith("[DONE]")){r=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(o&&o.error)throw new _t(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(a.event=="error")throw new _t(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}r=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{r||t.abort()}}return new Ri(i,t)}static fromReadableStream(e,t){let s=!1;async function*i(){const a=new Ba,o=Kw(e);for await(const c of o)for(const h of a.decode(c))yield h;for(const c of a.flush())yield c}async function*r(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const o of i())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Ri(r,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const a=s.next();e.push(a),t.push(a)}return r.shift()}});return[new Ri(()=>i(e),this.controller),new Ri(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new Lw({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{const{value:r,done:a}=await t.next();if(a)return i.close();const o=s.encode(JSON.stringify(r)+`
`);i.enqueue(o)}catch(r){i.error(r)}},async cancel(){var i;await((i=t.return)==null?void 0:i.call(t))}})}}async function*GT(n,e){if(!n.body)throw e.abort(),new oe("Attempted to iterate over a response with no body");const t=new ZT,s=new Ba,i=Kw(n.body);for await(const r of XT(i))for(const a of s.decode(r)){const o=t.decode(a);o&&(yield o)}for(const r of s.flush()){const a=t.decode(r);a&&(yield a)}}async function*XT(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let r;for(;(r=KT(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}function KT(n){for(let s=0;s<n.length-2;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}class ZT{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=YT(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function YT(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Kw(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Zw=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Yw=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&xf(n),xf=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",JT=n=>Yw(n)||Zw(n)||jw(n);async function Jw(n,e,t){var i;if(n=await n,Yw(n))return n;if(Zw(n)){const r=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=xf(r)?[await r.arrayBuffer()]:[r];return new Ng(a,e,t)}const s=await QT(n);if(e||(e=tP(n)??"unknown_file"),!(t!=null&&t.type)){const r=(i=s[0])==null?void 0:i.type;typeof r=="string"&&(t={...t,type:r})}return new Ng(s,e,t)}async function QT(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(xf(n))e.push(await n.arrayBuffer());else if(sP(n))for await(const s of n)e.push(s);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${eP(n)}`);return e}function eP(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function tP(n){var e;return Wf(n.name)||Wf(n.filename)||((e=Wf(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Wf=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},sP=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",My=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Nl=async n=>{const e=await iP(n.body);return Fw(e,n)},iP=async n=>{const e=new Mw;return await Promise.all(Object.entries(n||{}).map(([t,s])=>jg(e,t,s))),e},jg=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(JT(t)){const s=await Jw(t);n.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>jg(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,i])=>jg(n,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ao={},nP=function(n,e,t,s,i){if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},rP=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Mu;async function Qw(n){const{response:e}=n;if(n.options.stream)return xo("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Ri.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const r=await e.json();return xo("response",e.status,e.url,e.headers,r),e0(r,e)}const i=await e.text();return xo("response",e.status,e.url,e.headers,i),i}function e0(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Sf extends Promise{constructor(e,t=Qw){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Sf(this.responsePromise,async t=>e0(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class aP{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:i,fetch:r}){this.baseURL=e,this.maxRetries=Gf("maxRetries",t),this.timeout=Gf("timeout",s),this.httpAgent=i,this.fetch=r??Ow}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...dP(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${mP()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async i=>{const r=i&&xf(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:t,...i,body:r}}))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var y;const{method:s,path:i,query:r,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:My(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(o),h=this.buildURL(i,r);"timeout"in e&&Gf("timeout",e.timeout);const u=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??Dw(h),f=u+1e3;typeof((y=d==null?void 0:d.options)==null?void 0:y.timeout)=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:c,retryCount:t});return{req:{method:s,...o&&{body:o},headers:p,...d&&{agent:d},signal:e.signal??null},url:h,timeout:u}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:i}){const r={};s&&(r["content-length"]=s);const a=this.defaultHeaders(e);return Ny(r,a),Ny(r,t),My(e.body)&&Ec!=="node"&&delete r["content-type"],jy(a,"x-stainless-retry-count")===void 0&&jy(t,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(i)),this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,s,i){return _t.generate(e,t,s,i)}request(e,t=null){return new Sf(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);const{req:r,url:a,timeout:o}=this.buildRequest(s,{retryCount:i-t});if(await this.prepareRequest(r,{url:a,options:s}),xo("request",a,s,r.headers),(d=s.signal)!=null&&d.aborted)throw new Qs;const c=new AbortController,h=await this.fetchWithTimeout(a,r,o,c).catch($g);if(h instanceof Error){if((f=s.signal)!=null&&f.aborted)throw new Qs;if(t)return this.retryRequest(s,t);throw h.name==="AbortError"?new _m:new Af({cause:h})}const u=lP(h.headers);if(!h.ok){if(t&&this.shouldRetry(h)){const A=`retrying, ${t} attempts remaining`;return xo(`response (error; ${A})`,h.status,a,u),this.retryRequest(s,t,u)}const p=await h.text().catch(A=>$g(A).message),g=fP(p),y=g?void 0:p;throw xo(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,h.status,a,u,y),this.makeStatusError(h.status,g,y,u)}return{response:h,options:s,controller:c}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new oP(this,s,e)}buildURL(e,t){const s=gP(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return s0(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new oe(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,i){const{signal:r,...a}=t||{};r&&r.addEventListener("abort",()=>i.abort());const o=setTimeout(()=>i.abort(),s);return this.getRequestClient().fetch.call(void 0,e,{signal:i.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s){let i;const r=s==null?void 0:s["retry-after-ms"];if(r){const o=parseFloat(r);Number.isNaN(o)||(i=o)}const a=s==null?void 0:s["retry-after"];if(a&&!i){const o=parseFloat(a);Number.isNaN(o)?i=Date.parse(a)-Date.now():i=o*1e3}if(!(i&&0<=i&&i<60*1e3)){const o=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,o)}return await bu(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,a=Math.min(.5*Math.pow(2,r),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${fo}`}}class t0{constructor(e,t,s,i){Mu.set(this,void 0),nP(this,Mu,e),this.options=i,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new oe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[i,r]of s)e.url.searchParams.set(i,r);t.query=void 0,t.path=e.url.toString()}return await rP(this,Mu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Mu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class oP extends Sf{constructor(e,t,s){super(t,async i=>new s(e,i.response,await Qw(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const lP=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),cP={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Yt=n=>typeof n=="object"&&n!==null&&!s0(n)&&Object.keys(n).every(e=>i0(cP,e)),hP=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":Fy(Deno.build.os),"X-Stainless-Arch":Ly(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":Fy(process.platform),"X-Stainless-Arch":Ly(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=uP();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function uP(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,a=s[3]||0;return{browser:e,version:`${i}.${r}.${a}`}}}return null}const Ly=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Fy=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Dy;const dP=()=>Dy??(Dy=hP()),fP=n=>{try{return JSON.parse(n)}catch{return}},pP=new RegExp("^(?:[a-z]+:)?//","i"),gP=n=>pP.test(n),bu=n=>new Promise(e=>setTimeout(e,n)),Gf=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new oe(`${n} must be an integer`);if(e<0)throw new oe(`${n} must be a positive integer`);return e},$g=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Lu=n=>{var e,t,s,i;if(typeof process<"u")return((e=Ao==null?void 0:Ao[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(s=(t=Deno.env)==null?void 0:t.get)==null?void 0:s.call(t,n))==null?void 0:i.trim()};function s0(n){if(!n)return!0;for(const e in n)return!1;return!0}function i0(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ny(n,e){for(const t in e){if(!i0(e,t))continue;const s=t.toLowerCase();if(!s)continue;const i=e[t];i===null?delete n[s]:i!==void 0&&(n[s]=i)}}function xo(n,...e){typeof process<"u"&&(Ao==null?void 0:Ao.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const mP=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),yP=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",bP=n=>typeof(n==null?void 0:n.get)=="function",jy=(n,e)=>{var s;const t=e.toLowerCase();if(bP(n)){const i=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(r,a,o)=>a+o.toUpperCase());for(const r of[e,t,e.toUpperCase(),i]){const a=n.get(r);if(a)return a}}for(const[i,r]of Object.entries(n))if(i.toLowerCase()===t)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${e} header, using the first entry.`),r[0]):r};function Xf(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class _P extends t0{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ni extends t0{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const t=(s=e[e.length-1])==null?void 0:s.id;return t?{params:{after:t}}:null}}class xe{constructor(e){this._client=e}}let n0=class extends xe{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},vm=class extends xe{constructor(){super(...arguments),this.completions=new n0(this._client)}};vm.Completions=n0;class r0 extends xe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class a0 extends xe{create(e,t){return this._client.post("/audio/transcriptions",Nl({body:e,...t}))}}class o0 extends xe{create(e,t){return this._client.post("/audio/translations",Nl({body:e,...t}))}}class _u extends xe{constructor(){super(...arguments),this.transcriptions=new a0(this._client),this.translations=new o0(this._client),this.speech=new r0(this._client)}}_u.Transcriptions=a0;_u.Translations=o0;_u.Speech=r0;class wm extends xe{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Yt(e)?this.list({},e):this._client.getAPIList("/batches",Am,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Am extends ni{}wm.BatchesPage=Am;class xm extends xe{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},t){return Yt(e)?this.list({},e):this._client.getAPIList("/assistants",Sm,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Sm extends ni{}xm.AssistantsPage=Sm;function $y(n){return typeof n.parse=="function"}const So=n=>(n==null?void 0:n.role)==="assistant",l0=n=>(n==null?void 0:n.role)==="function",c0=n=>(n==null?void 0:n.role)==="tool";var Is=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Me=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Ug,gd,md,gc,mc,yd,yc,Ui,bc,Fd,Dd,po,h0;class u0{constructor(){Ug.add(this),this.controller=new AbortController,gd.set(this,void 0),md.set(this,()=>{}),gc.set(this,()=>{}),mc.set(this,void 0),yd.set(this,()=>{}),yc.set(this,()=>{}),Ui.set(this,{}),bc.set(this,!1),Fd.set(this,!1),Dd.set(this,!1),po.set(this,!1),Is(this,gd,new Promise((e,t)=>{Is(this,md,e,"f"),Is(this,gc,t,"f")}),"f"),Is(this,mc,new Promise((e,t)=>{Is(this,yd,e,"f"),Is(this,yc,t,"f")}),"f"),Me(this,gd,"f").catch(()=>{}),Me(this,mc,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Me(this,Ug,"m",h0).bind(this))},0)}_connected(){this.ended||(Me(this,md,"f").call(this),this._emit("connect"))}get ended(){return Me(this,bc,"f")}get errored(){return Me(this,Fd,"f")}get aborted(){return Me(this,Dd,"f")}abort(){this.controller.abort()}on(e,t){return(Me(this,Ui,"f")[e]||(Me(this,Ui,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=Me(this,Ui,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===t);return i>=0&&s.splice(i,1),this}once(e,t){return(Me(this,Ui,"f")[e]||(Me(this,Ui,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{Is(this,po,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){Is(this,po,!0,"f"),await Me(this,mc,"f")}_emit(e,...t){if(Me(this,bc,"f"))return;e==="end"&&(Is(this,bc,!0,"f"),Me(this,yd,"f").call(this));const s=Me(this,Ui,"f")[e];if(s&&(Me(this,Ui,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Me(this,po,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Me(this,gc,"f").call(this,i),Me(this,yc,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Me(this,po,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Me(this,gc,"f").call(this,i),Me(this,yc,"f").call(this,i),this._emit("end")}}_emitFinal(){}}gd=new WeakMap,md=new WeakMap,gc=new WeakMap,mc=new WeakMap,yd=new WeakMap,yc=new WeakMap,Ui=new WeakMap,bc=new WeakMap,Fd=new WeakMap,Dd=new WeakMap,po=new WeakMap,Ug=new WeakSet,h0=function(e){if(Is(this,Fd,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Qs),e instanceof Qs)return Is(this,Dd,!0,"f"),this._emit("abort",e);if(e instanceof oe)return this._emit("error",e);if(e instanceof Error){const t=new oe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new oe(String(e)))};function vP(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function d0(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function vu(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function wP(n,e){return!e||!f0(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Em(n,e)}function Em(n,e){const t=n.choices.map(s=>{var i;if(s.finish_reason==="length")throw new Gw;if(s.finish_reason==="content_filter")throw new Xw;return{...s,message:{...s.message,tool_calls:((i=s.message.tool_calls)==null?void 0:i.map(r=>xP(e,r)))??[],parsed:s.message.content&&!s.message.refusal?AP(e,s.message.content):null}}});return{...n,choices:t}}function AP(n,e){var t,s;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((s=n.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function xP(n,e){var s;const t=(s=n.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:vu(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function SP(n,e){var s;if(!n)return!1;const t=(s=n.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return vu(t)||(t==null?void 0:t.function.strict)||!1}function f0(n){var e;return d0(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>vu(t)||t.type==="function"&&t.function.strict===!0))??!1}function EP(n){for(const e of n??[]){if(e.type!=="function")throw new oe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new oe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var zt=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},xt,Bg,Nd,Hg,zg,qg,p0,Vg;const Uy=10;class g0 extends u0{constructor(){super(...arguments),xt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(s=e.choices[0])==null?void 0:s.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(l0(e)||c0(e))&&e.content)this._emit("functionCallResult",e.content);else if(So(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(So(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new oe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),zt(this,xt,"m",Bg).call(this)}async finalMessage(){return await this.done(),zt(this,xt,"m",Nd).call(this)}async finalFunctionCall(){return await this.done(),zt(this,xt,"m",Hg).call(this)}async finalFunctionCallResult(){return await this.done(),zt(this,xt,"m",zg).call(this)}async totalUsage(){return await this.done(),zt(this,xt,"m",qg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=zt(this,xt,"m",Nd).call(this);t&&this._emit("finalMessage",t);const s=zt(this,xt,"m",Bg).call(this);s&&this._emit("finalContent",s);const i=zt(this,xt,"m",Hg).call(this);i&&this._emit("finalFunctionCall",i);const r=zt(this,xt,"m",zg).call(this);r!=null&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",zt(this,xt,"m",qg).call(this))}async _createChatCompletion(e,t,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),zt(this,xt,"m",p0).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Em(r,t))}async _runChatCompletion(e,t,s){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){var f;const i="function",{function_call:r="auto",stream:a,...o}=t,c=typeof r!="string"&&(r==null?void 0:r.name),{maxChatCompletions:h=Uy}=s||{},u={};for(const p of t.functions)u[p.name||p.function.name]=p;const d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<h;++p){const y=(f=(await this._createChatCompletion(e,{...o,function_call:r,functions:d,messages:[...this.messages]},s)).choices[0])==null?void 0:f.message;if(!y)throw new oe("missing message in ChatCompletion response");if(!y.function_call)return;const{name:v,arguments:w}=y.function_call,A=u[v];if(A){if(c&&c!==v){const C=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:i,name:v,content:C});continue}}else{const C=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${d.map(T=>JSON.stringify(T.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:v,content:C});continue}let x;try{x=$y(A)?await A.parse(w):w}catch(C){this._addMessage({role:i,name:v,content:C instanceof Error?C.message:String(C)});continue}const S=await A.function(x,this),E=zt(this,xt,"m",Vg).call(this,S);if(this._addMessage({role:i,name:v,content:E}),c)return}}async _runTools(e,t,s){var p,g,y;const i="tool",{tool_choice:r="auto",stream:a,...o}=t,c=typeof r!="string"&&((p=r==null?void 0:r.function)==null?void 0:p.name),{maxChatCompletions:h=Uy}=s||{},u=t.tools.map(v=>{if(vu(v)){if(!v.$callback)throw new oe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of u)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const f="tools"in t?u.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of t.messages)this._addMessage(v,!1);for(let v=0;v<h;++v){const A=(g=(await this._createChatCompletion(e,{...o,tool_choice:r,tools:f,messages:[...this.messages]},s)).choices[0])==null?void 0:g.message;if(!A)throw new oe("missing message in ChatCompletion response");if(!((y=A.tool_calls)!=null&&y.length))return;for(const x of A.tool_calls){if(x.type!=="function")continue;const S=x.id,{name:E,arguments:C}=x.function,T=d[E];if(T){if(c&&c!==E){const M=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:i,tool_call_id:S,content:M});continue}}else{const M=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(d).map(re=>JSON.stringify(re)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:S,content:M});continue}let P;try{P=$y(T)?await T.parse(C):C}catch(M){const re=M instanceof Error?M.message:String(M);this._addMessage({role:i,tool_call_id:S,content:re});continue}const O=await T.function(P,this),U=zt(this,xt,"m",Vg).call(this,O);if(this._addMessage({role:i,tool_call_id:S,content:U}),c)return}}}}xt=new WeakSet,Bg=function(){return zt(this,xt,"m",Nd).call(this).content??null},Nd=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(So(t)){const{function_call:s,...i}=t,r={...i,content:t.content??null,refusal:t.refusal??null};return s&&(r.function_call=s),r}}throw new oe("stream ended without producing a ChatCompletionMessage with role=assistant")},Hg=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const i=this.messages[s];if(So(i)&&(i!=null&&i.function_call))return i.function_call;if(So(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(t=i.tool_calls.at(-1))==null?void 0:t.function}},zg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(l0(t)&&t.content!=null||c0(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>{var i;return s.role==="assistant"&&((i=s.tool_calls)==null?void 0:i.some(r=>r.type==="function"&&r.id===t.tool_call_id))}))return t.content}},qg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},p0=function(e){if(e.n!=null&&e.n>1)throw new oe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Vg=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Vc extends g0{static runFunctions(e,t,s){const i=new Vc,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,r)),i}static runTools(e,t,s){const i=new Vc,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,r)),i}_addMessage(e,t=!0){super._addMessage(e,t),So(e)&&e.content&&this._emit("content",e.content)}}const m0=1,y0=2,b0=4,_0=8,v0=16,w0=32,A0=64,x0=128,S0=256,CP=x0|S0,kP=v0|w0|CP|A0,TP=m0|y0|kP,PP=b0|_0,RP=TP|PP,at={STR:m0,NUM:y0,ARR:b0,OBJ:_0,NULL:v0,BOOL:w0,NAN:A0,INFINITY:x0,MINUS_INFINITY:S0,ALL:RP};class IP extends Error{}class OP extends Error{}function MP(n,e=at.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return LP(n.trim(),e)}const LP=(n,e)=>{const t=n.length;let s=0;const i=f=>{throw new IP(`${f} at position ${s}`)},r=f=>{throw new OP(`${f} at position ${s}`)},a=()=>(d(),s>=t&&i("Unexpected end of input"),n[s]==='"'?o():n[s]==="{"?c():n[s]==="["?h():n.substring(s,s+4)==="null"||at.NULL&e&&t-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||at.BOOL&e&&t-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||at.BOOL&e&&t-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||at.INFINITY&e&&t-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||at.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||at.NAN&e&&t-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):u()),o=()=>{const f=s;let p=!1;for(s++;s<t&&(n[s]!=='"'||p&&n[s-1]==="\\");)p=n[s]==="\\"?!p:!1,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(f,++s-Number(p)))}catch(g){r(String(g))}else if(at.STR&e)try{return JSON.parse(n.substring(f,s-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},c=()=>{s++,d();const f={};try{for(;n[s]!=="}";){if(d(),s>=t&&at.OBJ&e)return f;const p=o();d(),s++;try{const g=a();Object.defineProperty(f,p,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(at.OBJ&e)return f;throw g}d(),n[s]===","&&s++}}catch{if(at.OBJ&e)return f;i("Expected '}' at end of object")}return s++,f},h=()=>{s++;const f=[];try{for(;n[s]!=="]";)f.push(a()),d(),n[s]===","&&s++}catch{if(at.ARR&e)return f;i("Expected ']' at end of array")}return s++,f},u=()=>{if(s===0){n==="-"&&at.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(at.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}r(String(p))}}const f=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s==t&&!(at.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(n.substring(f,s))}catch{n.substring(f,s)==="-"&&at.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(g){r(String(g))}}},d=()=>{for(;s<t&&` 
\r	`.includes(n[s]);)s++};return a()},By=n=>MP(n,at.ALL^at.NUM);var to=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Se=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Ke,Ni,so,Sn,Kf,Fu,Zf,Yf,Jf,Du,Qf,Hy;class Wc extends g0{constructor(e){super(),Ke.add(this),Ni.set(this,void 0),so.set(this,void 0),Sn.set(this,void 0),to(this,Ni,e,"f"),to(this,so,[],"f")}get currentChatCompletionSnapshot(){return Se(this,Sn,"f")}static fromReadableStream(e){const t=new Wc(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const i=new Wc(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,s){var a;super._createChatCompletion;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Se(this,Ke,"m",Kf).call(this);const r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const o of r)Se(this,Ke,"m",Zf).call(this,o);if((a=r.controller.signal)!=null&&a.aborted)throw new Qs;return this._addChatCompletion(Se(this,Ke,"m",Du).call(this))}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Se(this,Ke,"m",Kf).call(this),this._connected();const i=Ri.fromReadableStream(e,this.controller);let r;for await(const o of i)r&&r!==o.id&&this._addChatCompletion(Se(this,Ke,"m",Du).call(this)),Se(this,Ke,"m",Zf).call(this,o),r=o.id;if((a=i.controller.signal)!=null&&a.aborted)throw new Qs;return this._addChatCompletion(Se(this,Ke,"m",Du).call(this))}[(Ni=new WeakMap,so=new WeakMap,Sn=new WeakMap,Ke=new WeakSet,Kf=function(){this.ended||to(this,Sn,void 0,"f")},Fu=function(t){let s=Se(this,so,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Se(this,so,"f")[t.index]=s,s)},Zf=function(t){var i,r,a,o,c,h,u,d,f,p,g,y,v,w,A;if(this.ended)return;const s=Se(this,Ke,"m",Hy).call(this,t);this._emit("chunk",t,s);for(const x of t.choices){const S=s.choices[x.index];x.delta.content!=null&&((i=S.message)==null?void 0:i.role)==="assistant"&&((r=S.message)!=null&&r.content)&&(this._emit("content",x.delta.content,S.message.content),this._emit("content.delta",{delta:x.delta.content,snapshot:S.message.content,parsed:S.message.parsed})),x.delta.refusal!=null&&((a=S.message)==null?void 0:a.role)==="assistant"&&((o=S.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:x.delta.refusal,snapshot:S.message.refusal}),((c=x.logprobs)==null?void 0:c.content)!=null&&((h=S.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=x.logprobs)==null?void 0:u.content,snapshot:((d=S.logprobs)==null?void 0:d.content)??[]}),((f=x.logprobs)==null?void 0:f.refusal)!=null&&((p=S.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=x.logprobs)==null?void 0:g.refusal,snapshot:((y=S.logprobs)==null?void 0:y.refusal)??[]});const E=Se(this,Ke,"m",Fu).call(this,S);S.finish_reason&&(Se(this,Ke,"m",Jf).call(this,S),E.current_tool_call_index!=null&&Se(this,Ke,"m",Yf).call(this,S,E.current_tool_call_index));for(const C of x.delta.tool_calls??[])E.current_tool_call_index!==C.index&&(Se(this,Ke,"m",Jf).call(this,S),E.current_tool_call_index!=null&&Se(this,Ke,"m",Yf).call(this,S,E.current_tool_call_index)),E.current_tool_call_index=C.index;for(const C of x.delta.tool_calls??[]){const T=(v=S.message.tool_calls)==null?void 0:v[C.index];T!=null&&T.type&&((T==null?void 0:T.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=T.function)==null?void 0:w.name,index:C.index,arguments:T.function.arguments,parsed_arguments:T.function.parsed_arguments,arguments_delta:((A=C.function)==null?void 0:A.arguments)??""}):(T==null||T.type,void 0))}}},Yf=function(t,s){var a,o,c;if(Se(this,Ke,"m",Fu).call(this,t).done_tool_calls.has(s))return;const r=(a=t.message.tool_calls)==null?void 0:a[s];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const h=(c=(o=Se(this,Ni,"f"))==null?void 0:o.tools)==null?void 0:c.find(u=>u.type==="function"&&u.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:s,arguments:r.function.arguments,parsed_arguments:vu(h)?h.$parseRaw(r.function.arguments):h!=null&&h.function.strict?JSON.parse(r.function.arguments):null})}else r.type},Jf=function(t){var i,r;const s=Se(this,Ke,"m",Fu).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;const a=Se(this,Ke,"m",Qf).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(i=t.logprobs)!=null&&i.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(r=t.logprobs)!=null&&r.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Du=function(){if(this.ended)throw new oe("stream has ended, this shouldn't happen");const t=Se(this,Sn,"f");if(!t)throw new oe("request ended without sending any chunks");return to(this,Sn,void 0,"f"),to(this,so,[],"f"),FP(t,Se(this,Ni,"f"))},Qf=function(){var s;const t=(s=Se(this,Ni,"f"))==null?void 0:s.response_format;return d0(t)?t:null},Hy=function(t){var s,i,r,a;let o=Se(this,Sn,"f");const{choices:c,...h}=t;o?Object.assign(o,h):o=to(this,Sn,{...h,choices:[]},"f");for(const{delta:u,finish_reason:d,index:f,logprobs:p=null,...g}of t.choices){let y=o.choices[f];if(y||(y=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:p,...g}),p)if(!y.logprobs)y.logprobs=Object.assign({},p);else{const{content:C,refusal:T,...P}=p;Object.assign(y.logprobs,P),C&&((s=y.logprobs).content??(s.content=[]),y.logprobs.content.push(...C)),T&&((i=y.logprobs).refusal??(i.refusal=[]),y.logprobs.refusal.push(...T))}if(d&&(y.finish_reason=d,Se(this,Ni,"f")&&f0(Se(this,Ni,"f")))){if(d==="length")throw new Gw;if(d==="content_filter")throw new Xw}if(Object.assign(y,g),!u)continue;const{content:v,refusal:w,function_call:A,role:x,tool_calls:S,...E}=u;if(Object.assign(y.message,E),w&&(y.message.refusal=(y.message.refusal||"")+w),x&&(y.message.role=x),A&&(y.message.function_call?(A.name&&(y.message.function_call.name=A.name),A.arguments&&((r=y.message.function_call).arguments??(r.arguments=""),y.message.function_call.arguments+=A.arguments)):y.message.function_call=A),v&&(y.message.content=(y.message.content||"")+v,!y.message.refusal&&Se(this,Ke,"m",Qf).call(this)&&(y.message.parsed=By(y.message.content))),S){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:C,id:T,type:P,function:O,...U}of S){const M=(a=y.message.tool_calls)[C]??(a[C]={});Object.assign(M,U),T&&(M.id=T),P&&(M.type=P),O&&(M.function??(M.function={name:O.name??"",arguments:""})),O!=null&&O.name&&(M.function.name=O.name),O!=null&&O.arguments&&(M.function.arguments+=O.arguments,SP(Se(this,Ni,"f"),M)&&(M.function.parsed_arguments=By(M.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>t.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ri(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function FP(n,e){const{id:t,choices:s,created:i,model:r,system_fingerprint:a,...o}=n,c={...o,id:t,choices:s.map(({message:h,finish_reason:u,index:d,logprobs:f,...p})=>{if(!u)throw new oe(`missing finish_reason for choice ${d}`);const{content:g=null,function_call:y,tool_calls:v,...w}=h,A=h.role;if(!A)throw new oe(`missing role for choice ${d}`);if(y){const{arguments:x,name:S}=y;if(x==null)throw new oe(`missing function_call.arguments for choice ${d}`);if(!S)throw new oe(`missing function_call.name for choice ${d}`);return{...p,message:{content:g,function_call:{arguments:x,name:S},role:A,refusal:h.refusal??null},finish_reason:u,index:d,logprobs:f}}return v?{...p,index:d,finish_reason:u,logprobs:f,message:{...w,role:A,content:g,refusal:h.refusal??null,tool_calls:v.map((x,S)=>{const{function:E,type:C,id:T,...P}=x,{arguments:O,name:U,...M}=E||{};if(T==null)throw new oe(`missing choices[${d}].tool_calls[${S}].id
${Nu(n)}`);if(C==null)throw new oe(`missing choices[${d}].tool_calls[${S}].type
${Nu(n)}`);if(U==null)throw new oe(`missing choices[${d}].tool_calls[${S}].function.name
${Nu(n)}`);if(O==null)throw new oe(`missing choices[${d}].tool_calls[${S}].function.arguments
${Nu(n)}`);return{...P,id:T,type:C,function:{...M,name:U,arguments:O}}})}}:{...p,message:{...w,content:g,role:A,refusal:h.refusal??null},finish_reason:u,index:d,logprobs:f}}),created:i,model:r,object:"chat.completion",...a?{system_fingerprint:a}:{}};return wP(c,e)}function Nu(n){return JSON.stringify(n)}class Eo extends Wc{static fromReadableStream(e){const t=new Eo(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){const i=new Eo(null),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,r)),i}static runTools(e,t,s){const i=new Eo(t),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,r)),i}}let E0=class extends xe{parse(e,t){return EP(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>Em(s,e))}runFunctions(e,t){return e.stream?Eo.runFunctions(this._client,e,t):Vc.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Eo.runTools(this._client,e,t):Vc.runTools(this._client,e,t)}stream(e,t){return Wc.createChatCompletion(this._client,e,t)}};class Wg extends xe{constructor(){super(...arguments),this.completions=new E0(this._client)}}(function(n){n.Completions=E0})(Wg||(Wg={}));var z=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Qt=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},yt,Gg,li,bd,Ls,Lr,mo,Rr,jd,ts,_d,vd,Cc,_c,vc,zy,qy,Vy,Wy,Gy,Xy,Ky;class ei extends u0{constructor(){super(...arguments),yt.add(this),Gg.set(this,[]),li.set(this,{}),bd.set(this,{}),Ls.set(this,void 0),Lr.set(this,void 0),mo.set(this,void 0),Rr.set(this,void 0),jd.set(this,void 0),ts.set(this,void 0),_d.set(this,void 0),vd.set(this,void 0),Cc.set(this,void 0)}[(Gg=new WeakMap,li=new WeakMap,bd=new WeakMap,Ls=new WeakMap,Lr=new WeakMap,mo=new WeakMap,Rr=new WeakMap,jd=new WeakMap,ts=new WeakMap,_d=new WeakMap,vd=new WeakMap,Cc=new WeakMap,yt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>t.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ei;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var r;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Ri.fromReadableStream(e,this.controller);for await(const a of i)z(this,yt,"m",_c).call(this,a);if((r=i.controller.signal)!=null&&r.aborted)throw new Qs;return this._addRun(z(this,yt,"m",vc).call(this))}toReadableStream(){return new Ri(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,i,r){const a=new ei;return a._run(()=>a._runToolAssistantStream(e,t,s,i,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,s,i,r){var h;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...i,stream:!0},c=await e.submitToolOutputs(t,s,o,{...r,signal:this.controller.signal});this._connected();for await(const u of c)z(this,yt,"m",_c).call(this,u);if((h=c.controller.signal)!=null&&h.aborted)throw new Qs;return this._addRun(z(this,yt,"m",vc).call(this))}static createThreadAssistantStream(e,t,s){const i=new ei;return i._run(()=>i._threadAssistantStream(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,s,i){const r=new ei;return r._run(()=>r._runAssistantStream(e,t,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return z(this,_d,"f")}currentRun(){return z(this,vd,"f")}currentMessageSnapshot(){return z(this,Ls,"f")}currentRunStepSnapshot(){return z(this,Cc,"f")}async finalRunSteps(){return await this.done(),Object.values(z(this,li,"f"))}async finalMessages(){return await this.done(),Object.values(z(this,bd,"f"))}async finalRun(){if(await this.done(),!z(this,Lr,"f"))throw Error("Final run was not received.");return z(this,Lr,"f")}async _createThreadAssistantStream(e,t,s){var o;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const r={...t,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const c of a)z(this,yt,"m",_c).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new Qs;return this._addRun(z(this,yt,"m",vc).call(this))}async _createAssistantStream(e,t,s,i){var c;const r=i==null?void 0:i.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},o=await e.create(t,a,{...i,signal:this.controller.signal});this._connected();for await(const h of o)z(this,yt,"m",_c).call(this,h);if((c=o.controller.signal)!=null&&c.aborted)throw new Qs;return this._addRun(z(this,yt,"m",vc).call(this))}static accumulateDelta(e,t){for(const[s,i]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let r=e[s];if(r==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof r=="string"&&typeof i=="string")r+=i;else if(typeof r=="number"&&typeof i=="number")r+=i;else if(Xf(r)&&Xf(i))r=this.accumulateDelta(r,i);else if(Array.isArray(r)&&Array.isArray(i)){if(r.every(a=>typeof a=="string"||typeof a=="number")){r.push(...i);continue}for(const a of i){if(!Xf(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=r[o];c==null?r.push(a):r[o]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${r}`);e[s]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,i){return await this._createAssistantStream(t,e,s,i)}async _runToolAssistantStream(e,t,s,i,r){return await this._createToolAssistantStream(s,e,t,i,r)}}_c=function(e){if(!this.ended)switch(Qt(this,_d,e,"f"),z(this,yt,"m",Vy).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":z(this,yt,"m",Ky).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":z(this,yt,"m",qy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":z(this,yt,"m",zy).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},vc=function(){if(this.ended)throw new oe("stream has ended, this shouldn't happen");if(!z(this,Lr,"f"))throw Error("Final run has not been received");return z(this,Lr,"f")},zy=function(e){const[t,s]=z(this,yt,"m",Gy).call(this,e,z(this,Ls,"f"));Qt(this,Ls,t,"f"),z(this,bd,"f")[t.id]=t;for(const i of s){const r=t.content[i.index];(r==null?void 0:r.type)=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let r=i.text,a=t.content[i.index];if(a&&a.type=="text")this._emit("textDelta",r,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=z(this,mo,"f")){if(z(this,Rr,"f"))switch(z(this,Rr,"f").type){case"text":this._emit("textDone",z(this,Rr,"f").text,z(this,Ls,"f"));break;case"image_file":this._emit("imageFileDone",z(this,Rr,"f").image_file,z(this,Ls,"f"));break}Qt(this,mo,i.index,"f")}Qt(this,Rr,t.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(z(this,mo,"f")!==void 0){const i=e.data.content[z(this,mo,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,z(this,Ls,"f"));break;case"text":this._emit("textDone",i.text,z(this,Ls,"f"));break}}z(this,Ls,"f")&&this._emit("messageDone",e.data),Qt(this,Ls,void 0,"f")}},qy=function(e){const t=z(this,yt,"m",Wy).call(this,e);switch(Qt(this,Cc,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const r of s.step_details.tool_calls)r.index==z(this,jd,"f")?this._emit("toolCallDelta",r,t.step_details.tool_calls[r.index]):(z(this,ts,"f")&&this._emit("toolCallDone",z(this,ts,"f")),Qt(this,jd,r.index,"f"),Qt(this,ts,t.step_details.tool_calls[r.index],"f"),z(this,ts,"f")&&this._emit("toolCallCreated",z(this,ts,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Qt(this,Cc,void 0,"f"),e.data.step_details.type=="tool_calls"&&z(this,ts,"f")&&(this._emit("toolCallDone",z(this,ts,"f")),Qt(this,ts,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Vy=function(e){z(this,Gg,"f").push(e),this._emit("event",e)},Wy=function(e){switch(e.event){case"thread.run.step.created":return z(this,li,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=z(this,li,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=ei.accumulateDelta(t,s.delta);z(this,li,"f")[e.data.id]=i}return z(this,li,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":z(this,li,"f")[e.data.id]=e.data;break}if(z(this,li,"f")[e.data.id])return z(this,li,"f")[e.data.id];throw new Error("No snapshot available")},Gy=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const r of i.delta.content)if(r.index in t.content){let a=t.content[r.index];t.content[r.index]=z(this,yt,"m",Xy).call(this,r,a)}else t.content[r.index]=r,s.push(r);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Xy=function(e,t){return ei.accumulateDelta(t,e)},Ky=function(e){switch(Qt(this,vd,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Qt(this,Lr,e.data,"f"),z(this,ts,"f")&&(this._emit("toolCallDone",z(this,ts,"f")),Qt(this,ts,void 0,"f"));break}};class Cm extends xe{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,t,s,i){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},s){return Yt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,km,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class km extends ni{}Cm.MessagesPage=km;class Tm extends xe{retrieve(e,t,s,i={},r){return Yt(i)?this.retrieve(e,t,s,{},i):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t,s={},i){return Yt(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Pm,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class Pm extends ni{}Tm.RunStepsPage=Pm;class wu extends xe{constructor(){super(...arguments),this.steps=new Tm(this._client)}create(e,t,s){const{include:i,...r}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,t,s,i){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},s){return Yt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Rm,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t,s);return await this.poll(e,i.id,s)}createAndStream(e,t,s){return ei.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,t,{...s,headers:{...s==null?void 0:s.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(o=h)}}await bu(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return ei.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,i){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,i){const r=await this.submitToolOutputs(e,t,s,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,t,s,i){return ei.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,i)}}class Rm extends ni{}wu.RunsPage=Rm;wu.Steps=Tm;wu.RunStepsPage=Pm;class Ul extends xe{constructor(){super(...arguments),this.runs=new wu(this._client),this.messages=new Cm(this._client)}create(e={},t){return Yt(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return ei.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ul.Runs=wu;Ul.RunsPage=Rm;Ul.Messages=Cm;Ul.MessagesPage=km;const DP=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};let Im=class extends xe{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},s){return Yt(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Ef,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t,s);return await this.poll(e,i.id,s)}async poll(e,t,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...s,headers:i}).withResponse(),a=r.data;switch(a.status){case"in_progress":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=r.response.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(o=h)}}await bu(o);break;case"failed":case"completed":return a}}}async upload(e,t,s){const i=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,t,s){const i=await this.upload(e,t,s);return await this.poll(e,i.id,s)}};class Ef extends ni{}Im.VectorStoreFilesPage=Ef;class C0 extends xe{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t);return await this.poll(e,i.id,s)}listFiles(e,t,s={},i){return Yt(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Ef,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,t,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,t,{...s,headers:i}).withResponse();switch(r.status){case"in_progress":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(o=h)}}await bu(o);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},i){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(r,t.length),o=this._client,c=t.values(),h=[...s];async function u(f){for(let p of f){const g=await o.files.create({file:p,purpose:"assistants"},i);h.push(g.id)}}const d=Array(a).fill(c).map(u);return await DP(d),await this.createAndPoll(e,{file_ids:h})}}class Bl extends xe{constructor(){super(...arguments),this.files=new Im(this._client),this.fileBatches=new C0(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},t){return Yt(e)?this.list({},e):this._client.getAPIList("/vector_stores",Om,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Om extends ni{}Bl.VectorStoresPage=Om;Bl.Files=Im;Bl.VectorStoreFilesPage=Ef;Bl.FileBatches=C0;class Za extends xe{constructor(){super(...arguments),this.vectorStores=new Bl(this._client),this.chat=new Wg(this._client),this.assistants=new xm(this._client),this.threads=new Ul(this._client)}}Za.VectorStores=Bl;Za.VectorStoresPage=Om;Za.Assistants=xm;Za.AssistantsPage=Sm;Za.Threads=Ul;class k0 extends xe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class T0 extends xe{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Mm extends xe{create(e,t){return this._client.post("/files",Nl({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Yt(e)?this.list({},e):this._client.getAPIList("/files",Lm,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await bu(t),a=await this.retrieve(e),Date.now()-r>s)throw new _m({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class Lm extends ni{}Mm.FileObjectsPage=Lm;class Fm extends xe{list(e,t={},s){return Yt(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Dm,{query:t,...s})}}class Dm extends ni{}Fm.FineTuningJobCheckpointsPage=Dm;class Hl extends xe{constructor(){super(...arguments),this.checkpoints=new Fm(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Yt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Nm,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return Yt(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,jm,{query:t,...s})}}class Nm extends ni{}class jm extends ni{}Hl.FineTuningJobsPage=Nm;Hl.FineTuningJobEventsPage=jm;Hl.Checkpoints=Fm;Hl.FineTuningJobCheckpointsPage=Dm;class Au extends xe{constructor(){super(...arguments),this.jobs=new Hl(this._client)}}Au.Jobs=Hl;Au.FineTuningJobsPage=Nm;Au.FineTuningJobEventsPage=jm;class P0 extends xe{createVariation(e,t){return this._client.post("/images/variations",Nl({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Nl({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class $m extends xe{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Um,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Um extends _P{}$m.ModelsPage=Um;class R0 extends xe{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class I0 extends xe{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,Nl({body:t,...s}))}}class Bm extends xe{constructor(){super(...arguments),this.parts=new I0(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}Bm.Parts=I0;var O0;class de extends aP{constructor({baseURL:e=Lu("OPENAI_BASE_URL"),apiKey:t=Lu("OPENAI_API_KEY"),organization:s=Lu("OPENAI_ORG_ID")??null,project:i=Lu("OPENAI_PROJECT_ID")??null,...r}={}){if(t===void 0)throw new oe("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:s,project:i,...r,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&yP())throw new oe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new k0(this),this.chat=new vm(this),this.embeddings=new T0(this),this.files=new Mm(this),this.images=new P0(this),this.audio=new _u(this),this.moderations=new R0(this),this.models=new $m(this),this.fineTuning=new Au(this),this.beta=new Za(this),this.batches=new wm(this),this.uploads=new Bm(this),this._options=a,this.apiKey=t,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return zT(e,{arrayFormat:"brackets"})}}O0=de;de.OpenAI=O0;de.DEFAULT_TIMEOUT=6e5;de.OpenAIError=oe;de.APIError=_t;de.APIConnectionError=Af;de.APIConnectionTimeoutError=_m;de.APIUserAbortError=Qs;de.NotFoundError=Hw;de.ConflictError=zw;de.RateLimitError=Vw;de.BadRequestError=$w;de.AuthenticationError=Uw;de.InternalServerError=Ww;de.PermissionDeniedError=Bw;de.UnprocessableEntityError=qw;de.toFile=Jw;de.fileFromPath=Nw;de.Completions=k0;de.Chat=vm;de.Embeddings=T0;de.Files=Mm;de.FileObjectsPage=Lm;de.Images=P0;de.Audio=_u;de.Moderations=R0;de.Models=$m;de.ModelsPage=Um;de.FineTuning=Au;de.Beta=Za;de.Batches=wm;de.BatchesPage=Am;de.Uploads=Bm;const NP=Symbol("Let zodToJsonSchema decide on which parser to use"),Zy={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},jP=n=>typeof n=="string"?{...Zy,basePath:["#"],definitions:{},name:n}:{...Zy,basePath:["#"],definitions:{},...n},Xg=n=>"_def"in n?n._def:n;function $P(n){if(!n)return!0;for(const e in n)return!1;return!0}const UP=n=>{const e=jP(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([s,i])=>[Xg(i),{def:Xg(i),path:[...e.basePath,e.definitionPath,s],jsonSchema:void 0}]))}};function M0(n,e,t,s){s!=null&&s.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Ae(n,e,t,s,i){n[e]=t,M0(n,e,s,i)}function BP(){return{}}function HP(n,e){var s,i;const t={type:"array"};return((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==I.ZodAny&&(t.items=me(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Ae(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ae(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ae(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ae(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function zP(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const s of n.checks)switch(s.kind){case"min":e.target==="jsonSchema7"?s.inclusive?Ae(t,"minimum",s.value,s.message,e):Ae(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),Ae(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?Ae(t,"maximum",s.value,s.message,e):Ae(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),Ae(t,"maximum",s.value,s.message,e));break;case"multipleOf":Ae(t,"multipleOf",s.value,s.message,e);break}return t}function qP(){return{type:"boolean"}}function VP(n,e){return me(n.type._def,e)}const WP=(n,e)=>me(n.innerType._def,e);function L0(n,e,t){const s=t??e.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((i,r)=>L0(n,e,i))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return GP(n,e)}}const GP=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const s of n.checks)switch(s.kind){case"min":Ae(t,"minimum",s.value,s.message,e);break;case"max":Ae(t,"maximum",s.value,s.message,e);break}return t};function XP(n,e){return{...me(n.innerType._def,e),default:n.defaultValue()}}function KP(n,e,t){return e.effectStrategy==="input"?me(n.schema._def,e,t):{}}function ZP(n){return{type:"string",enum:[...n.values]}}const YP=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function JP(n,e){const t=[me(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),me(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(r=>!!r);let s=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(r=>{if(YP(r))i.push(...r.allOf),r.unevaluatedProperties===void 0&&(s=void 0);else{let a=r;if("additionalProperties"in r&&r.additionalProperties===!1){const{additionalProperties:o,...c}=r;a=c}else s=void 0;i.push(a)}}),i.length?{allOf:i,...s}:void 0}function QP(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let ep;const xr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ep===void 0&&(ep=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ep),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function F0(n,e){const t={type:"string"};function s(i){return e.patternStrategy==="escape"?eR(i):i}if(n.checks)for(const i of n.checks)switch(i.kind){case"min":Ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e);break;case"max":Ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ts(t,"email",i.message,e);break;case"format:idn-email":Ts(t,"idn-email",i.message,e);break;case"pattern:zod":Ps(t,xr.email,i.message,e);break}break;case"url":Ts(t,"uri",i.message,e);break;case"uuid":Ts(t,"uuid",i.message,e);break;case"regex":Ps(t,i.regex,i.message,e);break;case"cuid":Ps(t,xr.cuid,i.message,e);break;case"cuid2":Ps(t,xr.cuid2,i.message,e);break;case"startsWith":Ps(t,RegExp(`^${s(i.value)}`),i.message,e);break;case"endsWith":Ps(t,RegExp(`${s(i.value)}$`),i.message,e);break;case"datetime":Ts(t,"date-time",i.message,e);break;case"date":Ts(t,"date",i.message,e);break;case"time":Ts(t,"time",i.message,e);break;case"duration":Ts(t,"duration",i.message,e);break;case"length":Ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e),Ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"includes":{Ps(t,RegExp(s(i.value)),i.message,e);break}case"ip":{i.version!=="v6"&&Ts(t,"ipv4",i.message,e),i.version!=="v4"&&Ts(t,"ipv6",i.message,e);break}case"emoji":Ps(t,xr.emoji,i.message,e);break;case"ulid":{Ps(t,xr.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ts(t,"binary",i.message,e);break}case"contentEncoding:base64":{Ae(t,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{Ps(t,xr.base64,i.message,e);break}}break}case"nanoid":Ps(t,xr.nanoid,i.message,e)}return t}const eR=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Ts=(n,e,t,s)=>{var i;n.format||(i=n.anyOf)!=null&&i.some(r=>r.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&s.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&s.errorMessages&&{errorMessage:{format:t}}})):Ae(n,"format",e,t,s)},Ps=(n,e,t,s)=>{var i;n.pattern||(i=n.allOf)!=null&&i.some(r=>r.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&s.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:Yy(e,s),...t&&s.errorMessages&&{errorMessage:{pattern:t}}})):Ae(n,"pattern",Yy(e,s),t,s)},Yy=(n,e)=>{var h;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const s={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},i=s.i?t.source.toLowerCase():t.source;let r="",a=!1,o=!1,c=!1;for(let u=0;u<i.length;u++){if(a){r+=i[u],a=!1;continue}if(s.i){if(o){if(i[u].match(/[a-z]/)){c?(r+=i[u],r+=`${i[u-2]}-${i[u]}`.toUpperCase(),c=!1):i[u+1]==="-"&&((h=i[u+2])!=null&&h.match(/[a-z]/))?(r+=i[u],c=!0):r+=`${i[u]}${i[u].toUpperCase()}`;continue}}else if(i[u].match(/[a-z]/)){r+=`[${i[u]}${i[u].toUpperCase()}]`;continue}}if(s.m){if(i[u]==="^"){r+=`(^|(?<=[\r
]))`;continue}else if(i[u]==="$"){r+=`($|(?=[\r
]))`;continue}}if(s.s&&i[u]==="."){r+=o?`${i[u]}\r
`:`[${i[u]}\r
]`;continue}r+=i[u],i[u]==="\\"?a=!0:o&&i[u]==="]"?o=!1:!o&&i[u]==="["&&(o=!0)}try{const u=new RegExp(r)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return r};function D0(n,e){var s,i,r,a;if(e.target==="openApi3"&&((s=n.keyType)==null?void 0:s._def.typeName)===I.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,c)=>({...o,[c]:me(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:me(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===I.ZodString&&((r=n.keyType._def.checks)!=null&&r.length)){const o=Object.entries(F0(n.keyType._def,e)).reduce((c,[h,u])=>h==="type"?c:{...c,[h]:u},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===I.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function tR(n,e){if(e.mapStrategy==="record")return D0(n,e);const t=me(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},s=me(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,s],minItems:2,maxItems:2}}}function sR(n){const e=n.values,s=Object.keys(n.values).filter(r=>typeof e[e[r]]!="number").map(r=>e[r]),i=Array.from(new Set(s.map(r=>typeof r)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:s}}function iR(){return{not:{}}}function nR(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const $d={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rR(n,e){if(e.target==="openApi3")return Jy(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(s=>s._def.typeName in $d&&(!s._def.checks||!s._def.checks.length))){const s=t.reduce((i,r)=>{const a=$d[r._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:s.length>1?s:s[0]}}else if(t.every(s=>s._def.typeName==="ZodLiteral"&&!s.description)){const s=t.reduce((i,r)=>{const a=typeof r._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(r._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(s.length===t.length){const i=s.filter((r,a,o)=>o.indexOf(r)===a);return{type:i.length>1?i:i[0],enum:t.reduce((r,a)=>r.includes(a._def.value)?r:[...r,a._def.value],[])}}}else if(t.every(s=>s._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((s,i)=>[...s,...i._def.values.filter(r=>!s.includes(r))],[])};return Jy(n,e)}const Jy=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((s,i)=>me(s._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(s=>!!s&&(!e.strictUnions||typeof s=="object"&&Object.keys(s).length>0));return t.length?{anyOf:t}:void 0};function aR(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:$d[n.innerType._def.typeName],nullable:!0}:{type:[$d[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const s=me(n.innerType._def,{...e,currentPath:[...e.currentPath]});return s&&"$ref"in s?{allOf:[s],nullable:!0}:s&&{...s,nullable:!0}}const t=me(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function oR(n,e){const t={type:"number"};if(!n.checks)return t;for(const s of n.checks)switch(s.kind){case"int":t.type="integer",M0(t,"type",s.message,e);break;case"min":e.target==="jsonSchema7"?s.inclusive?Ae(t,"minimum",s.value,s.message,e):Ae(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),Ae(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?Ae(t,"maximum",s.value,s.message,e):Ae(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),Ae(t,"maximum",s.value,s.message,e));break;case"multipleOf":Ae(t,"multipleOf",s.value,s.message,e);break}return t}function lR(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":me(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":me(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function cR(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((s,[i,r])=>{if(r===void 0||r._def===void 0)return s;const a=me(r._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return a===void 0?s:{properties:{...s.properties,[i]:a},required:r.isOptional()&&!e.openaiStrictMode?s.required:[...s.required,i]}},{properties:{},required:[]}),additionalProperties:lR(n,e)};return t.required.length||delete t.required,t}const hR=(n,e)=>{var s;if(e.currentPath.toString()===((s=e.propertyPath)==null?void 0:s.toString()))return me(n.innerType._def,e);const t=me(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},uR=(n,e)=>{if(e.pipeStrategy==="input")return me(n.in._def,e);if(e.pipeStrategy==="output")return me(n.out._def,e);const t=me(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),s=me(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,s].filter(i=>i!==void 0)}};function dR(n,e){return me(n.type._def,e)}function fR(n,e){const s={type:"array",uniqueItems:!0,items:me(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Ae(s,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ae(s,"maxItems",n.maxSize.value,n.maxSize.message,e),s}function pR(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,s)=>me(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[]),additionalItems:me(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,s)=>me(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[])}}function gR(){return{not:{}}}function mR(){return{}}const yR=(n,e)=>me(n.innerType._def,e);function me(n,e,t=!1){var a;const s=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,s,t);if(o!==NP)return o}if(s&&!t){const o=bR(s,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const r=vR(n,n.typeName,e,t);return r&&wR(n,e,r),i.jsonSchema=r,r}const bR=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:_R(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((s,i)=>e.currentPath[i]===s)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},_R=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},vR=(n,e,t,s)=>{switch(e){case I.ZodString:return F0(n,t);case I.ZodNumber:return oR(n,t);case I.ZodObject:return cR(n,t);case I.ZodBigInt:return zP(n,t);case I.ZodBoolean:return qP();case I.ZodDate:return L0(n,t);case I.ZodUndefined:return gR();case I.ZodNull:return nR(t);case I.ZodArray:return HP(n,t);case I.ZodUnion:case I.ZodDiscriminatedUnion:return rR(n,t);case I.ZodIntersection:return JP(n,t);case I.ZodTuple:return pR(n,t);case I.ZodRecord:return D0(n,t);case I.ZodLiteral:return QP(n,t);case I.ZodEnum:return ZP(n);case I.ZodNativeEnum:return sR(n);case I.ZodNullable:return aR(n,t);case I.ZodOptional:return hR(n,t);case I.ZodMap:return tR(n,t);case I.ZodSet:return fR(n,t);case I.ZodLazy:return me(n.getter()._def,t);case I.ZodPromise:return dR(n,t);case I.ZodNaN:case I.ZodNever:return iR();case I.ZodEffects:return KP(n,t,s);case I.ZodAny:return BP();case I.ZodUnknown:return mR();case I.ZodDefault:return XP(n,t);case I.ZodBranded:return VP(n,t);case I.ZodReadonly:return yR(n,t);case I.ZodCatch:return WP(n,t);case I.ZodPipeline:return uR(n,t);case I.ZodFunction:case I.ZodVoid:case I.ZodSymbol:return;default:return(i=>{})()}},wR=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),AR=(n,e)=>{const t=UP(e),s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,i=me(n._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??{},r=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;r!==void 0&&(i.title=r);const a=(()=>{if($P(t.definitions))return;const c={},h=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([f])=>!h.has(f));if(d.length===0)break;for(const[f,p]of d)c[f]=me(Xg(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},h.add(f)}return c})(),o=s===void 0?a?{...i,[t.definitionPath]:a}:i:t.nameStrategy==="duplicate-ref"?{...i,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[s]:i}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...a,[s]:i}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function xR(n,e){return AR(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function SR(n,e,t){return vP({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:xR(n,{name:e})}},s=>n.parse(JSON.parse(s)))}const ER=Ue.object({name:Ue.string(),date_of_birth:Ue.string(),gender:Ue.string(),email:Ue.string(),phone:Ue.string(),location:Ue.string(),nationality:Ue.string(),languages:Ue.string(),health_conditions:Ue.string(),fitness_goals:Ue.string(),sleep_hours:Ue.string(),occupation:Ue.string(),industry:Ue.string(),skills:Ue.string(),hobbies:Ue.string(),food:Ue.string(),goals:Ue.string(),allergies:Ue.string()}),CR=`
  You are a helpful assistant that can generate a personalized profile based on a PDF file.

  Try to be as concise as possible in your resposne and do not include any explanations or additional information. 
  You will be given user details and you will need to generate a JSON object with string values that contains the following information:

  JSON format with keys: “name”, "date_of_birth", "gender", "email", "phone", "location", "nationality", "languages", "health_conditions", "fitness_goals", "sleep_hours", "occupation", "industry", "skills", "hobbies", "food", "goals", "allergies".

  The JSON object should be in the following format:

  {
    "name": "John Doe",
    "date_of_birth": "1990-01-01",
    "gender": "male",
    "email": "john.doe@example.com",
    "phone": "123-456-7890",
    "location": "New York, NY",
    "nationality": "American",
    "languages": "English, Spanish",
    "health_conditions": "Diabetes",
    "fitness_goals": "Running",
    "sleep_hours": "7",
    "occupation": "Software Engineer",
    "industry": "Technology",
    "skills": "Python, JavaScript",
    "hobbies": "Reading, Writing",
    "food": "Pizza, Sushi",
    "goals": "Learn new skills, Improve health",
    "allergies": "Peanuts, Tree Nuts"
  }


  `,kR=`Here is the user data extracted about the user:

  {user_data}
  
  Output a JSON object only. Do not JSON key names at all. All the values should be in string format. No other text.`;async function TR(n){const{openAiKey:e}=await Mr.storage.sync.get("openAiKey"),t=new de({dangerouslyAllowBrowser:!0,apiKey:e}),s=kR.replace("{user_data}",n),r=(await t.beta.chat.completions.parse({model:"gpt-4o",messages:[{role:"system",content:CR},{role:"user",content:s}],response_format:SR(ER,"user_details")})).choices[0].message.parsed;return console.log("event",r),r}const PR=()=>{const[n,e]=F.useState(!1),[t,s]=F.useState({name:"",date_of_birth:"",gender:"",email:"",phone:"",location:"",nationality:"",languages:"",health_conditions:"",fitness_goals:"",sleep_hours:"8",occupation:"",industry:"",skills:"",hobbies:"",food:"",goals:"",allergies:""}),i=h=>{},r=(h,u=50)=>{const[d,f]=F.useState("");return F.useEffect(()=>{let p=-1;if(!h)return;const g=setInterval(()=>{p<h.length?(f(y=>y+h.charAt(p)),p++):clearInterval(g)},u);return()=>clearInterval(g)},[h,u]),d},a=h=>{(async()=>{const d=await TR(h);d&&s(d),e(!0),setTimeout(()=>{e(!1)},1e3)})()};F.useEffect(()=>{(async()=>{const u=await NS("users",{id:1});u&&u.length>0&&s(u[0])})()},[]);const o=h=>u=>{s({...t,[h]:u.target.value})},c=()=>{jS("users",{id:1},t)};return k.jsxs("div",{className:"flex flex-col space-y-4 max-w-[800px] max-h-[800px] w-full p-4",children:[k.jsx(Qg,{className:"overflow-y-auto max-h-[600px]",children:k.jsxs(zb,{className:"flex flex-col gap-2  overflow-y-auto",children:[k.jsxs("div",{className:"flex justify-between items-center w-full my-4",children:[k.jsx("p",{className:"text-base font-semibold w-[250px]",children:"Personal Information"}),k.jsx(MT,{onPdfUpload:i,onTextExtracted:a})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"name",children:"Name"}),k.jsx(je,{id:"name",value:r(t.name||""),onChange:o("name"),placeholder:"Enter your name",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"dateOfBirth",children:"Date of Birth"}),k.jsx(je,{id:"dateOfBirth",type:"date",value:r(t.date_of_birth||""),onChange:o("date_of_birth"),className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"email",children:"Email"}),k.jsx(je,{id:"email",type:"email",value:r(t.email||""),onChange:o("email"),placeholder:"Enter your email",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"phone",children:"Phone Number"}),k.jsx(je,{id:"phone",type:"tel",value:r(t.location||""),onChange:o("phone"),placeholder:"Enter your phone number",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]})]}),k.jsx("p",{className:"text-base font-semibold my-4",children:"Demographic Information"}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"location",children:"Location"}),k.jsx(je,{id:"location",value:r(t.location||""),onChange:o("location"),placeholder:"Enter your location",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"nationality",children:"Nationality"}),k.jsx(je,{id:"nationality",type:"text",value:t.nationality||"",onChange:o("nationality"),className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"languages",children:"Languages"}),k.jsx(je,{id:"languages",type:"text",value:r(t.languages||""),onChange:o("languages"),placeholder:"Enter your languages",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]})]}),k.jsx("p",{className:"text-base font-semibold my-4",children:"Health and Wellness"}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"healthConditions",children:"Health Conditions"}),k.jsx(je,{id:"healthConditions",value:r(t.health_conditions||""),onChange:o("health_conditions"),placeholder:"Enter your health conditions",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"allergies",children:"Allergies"}),k.jsx(je,{id:"allergies",type:"text",value:r(t.allergies||""),onChange:o("allergies"),placeholder:"Enter your allergies",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"fitnessGoals",children:"Fitness Goals"}),k.jsx(je,{id:"fitnessGoals",type:"text",value:r(t.fitness_goals||""),onChange:o("fitness_goals"),placeholder:"Enter your fitness goals",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"sleepHours",children:"Sleep Hours"}),k.jsx(je,{id:"sleepHours",type:"text",value:r(t.sleep_hours||""),onChange:o("sleep_hours"),placeholder:"Enter your sleep hours",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]})]}),k.jsx("p",{className:"text-base font-semibold my-4",children:"Professional Details"}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"occupation",children:"Occupation"}),k.jsx(je,{id:"occupation",value:r(t.occupation||""),onChange:o("occupation"),placeholder:"Enter your occupation",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"industry",children:"Industry"}),k.jsx(je,{id:"industry",type:"text",value:r(t.industry||""),onChange:o("industry"),placeholder:"Enter your industry",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"skills",children:"Skills"}),k.jsx(je,{id:"skills",type:"text",value:r(t.skills||""),onChange:o("skills"),placeholder:"Enter your skills",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]})]}),k.jsx("p",{className:"text-base font-semibold my-4",children:"Interests and Preferences"}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"location",children:"Hobbies"}),k.jsx(je,{id:"hobbies",value:r(t.hobbies||""),onChange:o("hobbies"),placeholder:"Enter your hobbies",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"food",children:"Food"}),k.jsx(je,{id:"food",type:"text",value:r(t.food||""),onChange:o("food"),placeholder:"Enter your food",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx(rt,{htmlFor:"goals",children:"Goals"}),k.jsx(je,{id:"goals",type:"text",value:r(t.goals||""),onChange:o("goals"),placeholder:"Enter your goals",className:Ee("transition-all duration-300",n&&"animate-shimmer bg-gradient-to-r from-transparent via-white/10 to-transparent bg-[length:400%_100%] border-blue-400")})]})]})]})}),k.jsx(gb,{className:"w-full",onClick:c,children:"Save Profile"})]})},RR="https://iguytkzyochkbcjrjxyx.supabase.co",IR="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlndXl0a3p5b2Noa2JjanJqeHl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzMzI4OTMsImV4cCI6MjA0NzkwODg5M30.HhMKSWAsPM5hj5RR9G1Qq2e0HNguKH5757ZrPWWOEoo";function OR(){const[n,e]=F.useState(""),[t,s]=F.useState(IR),[i,r]=F.useState(RR),[a,o]=F.useState(null),[c,h]=F.useState("");return k.jsx("div",{className:"flex justify-center h-screen w-full p-8",children:k.jsxs(EA,{defaultValue:"keys",className:"w-[800px]",children:[k.jsxs(Ub,{className:"grid w-full grid-cols-2",children:[k.jsx(rp,{value:"user",children:"User"}),k.jsx(rp,{value:"keys",children:"API Keys"})]}),k.jsx(ap,{className:"flex justify-center",value:"user",children:k.jsx(PR,{})}),k.jsx(ap,{value:"keys",children:k.jsx("div",{className:"flex justify-center flex-col space-y-4 max-w-[800px] max-h-[800px] w-full p-4 mx-auto",children:k.jsxs(Qg,{className:"flex flex-col justify-center align-middle space-y-4 max-w-[auto] p-4 w-full mx-auto",children:[k.jsx("p",{className:"text-base font-semibold",children:"Anthropic API Key:"}),k.jsx(je,{onChange:u=>e(u.target.value),value:n,placeholder:"Enter your Anthropic API key"}),k.jsx("p",{className:"text-base font-semibold",children:"OpenAI API Key:"}),k.jsx(je,{onChange:u=>h(u.target.value),value:c,placeholder:"Enter your OpenAI API key"}),k.jsx("p",{className:"text-base font-semibold",children:"Supabase Key:"}),k.jsx(je,{onChange:u=>s(u.target.value),value:t,placeholder:"Enter your Supabase key"}),k.jsx("p",{className:"text-base font-semibold",children:"Supabase URL:"}),k.jsx(je,{onChange:u=>r(u.target.value),value:i,placeholder:"Enter your Supabase URL"}),k.jsx(gb,{onClick:()=>{Mr.storage.sync.set({apiKey:n}),Mr.storage.sync.set({supabaseKey:t}),Mr.storage.sync.set({supabaseUrl:i}),Mr.storage.sync.set({openAiKey:c})},children:"Save"})]})})})]})})}var Cf=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},kf=typeof window>"u"||"Deno"in globalThis;function Fs(){}function MR(n,e){return typeof n=="function"?n(e):n}function LR(n){return typeof n=="number"&&n>=0&&n!==1/0}function FR(n,e){return Math.max(n+(e||0)-Date.now(),0)}function Qy(n,e){return typeof n=="function"?n(e):n}function DR(n,e){return typeof n=="function"?n(e):n}function eb(n,e){const{type:t="all",exact:s,fetchStatus:i,predicate:r,queryKey:a,stale:o}=n;if(a){if(s){if(e.queryHash!==Hm(a,e.options))return!1}else if(!Xc(e.queryKey,a))return!1}if(t!=="all"){const c=e.isActive();if(t==="active"&&!c||t==="inactive"&&c)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||i&&i!==e.state.fetchStatus||r&&!r(e))}function tb(n,e){const{exact:t,status:s,predicate:i,mutationKey:r}=n;if(r){if(!e.options.mutationKey)return!1;if(t){if(Gc(e.options.mutationKey)!==Gc(r))return!1}else if(!Xc(e.options.mutationKey,r))return!1}return!(s&&e.state.status!==s||i&&!i(e))}function Hm(n,e){return((e==null?void 0:e.queryKeyHashFn)||Gc)(n)}function Gc(n){return JSON.stringify(n,(e,t)=>Kg(t)?Object.keys(t).sort().reduce((s,i)=>(s[i]=t[i],s),{}):t)}function Xc(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!Xc(n[t],e[t])):!1}function N0(n,e){if(n===e)return n;const t=sb(n)&&sb(e);if(t||Kg(n)&&Kg(e)){const s=t?n:Object.keys(n),i=s.length,r=t?e:Object.keys(e),a=r.length,o=t?[]:{};let c=0;for(let h=0;h<a;h++){const u=t?h:r[h];(!t&&s.includes(u)||t)&&n[u]===void 0&&e[u]===void 0?(o[u]=void 0,c++):(o[u]=N0(n[u],e[u]),o[u]===n[u]&&n[u]!==void 0&&c++)}return i===a&&c===i?n:o}return e}function sb(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function Kg(n){if(!ib(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!ib(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function ib(n){return Object.prototype.toString.call(n)==="[object Object]"}function NR(n){return new Promise(e=>{setTimeout(e,n)})}function jR(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?N0(n,e):e}function $R(n,e,t=0){const s=[...n,e];return t&&s.length>t?s.slice(1):s}function UR(n,e,t=0){const s=[e,...n];return t&&s.length>t?s.slice(0,-1):s}var zm=Symbol();function j0(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===zm?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var Ia,or,Sl,ob,BR=(ob=class extends Cf{constructor(){super();_(this,Ia);_(this,or);_(this,Sl);m(this,Sl,e=>{if(!kf&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){l(this,or)||this.setEventListener(l(this,Sl))}onUnsubscribe(){var e;this.hasListeners()||((e=l(this,or))==null||e.call(this),m(this,or,void 0))}setEventListener(e){var t;m(this,Sl,e),(t=l(this,or))==null||t.call(this),m(this,or,e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(e){l(this,Ia)!==e&&(m(this,Ia,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof l(this,Ia)=="boolean"?l(this,Ia):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ia=new WeakMap,or=new WeakMap,Sl=new WeakMap,ob),$0=new BR,El,lr,Cl,lb,HR=(lb=class extends Cf{constructor(){super();_(this,El,!0);_(this,lr);_(this,Cl);m(this,Cl,e=>{if(!kf&&window.addEventListener){const t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}})}onSubscribe(){l(this,lr)||this.setEventListener(l(this,Cl))}onUnsubscribe(){var e;this.hasListeners()||((e=l(this,lr))==null||e.call(this),m(this,lr,void 0))}setEventListener(e){var t;m(this,Cl,e),(t=l(this,lr))==null||t.call(this),m(this,lr,e(this.setOnline.bind(this)))}setOnline(e){l(this,El)!==e&&(m(this,El,e),this.listeners.forEach(s=>{s(e)}))}isOnline(){return l(this,El)}},El=new WeakMap,lr=new WeakMap,Cl=new WeakMap,lb),Ud=new HR;function zR(){let n,e;const t=new Promise((i,r)=>{n=i,e=r});t.status="pending",t.catch(()=>{});function s(i){Object.assign(t,i),delete t.resolve,delete t.reject}return t.resolve=i=>{s({status:"fulfilled",value:i}),n(i)},t.reject=i=>{s({status:"rejected",reason:i}),e(i)},t}function qR(n){return Math.min(1e3*2**n,3e4)}function U0(n){return(n??"online")==="online"?Ud.isOnline():!0}var B0=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function tp(n){return n instanceof B0}function H0(n){let e=!1,t=0,s=!1,i;const r=zR(),a=y=>{var v;s||(f(new B0(y)),(v=n.abort)==null||v.call(n))},o=()=>{e=!0},c=()=>{e=!1},h=()=>$0.isFocused()&&(n.networkMode==="always"||Ud.isOnline())&&n.canRun(),u=()=>U0(n.networkMode)&&n.canRun(),d=y=>{var v;s||(s=!0,(v=n.onSuccess)==null||v.call(n,y),i==null||i(),r.resolve(y))},f=y=>{var v;s||(s=!0,(v=n.onError)==null||v.call(n,y),i==null||i(),r.reject(y))},p=()=>new Promise(y=>{var v;i=w=>{(s||h())&&y(w)},(v=n.onPause)==null||v.call(n)}).then(()=>{var y;i=void 0,s||(y=n.onContinue)==null||y.call(n)}),g=()=>{if(s)return;let y;const v=t===0?n.initialPromise:void 0;try{y=v??n.fn()}catch(w){y=Promise.reject(w)}Promise.resolve(y).then(d).catch(w=>{var C;if(s)return;const A=n.retry??(kf?0:3),x=n.retryDelay??qR,S=typeof x=="function"?x(t,w):x,E=A===!0||typeof A=="number"&&t<A||typeof A=="function"&&A(t,w);if(e||!E){f(w);return}t++,(C=n.onFail)==null||C.call(n,t,w),NR(S).then(()=>h()?void 0:p()).then(()=>{e?f(w):g()})})};return{promise:r,cancel:a,continue:()=>(i==null||i(),r),cancelRetry:o,continueRetry:c,canStart:u,start:()=>(u()?g():p().then(g),r)}}function VR(){let n=[],e=0,t=o=>{o()},s=o=>{o()},i=o=>setTimeout(o,0);const r=o=>{e?n.push(o):i(()=>{t(o)})},a=()=>{const o=n;n=[],o.length&&i(()=>{s(()=>{o.forEach(c=>{t(c)})})})};return{batch:o=>{let c;e++;try{c=o()}finally{e--,e||a()}return c},batchCalls:o=>(...c)=>{r(()=>{o(...c)})},schedule:r,setNotifyFunction:o=>{t=o},setBatchNotifyFunction:o=>{s=o},setScheduler:o=>{i=o}}}var Ft=VR(),Oa,cb,z0=(cb=class{constructor(){_(this,Oa)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),LR(this.gcTime)&&m(this,Oa,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(kf?1/0:5*60*1e3))}clearGcTimeout(){l(this,Oa)&&(clearTimeout(l(this,Oa)),m(this,Oa,void 0))}},Oa=new WeakMap,cb),kl,Tl,As,Tt,hu,Ma,Ks,Bi,hb,WR=(hb=class extends z0{constructor(e){super();_(this,Ks);_(this,kl);_(this,Tl);_(this,As);_(this,Tt);_(this,hu);_(this,Ma);m(this,Ma,!1),m(this,hu,e.defaultOptions),this.setOptions(e.options),this.observers=[],m(this,As,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,m(this,kl,XR(this.options)),this.state=e.state??l(this,kl),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=l(this,Tt))==null?void 0:e.promise}setOptions(e){this.options={...l(this,hu),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&l(this,As).remove(this)}setData(e,t){const s=jR(this.state.data,e,this.options);return b(this,Ks,Bi).call(this,{data:s,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),s}setState(e,t){b(this,Ks,Bi).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var s,i;const t=(s=l(this,Tt))==null?void 0:s.promise;return(i=l(this,Tt))==null||i.cancel(e),t?t.then(Fs).catch(Fs):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(l(this,kl))}isActive(){return this.observers.some(e=>DR(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===zm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!FR(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(s=>s.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=l(this,Tt))==null||t.continue()}onOnline(){var t;const e=this.observers.find(s=>s.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=l(this,Tt))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),l(this,As).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(l(this,Tt)&&(l(this,Ma)?l(this,Tt).cancel({revert:!0}):l(this,Tt).cancelRetry()),this.scheduleGc()),l(this,As).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||b(this,Ks,Bi).call(this,{type:"invalidate"})}fetch(e,t){var c,h,u;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(l(this,Tt))return l(this,Tt).continueRetry(),l(this,Tt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const s=new AbortController,i=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(m(this,Ma,!0),s.signal)})},r=()=>{const d=j0(this.options,t),f={queryKey:this.queryKey,meta:this.meta};return i(f),m(this,Ma,!1),this.options.persister?this.options.persister(d,f,this):d(f)},a={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:r};i(a),(c=this.options.behavior)==null||c.onFetch(a,this),m(this,Tl,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=a.fetchOptions)==null?void 0:h.meta))&&b(this,Ks,Bi).call(this,{type:"fetch",meta:(u=a.fetchOptions)==null?void 0:u.meta});const o=d=>{var f,p,g,y;tp(d)&&d.silent||b(this,Ks,Bi).call(this,{type:"error",error:d}),tp(d)||((p=(f=l(this,As).config).onError)==null||p.call(f,d,this),(y=(g=l(this,As).config).onSettled)==null||y.call(g,this.state.data,d,this)),this.scheduleGc()};return m(this,Tt,H0({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:s.abort.bind(s),onSuccess:d=>{var f,p,g,y;if(d===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(v){o(v);return}(p=(f=l(this,As).config).onSuccess)==null||p.call(f,d,this),(y=(g=l(this,As).config).onSettled)==null||y.call(g,d,this.state.error,this),this.scheduleGc()},onError:o,onFail:(d,f)=>{b(this,Ks,Bi).call(this,{type:"failed",failureCount:d,error:f})},onPause:()=>{b(this,Ks,Bi).call(this,{type:"pause"})},onContinue:()=>{b(this,Ks,Bi).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),l(this,Tt).start()}},kl=new WeakMap,Tl=new WeakMap,As=new WeakMap,Tt=new WeakMap,hu=new WeakMap,Ma=new WeakMap,Ks=new WeakSet,Bi=function(e){const t=s=>{switch(e.type){case"failed":return{...s,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...GR(s.data,this.options),fetchMeta:e.meta??null};case"success":return{...s,data:e.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=e.error;return tp(i)&&i.revert&&l(this,Tl)?{...l(this,Tl),fetchStatus:"idle"}:{...s,error:i,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...e.state}}};this.state=t(this.state),Ft.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),l(this,As).notify({query:this,type:"updated",action:e})})},hb);function GR(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:U0(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function XR(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,s=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var ki,ub,KR=(ub=class extends Cf{constructor(e={}){super();_(this,ki);this.config=e,m(this,ki,new Map)}build(e,t,s){const i=t.queryKey,r=t.queryHash??Hm(i,t);let a=this.get(r);return a||(a=new WR({cache:this,queryKey:i,queryHash:r,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(i)}),this.add(a)),a}add(e){l(this,ki).has(e.queryHash)||(l(this,ki).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=l(this,ki).get(e.queryHash);t&&(e.destroy(),t===e&&l(this,ki).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ft.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return l(this,ki).get(e)}getAll(){return[...l(this,ki).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(s=>eb(t,s))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(s=>eb(e,s)):t}notify(e){Ft.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ft.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ft.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ki=new WeakMap,ub),Ti,Mt,La,Pi,Pn,db,ZR=(db=class extends z0{constructor(e){super();_(this,Pi);_(this,Ti);_(this,Mt);_(this,La);this.mutationId=e.mutationId,m(this,Mt,e.mutationCache),m(this,Ti,[]),this.state=e.state||YR(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){l(this,Ti).includes(e)||(l(this,Ti).push(e),this.clearGcTimeout(),l(this,Mt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){m(this,Ti,l(this,Ti).filter(t=>t!==e)),this.scheduleGc(),l(this,Mt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){l(this,Ti).length||(this.state.status==="pending"?this.scheduleGc():l(this,Mt).remove(this))}continue(){var e;return((e=l(this,La))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,r,a,o,c,h,u,d,f,p,g,y,v,w,A,x,S,E,C,T;m(this,La,H0({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(P,O)=>{b(this,Pi,Pn).call(this,{type:"failed",failureCount:P,error:O})},onPause:()=>{b(this,Pi,Pn).call(this,{type:"pause"})},onContinue:()=>{b(this,Pi,Pn).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>l(this,Mt).canRun(this)}));const t=this.state.status==="pending",s=!l(this,La).canStart();try{if(!t){b(this,Pi,Pn).call(this,{type:"pending",variables:e,isPaused:s}),await((r=(i=l(this,Mt).config).onMutate)==null?void 0:r.call(i,e,this));const O=await((o=(a=this.options).onMutate)==null?void 0:o.call(a,e));O!==this.state.context&&b(this,Pi,Pn).call(this,{type:"pending",context:O,variables:e,isPaused:s})}const P=await l(this,La).start();return await((h=(c=l(this,Mt).config).onSuccess)==null?void 0:h.call(c,P,e,this.state.context,this)),await((d=(u=this.options).onSuccess)==null?void 0:d.call(u,P,e,this.state.context)),await((p=(f=l(this,Mt).config).onSettled)==null?void 0:p.call(f,P,null,this.state.variables,this.state.context,this)),await((y=(g=this.options).onSettled)==null?void 0:y.call(g,P,null,e,this.state.context)),b(this,Pi,Pn).call(this,{type:"success",data:P}),P}catch(P){try{throw await((w=(v=l(this,Mt).config).onError)==null?void 0:w.call(v,P,e,this.state.context,this)),await((x=(A=this.options).onError)==null?void 0:x.call(A,P,e,this.state.context)),await((E=(S=l(this,Mt).config).onSettled)==null?void 0:E.call(S,void 0,P,this.state.variables,this.state.context,this)),await((T=(C=this.options).onSettled)==null?void 0:T.call(C,void 0,P,e,this.state.context)),P}finally{b(this,Pi,Pn).call(this,{type:"error",error:P})}}finally{l(this,Mt).runNext(this)}}},Ti=new WeakMap,Mt=new WeakMap,La=new WeakMap,Pi=new WeakSet,Pn=function(e){const t=s=>{switch(e.type){case"failed":return{...s,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...s,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:e.error,failureCount:s.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Ft.batch(()=>{l(this,Ti).forEach(s=>{s.onMutationUpdate(e)}),l(this,Mt).notify({mutation:this,type:"updated",action:e})})},db);function YR(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var hs,uu,fb,JR=(fb=class extends Cf{constructor(e={}){super();_(this,hs);_(this,uu);this.config=e,m(this,hs,new Map),m(this,uu,Date.now())}build(e,t,s){const i=new ZR({mutationCache:this,mutationId:++nt(this,uu)._,options:e.defaultMutationOptions(t),state:s});return this.add(i),i}add(e){const t=ju(e),s=l(this,hs).get(t)??[];s.push(e),l(this,hs).set(t,s),this.notify({type:"added",mutation:e})}remove(e){var s;const t=ju(e);if(l(this,hs).has(t)){const i=(s=l(this,hs).get(t))==null?void 0:s.filter(r=>r!==e);i&&(i.length===0?l(this,hs).delete(t):l(this,hs).set(t,i))}this.notify({type:"removed",mutation:e})}canRun(e){var s;const t=(s=l(this,hs).get(ju(e)))==null?void 0:s.find(i=>i.state.status==="pending");return!t||t===e}runNext(e){var s;const t=(s=l(this,hs).get(ju(e)))==null?void 0:s.find(i=>i!==e&&i.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){Ft.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...l(this,hs).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(s=>tb(t,s))}findAll(e={}){return this.getAll().filter(t=>tb(e,t))}notify(e){Ft.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Ft.batch(()=>Promise.all(e.map(t=>t.continue().catch(Fs))))}},hs=new WeakMap,uu=new WeakMap,fb);function ju(n){var e;return((e=n.options.scope)==null?void 0:e.id)??String(n.mutationId)}function nb(n){return{onFetch:(e,t)=>{var u,d,f,p,g;const s=e.options,i=(f=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,r=((p=e.state.data)==null?void 0:p.pages)||[],a=((g=e.state.data)==null?void 0:g.pageParams)||[];let o={pages:[],pageParams:[]},c=0;const h=async()=>{let y=!1;const v=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(e.signal.aborted?y=!0:e.signal.addEventListener("abort",()=>{y=!0}),e.signal)})},w=j0(e.options,e.fetchOptions),A=async(x,S,E)=>{if(y)return Promise.reject();if(S==null&&x.pages.length)return Promise.resolve(x);const C={queryKey:e.queryKey,pageParam:S,direction:E?"backward":"forward",meta:e.options.meta};v(C);const T=await w(C),{maxPages:P}=e.options,O=E?UR:$R;return{pages:O(x.pages,T,P),pageParams:O(x.pageParams,S,P)}};if(i&&r.length){const x=i==="backward",S=x?QR:rb,E={pages:r,pageParams:a},C=S(s,E);o=await A(E,C,x)}else{const x=n??r.length;do{const S=c===0?a[0]??s.initialPageParam:rb(s,o);if(c>0&&S==null)break;o=await A(o,S),c++}while(c<x)}return o};e.options.persister?e.fetchFn=()=>{var y,v;return(v=(y=e.options).persister)==null?void 0:v.call(y,h,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=h}}}function rb(n,{pages:e,pageParams:t}){const s=e.length-1;return e.length>0?n.getNextPageParam(e[s],e,t[s],t):void 0}function QR(n,{pages:e,pageParams:t}){var s;return e.length>0?(s=n.getPreviousPageParam)==null?void 0:s.call(n,e[0],e,t[0],t):void 0}var He,cr,hr,Pl,Rl,ur,Il,Ol,pb,eI=(pb=class{constructor(n={}){_(this,He);_(this,cr);_(this,hr);_(this,Pl);_(this,Rl);_(this,ur);_(this,Il);_(this,Ol);m(this,He,n.queryCache||new KR),m(this,cr,n.mutationCache||new JR),m(this,hr,n.defaultOptions||{}),m(this,Pl,new Map),m(this,Rl,new Map),m(this,ur,0)}mount(){nt(this,ur)._++,l(this,ur)===1&&(m(this,Il,$0.subscribe(async n=>{n&&(await this.resumePausedMutations(),l(this,He).onFocus())})),m(this,Ol,Ud.subscribe(async n=>{n&&(await this.resumePausedMutations(),l(this,He).onOnline())})))}unmount(){var n,e;nt(this,ur)._--,l(this,ur)===0&&((n=l(this,Il))==null||n.call(this),m(this,Il,void 0),(e=l(this,Ol))==null||e.call(this),m(this,Ol,void 0))}isFetching(n){return l(this,He).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return l(this,cr).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=l(this,He).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.getQueryData(n.queryKey);if(e===void 0)return this.fetchQuery(n);{const t=this.defaultQueryOptions(n),s=l(this,He).build(this,t);return n.revalidateIfStale&&s.isStaleByTime(Qy(t.staleTime,s))&&this.prefetchQuery(t),Promise.resolve(e)}}getQueriesData(n){return l(this,He).findAll(n).map(({queryKey:e,state:t})=>{const s=t.data;return[e,s]})}setQueryData(n,e,t){const s=this.defaultQueryOptions({queryKey:n}),i=l(this,He).get(s.queryHash),r=i==null?void 0:i.state.data,a=MR(e,r);if(a!==void 0)return l(this,He).build(this,s).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return Ft.batch(()=>l(this,He).findAll(n).map(({queryKey:s})=>[s,this.setQueryData(s,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=l(this,He).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=l(this,He);Ft.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=l(this,He),s={type:"active",...n};return Ft.batch(()=>(t.findAll(n).forEach(i=>{i.reset()}),this.refetchQueries(s,e)))}cancelQueries(n={},e={}){const t={revert:!0,...e},s=Ft.batch(()=>l(this,He).findAll(n).map(i=>i.cancel(t)));return Promise.all(s).then(Fs).catch(Fs)}invalidateQueries(n={},e={}){return Ft.batch(()=>{if(l(this,He).findAll(n).forEach(s=>{s.invalidate()}),n.refetchType==="none")return Promise.resolve();const t={...n,type:n.refetchType??n.type??"active"};return this.refetchQueries(t,e)})}refetchQueries(n={},e){const t={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},s=Ft.batch(()=>l(this,He).findAll(n).filter(i=>!i.isDisabled()).map(i=>{let r=i.fetch(void 0,t);return t.throwOnError||(r=r.catch(Fs)),i.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(s).then(Fs)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=l(this,He).build(this,e);return t.isStaleByTime(Qy(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(Fs).catch(Fs)}fetchInfiniteQuery(n){return n.behavior=nb(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(Fs).catch(Fs)}ensureInfiniteQueryData(n){return n.behavior=nb(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Ud.isOnline()?l(this,cr).resumePausedMutations():Promise.resolve()}getQueryCache(){return l(this,He)}getMutationCache(){return l(this,cr)}getDefaultOptions(){return l(this,hr)}setDefaultOptions(n){m(this,hr,n)}setQueryDefaults(n,e){l(this,Pl).set(Gc(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...l(this,Pl).values()];let t={};return e.forEach(s=>{Xc(n,s.queryKey)&&(t={...t,...s.defaultOptions})}),t}setMutationDefaults(n,e){l(this,Rl).set(Gc(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...l(this,Rl).values()];let t={};return e.forEach(s=>{Xc(n,s.mutationKey)&&(t={...t,...s.defaultOptions})}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...l(this,hr).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=Hm(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===zm&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...l(this,hr).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){l(this,He).clear(),l(this,cr).clear()}},He=new WeakMap,cr=new WeakMap,hr=new WeakMap,Pl=new WeakMap,Rl=new WeakMap,ur=new WeakMap,Il=new WeakMap,Ol=new WeakMap,pb),tI=F.createContext(void 0),sI=({client:n,children:e})=>(F.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),k.jsx(tI.Provider,{value:n,children:e}));const iI=new eI;function nI({children:n}){return k.jsx(sI,{client:iI,children:n})}Z0.createRoot(document.getElementById("root")).render(k.jsx(Y0,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:k.jsx(nI,{children:k.jsx(OR,{})})}));
